import{c as M,u as W,r as i,d,D as c,i as m,Q as X,j as e,U as Y,o as Z,X as ee,p as te,P as D,n as z,h as se,I as T,q as ae,f as re,s as le,E as oe}from"./index-ClM_nN6k.js";import{L}from"./lock-DkA79cqZ.js";import{T as O}from"./trash-2-Y8oJSfA9.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=M("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=M("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function xe(){var P;const{user:l}=W(),[F,H]=i.useState([]),[ne,h]=i.useState(!0),[u,f]=i.useState(!1),[g,B]=i.useState(""),[n,V]=i.useState({key:"name",direction:"asc"}),[p,w]=i.useState(""),[b,j]=i.useState(""),[y,v]=i.useState(""),[N,Q]=i.useState("user"),k="695842e1003a3db19fea";i.useEffect(()=>{x()},[]);const x=async()=>{h(!0);try{const r=(await d.listDocuments(c,m,[X.limit(100)])).documents.map(a=>({$id:a.user_id||a.$id,name:a.manager_name,email:"N/A",status:!a.hidden,prefs:{role:a.role,teamId:a.$id}})).filter(a=>a.$id!==k||(l==null?void 0:l.$id)===k);H(r)}catch(t){console.error("Error loading participants:",t)}finally{h(!1)}},C=t=>{let s="asc";n.key===t&&n.direction==="asc"&&(s="desc"),V({key:t,direction:s})},G=()=>{let t=[...F];if(g){const s=g.toLowerCase();t=t.filter(r=>r.name.toLowerCase().includes(s))}return t.sort((s,r)=>{if(s.status!==r.status)return s.status?-1:1;let a,o;return n.key==="role"?(a=s.prefs.role||"",o=r.prefs.role||""):(a=s.name.toLowerCase(),o=r.name.toLowerCase()),a<o?n.direction==="asc"?-1:1:a>o?n.direction==="asc"?1:-1:0}),t},J=async t=>{t.preventDefault();try{const s=`${b.toLowerCase().replace(/\s+/g,"")}@fantapl.app`,r=await se.create(T.unique(),s,y,p);await d.createDocument(c,m,T.unique(),{user_id:r.$id,manager_name:p,team_name:`Squadra di ${p}`,credits_remaining:500,role:N,hidden:!1,force_pass_reset:!0}),alert(`Utente ${p} creato con successo! Username: ${b}`),f(!1),w(""),j(""),v(""),x()}catch(s){console.error(s),s.code===409?alert("ERRORE: Questo Username o Email esiste già nel sistema Auth di Appwrite. Cambia username o elimina l'utente dalla Console di Appwrite."):alert(`Errore creazione: ${s.message}`)}},$=async(t,s)=>{if(confirm(`Sei sicuro di voler eliminare il profilo di ${s}?`))try{await d.deleteDocument(c,m,t),alert("Profilo database eliminato. Ricordati di rimuovere l'utente anche dalla Console Appwrite (Auth) per liberare l'username."),x()}catch(r){console.error(r),alert(`Errore eliminazione: ${r.message}`)}},I=async(t,s,r)=>{const a=prompt(`Inserisci la NUOVA PASSWORD provvisoria per ${s}:`);if(a){if(a.length<8){alert("La password deve essere di almeno 8 caratteri.");return}if(confirm(`Confermi di voler assegnare la password "${a}" a ${s}?`)){h(!0);try{const K=await le.createExecution("admin-password-reset",JSON.stringify({userId:r,newPassword:a,adminId:l==null?void 0:l.$id}),!1,"/",oe.POST),R=JSON.parse(K.responseBody);if(!R.success)throw new Error(R.error);await d.updateDocument(c,m,t,{force_pass_reset:!0}),alert(`Password aggiornata correttamente! ${s} ora può accedere con "${a}" (e dovrà cambiarla al login).`)}catch(o){console.error(o),alert(`Errore reset password (assicurati di aver deployato la Function): ${o.message}`)}finally{h(!1)}}}},S=async(t,s,r)=>{try{await d.updateDocument(c,m,t,{role:s}),alert(`Ruolo di ${r} aggiornato a ${s.toUpperCase()}`),x()}catch(a){alert(`Errore aggiornamento ruolo: ${a.message}`)}},A=async(t,s,r)=>{const a=s;try{await d.updateDocument(c,m,t,{hidden:a}),alert(`Account di ${r} ${a?"DISABILITATO":"RIABILITATO"}.`),x()}catch(o){alert(`Errore cambio stato: ${o.message}`)}},E=async(t,s)=>{const r=prompt("Nuovo nome per il manager:",s);if(!(!r||r===s))try{await d.updateDocument(c,m,t,{manager_name:r}),x()}catch(a){alert(`Errore rinomina: ${a.message}`)}},U=({colKey:t})=>n.key!==t?e.jsx("div",{className:"w-3 h-3 opacity-0"}):n.direction==="asc"?e.jsx(ae,{size:14,className:"text-pl-teal"}):e.jsx(re,{size:14,className:"text-pl-teal"}),_=G();return e.jsxs("div",{className:"p-4 md:p-8 max-w-5xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-white flex items-center justify-center md:justify-start gap-3",children:[e.jsx(Y,{className:"text-pl-teal w-8 h-8"}),"Partecipanti"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Gestisci gli utenti e i loro permessi."})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Cerca manager...",value:g,onChange:t=>B(t.target.value),className:"bg-black/20 border border-white/10 rounded-lg pl-9 pr-4 py-3 md:py-2 text-sm text-white focus:outline-none focus:border-pl-teal/50 w-full transition"})]}),e.jsxs("button",{onClick:()=>f(t=>!t),className:`w-full md:w-auto font-bold px-6 py-3 md:py-2 rounded-lg transition shadow-lg flex items-center justify-center gap-2 whitespace-nowrap text-sm ${u?"bg-gray-600 text-white hover:bg-gray-500":"bg-pl-teal text-pl-dark hover:bg-pl-teal/90 shadow-pl-teal/20"}`,children:[u?e.jsx(ee,{size:18}):e.jsx(ie,{size:18}),u?"Chiudi":"Nuovo Utente"]})]})]}),((P=l==null?void 0:l.name)==null?void 0:P.toLowerCase())==="admin"&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 p-4 rounded-xl text-xs md:text-sm text-yellow-200/80",children:[e.jsxs("h4",{className:"font-bold flex items-center gap-2 mb-2 text-yellow-200",children:[e.jsx(te,{size:14})," Note Admin"]}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 opacity-80",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Reset Password:"})," Forza il reset al prossimo login. Non cambia la password Auth se l'utente l'ha scordata (Eliminare e Ricreare)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Eliminazione:"})," Rimuove solo i dati FantaPL. Rimuovere l'utente Auth manualmente dalla Console."]})]})]}),u&&e.jsxs("div",{className:"bg-[#1e1e24] border border-white/10 rounded-2xl p-6 shadow-2xl animate-in fade-in slide-in-from-top-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-6 border-b border-white/5 pb-4",children:"Nuovo Profilo"}),e.jsxs("form",{onSubmit:J,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-bold uppercase",children:"Nome Manager"}),e.jsx("input",{type:"text",placeholder:"Es. Paolo",value:p,onChange:t=>w(t.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:border-pl-teal/50 focus:bg-black/40 transition outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-bold uppercase",children:"Username"}),e.jsx("input",{type:"text",placeholder:"Es. paolo",value:b,onChange:t=>j(t.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:border-pl-teal/50 focus:bg-black/40 transition outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-bold uppercase",children:"Password Temp"}),e.jsx("input",{type:"password",placeholder:"Es. pippo123",value:y,onChange:t=>v(t.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:border-pl-teal/50 focus:bg-black/40 transition outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-bold uppercase",children:"Ruolo"}),e.jsxs("select",{value:N,onChange:t=>Q(t.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:border-pl-teal/50 focus:bg-black/40 transition outline-none appearance-none",children:[e.jsx("option",{value:"user",children:"Utente"}),e.jsx("option",{value:"helper",children:"Helper"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsx("div",{className:"md:col-span-2 lg:col-span-4 flex justify-end gap-3 mt-4 pt-4 border-t border-white/5",children:e.jsx("button",{type:"submit",className:"bg-pl-teal hover:bg-pl-teal/90 text-pl-dark px-6 py-2.5 rounded-lg font-bold shadow-lg shadow-pl-teal/20 transition w-full md:w-auto",children:"Crea Utente"})})]})]}),e.jsx("div",{className:"hidden md:block bg-[#16161a] border border-white/5 rounded-2xl overflow-hidden shadow-xl",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-black/20 text-gray-500 uppercase text-xs font-bold tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-5 cursor-pointer hover:text-white transition group select-none w-auto",onClick:()=>C("name"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Manager ",e.jsx(U,{colKey:"name"})]})}),e.jsx("th",{className:"p-5 cursor-pointer hover:text-white transition group select-none w-40",onClick:()=>C("role"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Ruolo ",e.jsx(U,{colKey:"role"})]})}),e.jsx("th",{className:"p-5 text-right w-48",children:"Azioni"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:_.map(t=>{var s,r;return e.jsxs("tr",{className:`hover:bg-white/[0.02] transition group ${t.status?"":"opacity-50"}`,children:[e.jsx("td",{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full shrink-0 ${t.status?"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]":"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.5)]"}`,title:t.status?"Attivo":"Sospeso"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-white text-base",children:t.name}),e.jsx("span",{className:"text-xs text-gray-600 font-mono hidden group-hover:block transition-opacity select-all",children:t.$id})]}),((s=t.prefs)==null?void 0:s.teamId)===((r=l==null?void 0:l.prefs)==null?void 0:r.teamId)&&e.jsx("span",{className:"px-2 py-0.5 bg-pl-teal/10 text-pl-teal text-[10px] font-bold uppercase rounded ml-2",children:"Tu"})]})}),e.jsx("td",{className:"p-5",children:e.jsxs("select",{value:t.prefs.role,onChange:a=>S(t.prefs.teamId,a.target.value,t.name),className:"bg-black/20 border border-white/10 rounded-lg px-3 py-1.5 text-sm text-gray-300 focus:text-white outline-none focus:border-white/20 hover:bg-white/5 transition cursor-pointer",children:[e.jsx("option",{value:"user",children:"Utente"}),e.jsx("option",{value:"helper",children:"Helper"}),e.jsx("option",{value:"admin",children:"Admin"})]})}),e.jsx("td",{className:"p-5",children:e.jsxs("div",{className:"flex justify-end gap-1 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>A(t.prefs.teamId,t.status,t.name),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white transition",title:t.status?"Disabilita":"Abilita",children:t.status?e.jsx(L,{size:18}):e.jsx(q,{size:18})}),e.jsx("button",{onClick:()=>E(t.prefs.teamId,t.name),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-yellow-400 transition",title:"Rinomina",children:e.jsx(D,{size:18})}),e.jsx("button",{onClick:()=>I(t.prefs.teamId,t.name,t.$id),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-blue-400 transition",title:"Reset Password",children:e.jsx(z,{size:18})}),e.jsx("button",{onClick:()=>$(t.prefs.teamId,t.name),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-red-400 transition",title:"Elimina",children:e.jsx(O,{size:18})})]})})]},t.$id)})})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:_.map(t=>e.jsxs("div",{className:`bg-[#16161a] border border-white/5 rounded-xl p-5 shadow-lg relative overflow-hidden ${t.status?"":"opacity-60"}`,children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${t.status?"bg-emerald-500":"bg-red-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-4 pl-2",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full shrink-0 ${t.status?"bg-emerald-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-lg text-white leading-tight",children:t.name}),e.jsx("div",{className:"text-[10px] text-gray-600 font-mono mt-0.5",children:t.$id})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(t.prefs.teamId,t.status,t.name),className:"p-2 bg-white/5 rounded-full text-gray-400 hover:text-white",children:t.status?e.jsx(L,{size:16}):e.jsx(q,{size:16})}),e.jsx("button",{onClick:()=>E(t.prefs.teamId,t.name),className:"p-2 bg-white/5 rounded-full text-gray-400 hover:text-yellow-400",children:e.jsx(D,{size:16})})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 mb-4 pl-2 border-t border-white/5 pt-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase text-gray-500 font-bold block mb-1",children:"Ruolo"}),e.jsxs("select",{value:t.prefs.role,onChange:s=>S(t.prefs.teamId,s.target.value,t.name),className:"bg-black/30 border border-white/10 rounded px-2 py-1.5 text-xs text-gray-300 w-full",children:[e.jsx("option",{value:"user",children:"Utente"}),e.jsx("option",{value:"helper",children:"Helper"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})}),e.jsxs("div",{className:"flex gap-2 justify-end pl-2 pt-2 border-t border-white/5",children:[e.jsxs("button",{onClick:()=>I(t.prefs.teamId,t.name,t.$id),className:"flex-1 py-2 text-xs font-medium bg-blue-500/10 text-blue-400 rounded-lg border border-blue-500/20 flex items-center justify-center gap-2",children:[e.jsx(z,{size:14})," Password"]}),e.jsxs("button",{onClick:()=>$(t.prefs.teamId,t.name),className:"flex-1 py-2 text-xs font-medium bg-red-500/10 text-red-400 rounded-lg border border-red-500/20 flex items-center justify-center gap-2",children:[e.jsx(O,{size:14})," Elimina"]})]})]},t.$id))})]})}export{xe as ParticipantManagement};
