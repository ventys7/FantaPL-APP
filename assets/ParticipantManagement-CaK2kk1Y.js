import{c as D,r as u,d as y,D as v,g as N,Q as O,n as U,E as B,f as q,I as A,j as e,P,m as E,o as H,b as G,u as F,U as V,p as Q,X as J,q as K}from"./index-IQCk0ePk.js";import{C as T}from"./coins-eN-SbOWY.js";import{L as z}from"./lock-JkTZ79y1.js";import{T as L}from"./trash-2-DbOOYVSY.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=D("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=D("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),X="695842e1003a3db19fea",Y=n=>{const[o,g]=u.useState([]),[b,p]=u.useState(!0),[x,w]=u.useState(""),[c,j]=u.useState({key:"name",direction:"asc"}),t=u.useCallback(async()=>{p(!0);try{const i=(await y.listDocuments(v,N,[O.limit(100)])).documents.map(a=>({$id:a.user_id||a.$id,name:a.manager_name,credits:a.credits_remaining??500,email:"N/A",status:!a.hidden,prefs:{role:a.role,teamId:a.$id}})).filter(a=>a.prefs.role!=="g_admin"||(n==null?void 0:n.$id)===a.$id);g(i)}catch(r){console.error("Error loading participants:",r)}finally{p(!1)}},[n]);u.useEffect(()=>{t()},[t]);const h=r=>{let l="asc";c.key===r&&c.direction==="asc"&&(l="desc"),j({key:r,direction:l})},f=u.useCallback(()=>{let r=[...o];if(x){const l=x.toLowerCase();r=r.filter(i=>i.name.toLowerCase().includes(l))}return r.sort((l,i)=>{if(l.status!==i.status)return l.status?-1:1;let a,d;return c.key==="role"?(a=l.prefs.role||"",d=i.prefs.role||""):(a=l.name.toLowerCase(),d=i.name.toLowerCase()),a<d?c.direction==="asc"?-1:1:a>d?c.direction==="asc"?1:-1:0}),r},[o,x,c]);return{users:o,loading:b,searchTerm:x,setSearchTerm:w,sortConfig:c,handleSort:h,getSortedUsers:f,handleCreateUser:async(r,l,i,a)=>{try{const d=`${l.toLowerCase().replace(/\s+/g,"")}@fantapl.app`,I=await q.create(A.unique(),d,i,r);return await y.createDocument(v,N,A.unique(),{user_id:I.$id,manager_name:r,team_name:`Squadra di ${r}`,credits_remaining:500,role:a,hidden:!1,force_pass_reset:!0}),alert(`Utente ${r} creato con successo! Username: ${l}`),t(),!0}catch(d){return console.error(d),d.code===409?alert("ERRORE: Questo Username o Email esiste già nel sistema Auth di Appwrite. Cambia username o elimina l'utente dalla Console di Appwrite."):alert(`Errore creazione: ${d.message}`),!1}},handleDelete:async(r,l)=>{if(confirm(`Sei sicuro di voler eliminare il profilo di ${l}?`))try{await y.deleteDocument(v,N,r),alert("Profilo database eliminato. Ricordati di rimuovere l'utente anche dalla Console Appwrite (Auth) per liberare l'username."),t()}catch(i){console.error(i),alert(`Errore eliminazione: ${i.message}`)}},handleResetPassword:async(r,l,i)=>{const a=prompt(`Inserisci la NUOVA PASSWORD provvisoria per ${l}:`);if(a){if(a.length<8){alert("La password deve essere di almeno 8 caratteri.");return}if(confirm(`Confermi di voler assegnare la password "${a}" a ${l}?`)){p(!0);try{const I=await U.createExecution("admin-password-reset",JSON.stringify({userId:i,newPassword:a,adminId:n==null?void 0:n.$id}),!1,"/",B.POST),R=JSON.parse(I.responseBody);if(!R.success)throw new Error(R.error);await y.updateDocument(v,N,r,{force_pass_reset:!0}),alert(`Password aggiornata correttamente! ${l} ora può accedere con "${a}".`)}catch(d){console.error(d),alert(`Errore reset password: ${d.message}`)}finally{p(!1)}}}},handleUpdateRole:async(r,l,i)=>{try{await y.updateDocument(v,N,r,{role:l}),alert(`Ruolo di ${i} aggiornato a ${l.toUpperCase()}`),t()}catch(a){alert(`Errore aggiornamento ruolo: ${a.message}`)}},handleToggleStatus:async(r,l,i)=>{const a=l;try{await y.updateDocument(v,N,r,{hidden:a}),alert(`Account di ${i} ${a?"DISABILITATO":"RIABILITATO"}.`),t()}catch(d){alert(`Errore cambio stato: ${d.message}`)}},handleRename:async(r,l)=>{const i=prompt("Nuovo nome per il manager:",l);if(!(!i||i===l))try{await y.updateDocument(v,N,r,{manager_name:i}),t()}catch(a){alert(`Errore rinomina: ${a.message}`)}},handleUpdateBudget:async(r,l,i)=>{const a=prompt(`Modifica Budget per ${i}:`,l.toString());if(a===null)return;const d=parseInt(a);if(isNaN(d)){alert("Inserisci un numero valido.");return}try{await y.updateDocument(v,N,r,{credits_remaining:d}),t()}catch(I){alert(`Errore aggiornamento budget: ${I.message}`)}},GHOST_ADMIN_ID:X}},Z=({isCreating:n,setIsCreating:o,onCreate:g,currentUserRole:b})=>{const[p,x]=u.useState(""),[w,c]=u.useState(""),[j,t]=u.useState(""),[h,f]=u.useState("user"),s=async m=>{m.preventDefault(),await g(p,w,j,h)&&(o(!1),x(""),c(""),t(""))};return n?e.jsxs("div",{className:"bg-[#1e1e24] border border-white/10 rounded-2xl p-6 shadow-2xl animate-in fade-in slide-in-from-top-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-6 border-b border-white/5 pb-4",children:"Nuovo Profilo"}),e.jsxs("form",{onSubmit:s,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-bold uppercase",children:"Nome Manager"}),e.jsx("input",{type:"text",placeholder:"Es. Paolo",value:p,onChange:m=>x(m.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:border-pl-teal/50 focus:bg-black/40 transition outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-bold uppercase",children:"Username"}),e.jsx("input",{type:"text",placeholder:"Es. paolo",value:w,onChange:m=>c(m.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:border-pl-teal/50 focus:bg-black/40 transition outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-bold uppercase",children:"Password Temp"}),e.jsx("input",{type:"password",placeholder:"Es. pippo123",value:j,onChange:m=>t(m.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:border-pl-teal/50 focus:bg-black/40 transition outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 font-bold uppercase",children:"Ruolo"}),e.jsxs("select",{value:h,onChange:m=>f(m.target.value),className:"w-full bg-black/20 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:border-pl-teal/50 focus:bg-black/40 transition outline-none appearance-none",children:[e.jsx("option",{value:"user",children:"Utente"}),e.jsx("option",{value:"helper",children:"Helper"}),e.jsx("option",{value:"admin",children:"Admin"}),b==="g_admin"&&e.jsx("option",{value:"g_admin",children:"Ghost Admin"})]})]}),e.jsx("div",{className:"md:col-span-2 lg:col-span-4 flex justify-end gap-3 mt-4 pt-4 border-t border-white/5",children:e.jsx("button",{type:"submit",className:"bg-pl-teal hover:bg-pl-teal/90 text-pl-dark px-6 py-2.5 rounded-lg font-bold shadow-lg shadow-pl-teal/20 transition w-full md:w-auto",children:"Crea Utente"})})]})]}):null},ee=({users:n,currentUser:o,sortConfig:g,onSort:b,onUpdateBudget:p,onUpdateRole:x,onToggleStatus:w,onRename:c,onResetPassword:j,onDelete:t,ghostAdminId:h})=>{const f=({colKey:s})=>g.key!==s?e.jsx("div",{className:"w-3 h-3 opacity-0"}):g.direction==="asc"?e.jsx(H,{size:14,className:"text-pl-teal"}):e.jsx(G,{size:14,className:"text-pl-teal"});return e.jsx("div",{className:"hidden md:block bg-[#16161a] border border-white/5 rounded-2xl overflow-hidden shadow-xl",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-black/20 text-gray-500 uppercase text-xs font-bold tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-5 cursor-pointer hover:text-white transition group select-none w-auto",onClick:()=>b("name"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Manager ",e.jsx(f,{colKey:"name"})]})}),e.jsx("th",{className:"p-5 cursor-pointer hover:text-white transition group select-none w-40",onClick:()=>b("role"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Ruolo ",e.jsx(f,{colKey:"role"})]})}),e.jsx("th",{className:"p-5 text-right w-48",children:"Azioni"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:n.map(s=>{var m,C,k;return e.jsxs("tr",{className:`hover:bg-white/[0.02] transition group ${s.status?"":"opacity-50"}`,children:[e.jsx("td",{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full shrink-0 ${s.status?"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]":"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.5)]"}`,title:s.status?"Attivo":"Sospeso"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-white text-base",children:s.name}),s.$id!==h&&e.jsxs("button",{onClick:()=>p(s.prefs.teamId,s.credits,s.name),className:"text-xs bg-white/10 hover:bg-white/20 px-1.5 py-0.5 rounded text-pl-teal font-mono flex items-center gap-1 transition",title:"Modifica Budget",children:[e.jsx(T,{size:10}),s.credits," cr"]})]}),e.jsx("span",{className:"text-xs text-gray-600 font-mono hidden group-hover:block transition-opacity select-all",children:s.$id})]}),((m=s.prefs)==null?void 0:m.teamId)===((C=o==null?void 0:o.prefs)==null?void 0:C.teamId)&&e.jsx("span",{className:"px-2 py-0.5 bg-pl-teal/10 text-pl-teal text-[10px] font-bold uppercase rounded ml-2",children:"Tu"})]})}),e.jsx("td",{className:"p-5",children:e.jsxs("select",{value:s.prefs.role,onChange:$=>x(s.prefs.teamId,$.target.value,s.name),disabled:s.prefs.role==="g_admin"&&(o==null?void 0:o.$id)!==s.$id,className:`bg-black/20 border border-white/10 rounded-lg px-3 py-1.5 text-sm outline-none focus:border-white/20 hover:bg-white/5 transition cursor-pointer ${s.prefs.role==="g_admin"?"text-pl-teal font-extrabold cursor-not-allowed opacity-70":"text-gray-300 focus:text-white"}`,children:[e.jsx("option",{value:"user",children:"Utente"}),e.jsx("option",{value:"helper",children:"Helper"}),e.jsx("option",{value:"admin",children:"Admin"}),((k=o==null?void 0:o.prefs)==null?void 0:k.role)==="g_admin"&&e.jsx("option",{value:"g_admin",children:"Ghost Admin"})]})}),e.jsx("td",{className:"p-5",children:e.jsxs("div",{className:"flex justify-end gap-1 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>w(s.prefs.teamId,s.status,s.name),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white transition",title:s.status?"Disabilita":"Abilita",children:s.status?e.jsx(z,{size:18}):e.jsx(M,{size:18})}),e.jsx("button",{onClick:()=>c(s.prefs.teamId,s.name),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-yellow-400 transition",title:"Rinomina",children:e.jsx(P,{size:18})}),e.jsx("button",{onClick:()=>j(s.prefs.teamId,s.name,s.$id),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-blue-400 transition",title:"Reset Password",children:e.jsx(E,{size:18})}),e.jsx("button",{onClick:()=>t(s.prefs.teamId,s.name),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-red-400 transition",title:"Elimina",children:e.jsx(L,{size:18})})]})})]},s.$id)})})]})})},te=({users:n,currentUser:o,onUpdateBudget:g,onUpdateRole:b,onToggleStatus:p,onRename:x,onResetPassword:w,onDelete:c,ghostAdminId:j})=>e.jsx("div",{className:"md:hidden space-y-4",children:n.map(t=>{var h;return e.jsxs("div",{className:`bg-[#16161a] border border-white/5 rounded-xl p-5 shadow-lg relative overflow-hidden ${t.status?"":"opacity-60"}`,children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${t.status?"bg-emerald-500":"bg-red-500"}`}),e.jsxs("div",{className:"flex justify-between items-start mb-4 pl-2",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full shrink-0 ${t.status?"bg-emerald-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-bold text-lg text-white leading-tight",children:t.name}),t.$id!==j&&e.jsxs("button",{onClick:()=>g(t.prefs.teamId,t.credits,t.name),className:"text-[10px] bg-white/10 hover:bg-white/20 px-1.5 py-0.5 rounded text-pl-teal font-mono flex items-center gap-1 transition",children:[e.jsx(T,{size:10}),t.credits," cr"]})]}),e.jsx("div",{className:"text-[10px] text-gray-600 font-mono mt-0.5",children:t.$id})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(t.prefs.teamId,t.status,t.name),className:"p-2 bg-white/5 rounded-full text-gray-400 hover:text-white",children:t.status?e.jsx(z,{size:16}):e.jsx(M,{size:16})}),e.jsx("button",{onClick:()=>x(t.prefs.teamId,t.name),className:"p-2 bg-white/5 rounded-full text-gray-400 hover:text-yellow-400",children:e.jsx(P,{size:16})})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 mb-4 pl-2 border-t border-white/5 pt-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] uppercase text-gray-500 font-bold block mb-1",children:"Ruolo"}),e.jsxs("select",{value:t.prefs.role,onChange:f=>b(t.prefs.teamId,f.target.value,t.name),className:"bg-black/30 border border-white/10 rounded px-2 py-1.5 text-xs text-gray-300 w-full",children:[e.jsx("option",{value:"user",children:"Utente"}),e.jsx("option",{value:"helper",children:"Helper"}),e.jsx("option",{value:"admin",children:"Admin"}),((h=o==null?void 0:o.prefs)==null?void 0:h.role)==="g_admin"&&e.jsx("option",{value:"g_admin",children:"Ghost Admin"})]})]})}),e.jsxs("div",{className:"flex gap-2 justify-end pl-2 pt-2 border-t border-white/5",children:[e.jsxs("button",{onClick:()=>w(t.prefs.teamId,t.name,t.$id),className:"flex-1 py-2 text-xs font-medium bg-blue-500/10 text-blue-400 rounded-lg border border-blue-500/20 flex items-center justify-center gap-2",children:[e.jsx(E,{size:14})," Password"]}),e.jsxs("button",{onClick:()=>c(t.prefs.teamId,t.name),className:"flex-1 py-2 text-xs font-medium bg-red-500/10 text-red-400 rounded-lg border border-red-500/20 flex items-center justify-center gap-2",children:[e.jsx(L,{size:14})," Elimina"]})]})]},t.$id)})});function oe(){var S,_;const{user:n}=F(),[o,g]=u.useState(!1),{getSortedUsers:b,searchTerm:p,setSearchTerm:x,sortConfig:w,handleSort:c,handleCreateUser:j,handleDelete:t,handleResetPassword:h,handleUpdateRole:f,handleToggleStatus:s,handleRename:m,handleUpdateBudget:C,GHOST_ADMIN_ID:k}=Y(n),$=b();return e.jsxs("div",{className:"p-4 md:p-8 max-w-5xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-white flex items-center justify-center md:justify-start gap-3",children:[e.jsx(V,{className:"text-pl-teal w-8 h-8"}),"Partecipanti"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Gestisci gli utenti e i loro permessi."})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Cerca manager...",value:p,onChange:r=>x(r.target.value),className:"bg-black/20 border border-white/10 rounded-lg pl-9 pr-4 py-3 md:py-2 text-sm text-white focus:outline-none focus:border-pl-teal/50 w-full transition"})]}),e.jsxs("button",{onClick:()=>g(r=>!r),className:`w-full md:w-auto font-bold px-6 py-3 md:py-2 rounded-lg transition shadow-lg flex items-center justify-center gap-2 whitespace-nowrap text-sm ${o?"bg-gray-600 text-white hover:bg-gray-500":"bg-pl-teal text-pl-dark hover:bg-pl-teal/90 shadow-pl-teal/20"}`,children:[o?e.jsx(J,{size:18}):e.jsx(W,{size:18}),o?"Chiudi":"Nuovo Utente"]})]})]}),((S=n==null?void 0:n.prefs)==null?void 0:S.role)==="g_admin"&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 p-4 rounded-xl text-xs md:text-sm text-yellow-200/80",children:[e.jsxs("h4",{className:"font-bold flex items-center gap-2 mb-2 text-yellow-200",children:[e.jsx(K,{size:14})," Note Admin"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 opacity-80",children:e.jsxs("li",{children:[e.jsx("strong",{children:"Eliminazione:"})," Rimuove solo i dati FantaPL. Rimuovere l'utente Auth manualmente dalla Console."]})})]}),e.jsx(Z,{isCreating:o,setIsCreating:g,onCreate:j,currentUserRole:(_=n==null?void 0:n.prefs)==null?void 0:_.role}),e.jsx(ee,{users:$,currentUser:n,sortConfig:w,onSort:c,onUpdateBudget:C,onUpdateRole:f,onToggleStatus:s,onRename:m,onResetPassword:h,onDelete:t,ghostAdminId:k}),e.jsx(te,{users:$,currentUser:n,onUpdateBudget:C,onUpdateRole:f,onToggleStatus:s,onRename:m,onResetPassword:h,onDelete:t,ghostAdminId:k})]})}export{oe as ParticipantManagement};
