import{r as b,j as e,f as z,p as R,A as I,t as U,u as k,z as A,L as B,U as F,d as D,D as M,i as O,l as H}from"./index-BS35buTl.js";import{C as Q}from"./coins-3adMf9nh.js";const $=({players:a,role:h,label:n,required:j,countType:d="player",realTeams:N=[]})=>{const[v,_]=b.useState(new Set),E=r=>{_(m=>{const s=new Set(m);return s.has(r)?s.delete(r):s.add(r),s})},u=a.filter(r=>r.position===h);if(h==="Portiere"){const m=[...new Set(u.map(s=>s.team_id))].map(s=>{var w,C;const t=N.find(l=>l.$id===s),o=u.filter(l=>l.team_id===s);return{teamId:s,teamName:((w=o[0])==null?void 0:w.team_name)||"Team",teamShortName:((C=o[0])==null?void 0:C.team_short_name)||"???",quotation:(t==null?void 0:t.goalkeeper_quotation)||0,purchasePrice:(t==null?void 0:t.goalkeeper_purchase_price)||0,players:o}});return m.sort((s,t)=>t.purchasePrice-s.purchasePrice),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"flex items-center justify-between mb-2 px-1",children:e.jsxs("span",{className:"text-[10px] uppercase font-bold text-gray-500",children:[n," (Blocchi)"]})}),m.length===0?e.jsx("div",{className:"px-2 py-1 text-xs text-gray-600 italic",children:"-"}):e.jsx("div",{className:"space-y-1",children:m.map(s=>e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>E(s.teamId),className:"flex items-center justify-between px-2 py-2 rounded hover:bg-white/5 transition group cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 flex items-center justify-center shrink-0",title:s.teamName,children:e.jsx("img",{src:`https://images.fotmob.com/image_resources/logo/teamlogo/${s.teamId.replace("team_","")}.png`,alt:s.teamShortName,className:"w-full h-full object-contain drop-shadow-md",loading:"lazy",onError:t=>{var w;const o=t.target;o.style.display="none",o.parentElement&&(o.parentElement.innerText=((w=s.teamShortName)==null?void 0:w.substring(0,3))||"?",o.parentElement.className="w-8 h-8 md:w-9 md:h-9 flex items-center justify-center shrink-0 bg-white/10 rounded-md text-[9px] font-bold text-gray-400")}})}),e.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 shrink-0 overflow-hidden rounded-full border border-white/20 bg-slate-800 shadow-lg pl-0",children:e.jsx("div",{className:`grid w-full h-full p-[1px] gap-[1px] ${s.players.length===2?"grid-cols-2":s.players.length>=3?"grid-cols-2 grid-rows-2":"grid-cols-1"}`,children:s.players.length===1?e.jsx("div",{className:"w-full h-full overflow-hidden",children:e.jsx("img",{src:s.players[0].image_url,alt:"",className:"w-full h-full object-cover"})}):s.players.length===2?s.players.map(t=>e.jsx("div",{className:"w-full h-full overflow-hidden",children:e.jsx("img",{src:t.image_url,alt:"",className:"w-full h-full object-cover scale-[1.1]"})},t.$id)):s.players.length===3?s.players.map(t=>e.jsx("div",{className:"w-full h-full overflow-hidden",children:e.jsx("img",{src:t.image_url,alt:"",className:"w-full h-full object-cover scale-[1.2]"})},t.$id)):s.players.slice(0,4).map((t,o)=>e.jsxs("div",{className:"w-full h-full overflow-hidden relative",children:[e.jsx("img",{src:t.image_url,alt:"",className:"w-full h-full object-cover scale-[1.2]"}),o===3&&s.players.length>4&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-[8px] font-bold text-white",children:["+",s.players.length-3]})]},t.$id))})}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs("span",{className:"text-sm md:text-base text-gray-200 truncate group-hover:text-white transition font-medium",children:["Blocco ",s.teamShortName]}),e.jsx(z,{size:14,className:`text-gray-500 transition shrink-0 ${v.has(s.teamId)?"rotate-180":""}`})]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0 ml-2",children:[e.jsxs("div",{className:"flex flex-col items-end leading-none",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-500 mb-0.5",children:"Q"}),e.jsx("span",{className:"text-xs md:text-base font-bold text-white",children:s.quotation})]}),e.jsxs("div",{className:"flex flex-col items-end leading-none w-8",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-500 mb-0.5",children:"P"}),e.jsx("span",{className:"text-xs md:text-base font-bold text-pl-teal",children:s.purchasePrice||"-"})]})]})]}),v.has(s.teamId)&&e.jsx("div",{className:"ml-6 pl-3 border-l border-white/10 space-y-1 py-1",children:s.players.map(t=>e.jsxs("div",{className:"flex items-center gap-2 py-1 text-xs text-gray-400",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-white/10 overflow-hidden border border-white/20 shrink-0",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-[8px] text-gray-500",children:"?"})}),e.jsxs("span",{className:`truncate ${t.is_active===!1?"italic text-gray-500":""}`,children:[t.name,t.is_active===!1?"*":""]})]},t.$id))})]},s.teamId))})]})}return u.sort((r,m)=>(m.purchase_price||0)-(r.purchase_price||0)),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-500",children:n}),e.jsx("span",{className:`text-[10px] font-mono ${u.length===(d==="block"?99:j)?"text-green-400":"text-gray-600"}`})]}),u.length===0?e.jsx("div",{className:"px-2 py-1 text-xs text-gray-600 italic",children:"-"}):e.jsx("div",{className:"space-y-1",children:u.map(r=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-2 rounded hover:bg-white/5 transition group",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 flex items-center justify-center shrink-0",title:r.team_name,children:e.jsx("img",{src:`https://images.fotmob.com/image_resources/logo/teamlogo/${r.team_id.replace("team_","")}.png`,alt:r.team_short_name,className:"w-full h-full object-contain drop-shadow-md",loading:"lazy",onError:m=>{var t;const s=m.target;s.style.display="none",s.parentElement&&(s.parentElement.innerText=((t=r.team_short_name)==null?void 0:t.substring(0,3))||"?",s.parentElement.className="w-8 h-8 md:w-9 md:h-9 flex items-center justify-center shrink-0 bg-white/10 rounded-md text-[9px] font-bold text-gray-400")}})}),e.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 rounded-full bg-slate-800 border border-white/20 overflow-hidden shrink-0 shadow-lg",children:r.image_url?e.jsx("img",{src:r.image_url,alt:r.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-[8px] text-gray-500",children:"?"})}),e.jsxs("span",{className:`text-sm md:text-base text-gray-200 truncate group-hover:text-white transition font-medium ${r.is_active===!1?"italic !text-gray-500":""}`,children:[r.name,r.is_active===!1?"*":""]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0 ml-2",children:[e.jsxs("div",{className:"flex flex-col items-end leading-none",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-500 mb-0.5",children:"Q"}),e.jsx("span",{className:"text-xs md:text-base font-bold text-white",children:r.quotation})]}),e.jsxs("div",{className:"flex flex-col items-end leading-none w-8",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-500 mb-0.5",children:"P"}),e.jsx("span",{className:"text-xs md:text-base font-bold text-pl-teal",children:r.purchase_price||"-"})]})]})]},r.$id))})]})},G=({team:a,realTeams:h})=>{const[n,j]=b.useState("ALL"),d=N=>{j(v=>v===N?"ALL":N)};return e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-2xl overflow-hidden hover:border-white/20 transition group",children:[e.jsxs("div",{className:"p-5 bg-gradient-to-r from-white/5 to-transparent border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-pl-teal/10 border-2 border-pl-teal/20 flex items-center justify-center overflow-hidden shrink-0 shadow-lg",children:a.logoUrl?e.jsx("img",{src:a.logoUrl,alt:a.teamName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl font-bold text-pl-teal",children:a.managerName.charAt(0)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-white truncate",title:a.teamName,children:a.teamName}),e.jsxs("div",{className:"text-sm text-gray-400 font-medium",children:["Allenatore: ",e.jsx("span",{className:"text-gray-200",children:a.managerName})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-500 font-bold uppercase tracking-wider",children:"Budget"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-pl-teal font-mono font-bold text-lg",children:[e.jsx(Q,{size:16}),a.remaining," ",e.jsxs("span",{className:"text-xs text-gray-500 font-normal self-end mb-0.5",children:["/ ",a.budget]})]})]}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-xs font-bold border flex items-center gap-1.5 ${a.isComplete?"bg-green-500/20 text-green-400 border-green-500/30":"bg-yellow-500/10 text-yellow-400 border-yellow-500/20"}`,children:[a.isComplete?e.jsx(R,{size:12}):e.jsx(I,{size:12}),a.isComplete?"ROSA COMPLETA":"INCOMPLETA"]})]})]}),e.jsxs("div",{className:"p-4 bg-black/20 text-xs text-gray-400 grid grid-cols-4 gap-2 text-center border-b border-white/5",children:[e.jsxs("button",{onClick:()=>d("P"),className:`transition-colors py-1 rounded hover:bg-white/5 ${n==="P"?"bg-white/10 ring-1 ring-white/20":""} ${a.roleCounts.P===2?"text-green-400 font-bold":""}`,children:["P: ",a.roleCounts.P,"/2"]}),e.jsxs("button",{onClick:()=>d("D"),className:`transition-colors py-1 rounded hover:bg-white/5 ${n==="D"?"bg-white/10 ring-1 ring-white/20":""} ${a.roleCounts.D===8?"text-green-400 font-bold":""}`,children:["D: ",a.roleCounts.D,"/8"]}),e.jsxs("button",{onClick:()=>d("C"),className:`transition-colors py-1 rounded hover:bg-white/5 ${n==="C"?"bg-white/10 ring-1 ring-white/20":""} ${a.roleCounts.C===8?"text-green-400 font-bold":""}`,children:["C: ",a.roleCounts.C,"/8"]}),e.jsxs("button",{onClick:()=>d("A"),className:`transition-colors py-1 rounded hover:bg-white/5 ${n==="A"?"bg-white/10 ring-1 ring-white/20":""} ${a.roleCounts.A===6?"text-green-400 font-bold":""}`,children:["A: ",a.roleCounts.A,"/6"]})]}),e.jsxs("div",{className:"max-h-[400px] overflow-y-auto divide-y divide-white/5 bg-black/10 transition-all",children:[(n==="ALL"||n==="P")&&e.jsx($,{players:a.players,role:"Portiere",label:"Portieri",required:2,countType:"block",realTeams:h}),(n==="ALL"||n==="D")&&e.jsx($,{players:a.players,role:"Difensore",label:"Difensori",required:8,realTeams:h}),(n==="ALL"||n==="C")&&e.jsx($,{players:a.players,role:"Centrocampista",label:"Centrocampisti",required:8,realTeams:h}),(n==="ALL"||n==="A")&&e.jsx($,{players:a.players,role:"Attaccante",label:"Attaccanti",required:6,realTeams:h})]})]})},S=a=>(a==null?void 0:a.trim())||"Svincolato",J=()=>{const{players:a,loading:h,error:n,realTeams:j}=U(),{user:d}=k(),[N,v]=b.useState([]),[_,E]=b.useState(new Map),[u,r]=b.useState(!0),m=async()=>{try{const s=await D.listDocuments(M,O),t=new Map;s.documents.forEach(o=>{t.set(S(o.manager_name),o)}),E(t)}catch(s){H.error("[TeamsList] Error fetching fantasy teams:",s)}};return b.useEffect(()=>{m()},[]),b.useEffect(()=>{var C;if(!a.length)return;const s=new Map;a.forEach(l=>{const i=S(l.owner||"");i!=="Svincolato"&&(s.has(i)||s.set(i,[]),s.get(i).push(l))}),j.forEach(l=>{var g;const i=S(l.goalkeeper_owner||"");if(i&&i!=="Svincolato"){const p=a.filter(y=>y.team_id===l.$id&&y.position==="Portiere");if(p.length>0&&!s.has(i)&&s.set(i,[]),p.length>0){const y=new Set(((g=s.get(i))==null?void 0:g.map(f=>f.$id))||[]);p.forEach(f=>{y.has(f.$id)||s.get(i).push({...f,quotation:l.goalkeeper_quotation||f.quotation,purchase_price:l.goalkeeper_purchase_price||0})})}}});const t=[];s.forEach((l,i)=>{const g=new Set(l.filter(x=>x.position==="Portiere").map(x=>x.team_id)).size,p=l.filter(x=>x.position==="Difensore").length,y=l.filter(x=>x.position==="Centrocampista").length,f=l.filter(x=>x.position==="Attaccante").length,c=_.get(i),L=l.reduce((x,q)=>x+(q.purchase_price||0),0),P=(c==null?void 0:c.credits_remaining)??0,T=(c==null?void 0:c.budget)??500;t.push({managerName:i,teamName:(c==null?void 0:c.team_name)||`Team ${i}`,logoUrl:c==null?void 0:c.fantasylogo_url,budget:T,spent:L,remaining:P,players:l,isComplete:g===A.P&&p===A.D&&y===A.C&&f===A.A,roleCounts:{P:g,D:p,C:y,A:f},totalPlayers:l.length,teamId:c==null?void 0:c.$id})}),t.sort((l,i)=>{const g=l.managerName.includes("-"),p=i.managerName.includes("-");return g&&!p?1:!g&&p?-1:l.managerName.localeCompare(i.managerName)});const o=((C=d==null?void 0:d.prefs)==null?void 0:C.role)||"user",w=t.filter(l=>{const i=_.get(l.managerName);return!((i==null?void 0:i.role)==="g_admin"&&o!=="g_admin")});v(w),r(!1)},[a,j,_,d]),h||u?e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 gap-4",children:[e.jsx(B,{className:"h-8 w-8 animate-spin text-pl-teal"}),e.jsx("span",{className:"text-gray-400",children:"Caricamento rose..."})]}):n?e.jsx("div",{className:"flex flex-col items-center justify-center h-96 text-red-400",children:e.jsxs("p",{children:["Errore: ",n]})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(F,{className:"text-pl-teal"}),"Rose Fantacalcio"]}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[N.length," squadre registrate"]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:N.map(s=>e.jsx(G,{team:s,realTeams:j},s.managerName))})]})};export{J as TeamsList};
