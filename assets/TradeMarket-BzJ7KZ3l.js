import{c as ne,u as de,r as l,d as g,D as u,h as G,Q as S,H as W,l as Z,I as ze,F as K,J as be,j as e,K as oe,p as Ae,M as Ee,m as me,T as Me,X as ae,t as ve,b as Te,A as se,L as Ne}from"./index-nYsONU7C.js";import{C as re}from"./coins-SCxAJb_u.js";import{P as Be}from"./plus-Bg_ixefD.js";import{H as we}from"./history-DDq3zeGk.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=ne("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=ne("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=ne("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=ne("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Le=()=>{const{user:i}=de(),[f,P]=l.useState([]),[v,B]=l.useState([]),[$,D]=l.useState([]),[p,y]=l.useState([]),[I,N]=l.useState(!0),[z,r]=l.useState(null),d=l.useCallback(async()=>{if(i!=null&&i.$id)try{N(!0),r(null);const c=(await g.listDocuments(u,G,[S.limit(100)])).documents.find(k=>k.manager_name===i.name);if(!c){N(!1);return}const j=c.$id,E=await g.listDocuments(u,W,[S.equal("receiver_team_id",j),S.equal("status","pending"),S.orderDesc("$createdAt")]),R=await g.listDocuments(u,W,[S.equal("proposer_team_id",j),S.equal("status","pending"),S.orderDesc("$createdAt")]),M=await g.listDocuments(u,W,[S.equal("status","accepted"),S.orderDesc("completed_at"),S.limit(50)]),A=M.documents.filter(k=>k.proposer_team_id===j||k.receiver_team_id===j);P(E.documents),B(R.documents),D(A),y(M.documents)}catch(o){Z.error("[useTrades] Error fetching proposals:",o),r(o.message||"Errore nel caricamento proposte")}finally{N(!1)}},[i==null?void 0:i.$id]);l.useEffect(()=>{d()},[d]);const x=async o=>{try{await g.createDocument(u,W,ze.unique(),{...o,status:"pending"}),await d()}catch(c){throw Z.error("[useTrades] Error creating proposal:",c),new Error(c.message||"Errore nella creazione proposta")}},b=async o=>{for(const c of o.proposer_players)await g.updateDocument(u,K,c,{owner:await n(o.receiver_team_id)});for(const c of o.receiver_players)await g.updateDocument(u,K,c,{owner:await n(o.proposer_team_id)});for(const c of o.proposer_gk_blocks){const j=await n(o.receiver_team_id);await g.updateDocument(u,be,c,{goalkeeper_owner:j});const E=await g.listDocuments(u,K,[S.equal("team_id",c),S.equal("position","Portiere")]);for(const R of E.documents)await g.updateDocument(u,K,R.$id,{owner:j})}for(const c of o.receiver_gk_blocks){const j=await n(o.proposer_team_id);await g.updateDocument(u,be,c,{goalkeeper_owner:j});const E=await g.listDocuments(u,K,[S.equal("team_id",c),S.equal("position","Portiere")]);for(const R of E.documents)await g.updateDocument(u,K,R.$id,{owner:j})}if(o.credits_offered!==0){const c=await g.getDocument(u,G,o.proposer_team_id),j=await g.getDocument(u,G,o.receiver_team_id),E=(c.credits_remaining||0)-o.credits_offered,R=(j.credits_remaining||0)+o.credits_offered;await g.updateDocument(u,G,o.proposer_team_id,{credits_remaining:E}),await g.updateDocument(u,G,o.receiver_team_id,{credits_remaining:R})}},n=async o=>(await g.getDocument(u,G,o)).manager_name;return{receivedProposals:f,sentProposals:v,tradeHistory:$,leagueHistory:p,loading:I,error:z,createProposal:x,acceptProposal:async o=>{try{const c=await g.getDocument(u,W,o);await b(c),await g.updateDocument(u,W,o,{status:"accepted",completed_at:new Date().toISOString()}),await d()}catch(c){throw Z.error("[useTrades] Error accepting proposal:",c),new Error(c.message||"Errore nell'accettazione proposta")}},rejectProposal:async o=>{try{await g.updateDocument(u,W,o,{status:"rejected",completed_at:new Date().toISOString()}),await d()}catch(c){throw Z.error("[useTrades] Error rejecting proposal:",c),new Error(c.message||"Errore nel rifiuto proposta")}},cancelProposal:async o=>{try{await g.updateDocument(u,W,o,{status:"cancelled",completed_at:new Date().toISOString()}),await d()}catch(c){throw Z.error("[useTrades] Error cancelling proposal:",c),new Error(c.message||"Errore nella cancellazione proposta")}},refresh:d}},je=({players:i,realTeams:f,ownerName:P,selectedPlayers:v,selectedBlocks:B,onTogglePlayer:$,onToggleBlock:D,disabled:p=!1})=>{const y=l.useMemo(()=>{const r={Portiere:[],Difensore:[],Centrocampista:[],Attaccante:[]};return i.forEach(d=>{r[d.position]&&r[d.position].push(d)}),Object.keys(r).forEach(d=>{r[d].sort((x,b)=>(b.quotation||0)-(x.quotation||0))}),r},[i]),I=l.useMemo(()=>{const r=new Map,d=new Set(f.filter(n=>n.goalkeeper_owner===P).map(n=>n.$id));return i.filter(n=>n.position==="Portiere"&&d.has(n.team_id)).forEach(n=>{if(!r.has(n.team_id)){const w=f.find(_=>_.$id===n.team_id);r.set(n.team_id,{teamId:n.team_id,teamName:n.team_short_name,gks:[],quotation:(w==null?void 0:w.goalkeeper_quotation)||0})}r.get(n.team_id).gks.push(n)}),Array.from(r.values())},[i,f,P]),N=(r,d=!1)=>{const x=v.has(r.$id);return e.jsxs("div",{onClick:()=>!p&&!d&&$(r.$id),className:`flex items-center gap-3 px-3 py-2 transition cursor-pointer border-b border-white/5 last:border-b-0
                    ${x?"bg-pl-teal/20 border-pl-teal/30":"hover:bg-white/5"}
                    ${p?"opacity-50 cursor-not-allowed":""}
                    ${d?"pl-8 opacity-70":""}
                `,children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 transition
                    ${x?"bg-pl-teal border-pl-teal":"border-white/30"}
                `,children:x&&e.jsx(le,{size:12,className:"text-pl-dark"})}),e.jsx("img",{src:r.image_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(r.name)}&background=3d195b&color=fff`,alt:r.name,className:"w-8 h-8 rounded-full object-cover bg-white/10"}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold border ${oe[r.position]||oe.Unknown}`,children:Ee[r.position]||"?"}),e.jsx("span",{className:"flex-1 text-sm text-white truncate",children:r.name}),e.jsx("span",{className:"text-xs text-gray-500",children:r.team_short_name}),e.jsx("span",{className:"text-sm font-mono text-gray-400 w-8 text-right",children:r.quotation})]},r.$id)},z=r=>{const d=B.has(r.teamId),x=r.gks.map(w=>w.$id),n=`https://images.fotmob.com/image_resources/logo/teamlogo/${r.teamId.replace("team_","")}.png`;return e.jsxs("div",{className:"border-b border-white/5 last:border-b-0",children:[e.jsxs("div",{onClick:()=>!p&&D(r.teamId,x),className:`flex items-center gap-3 px-3 py-2 transition cursor-pointer
                        ${d?"bg-pl-teal/20":"hover:bg-white/5"}
                        ${p?"opacity-50 cursor-not-allowed":""}
                    `,children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 transition
                        ${d?"bg-pl-teal border-pl-teal":"border-white/30"}
                    `,children:d&&e.jsx(le,{size:12,className:"text-pl-dark"})}),e.jsx("img",{src:n,alt:r.teamName,className:"w-8 h-8 object-contain",onError:w=>{w.target.src="https://via.placeholder.com/32?text=?"}}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold border ${oe.Portiere}`,children:"P"}),e.jsxs("span",{className:"flex-1 text-sm text-white",children:["Blocco ",r.teamName]}),e.jsx(Ae,{size:14,className:"text-yellow-500"}),e.jsx("span",{className:"text-sm font-mono text-gray-400 w-8 text-right",children:r.quotation})]}),d&&e.jsx("div",{className:"bg-black/20 border-t border-white/5",children:r.gks.map(w=>e.jsxs("div",{className:"flex items-center gap-3 px-3 py-1.5 pl-12 text-xs text-gray-400",children:[e.jsx("img",{src:w.image_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(w.name)}&background=3d195b&color=fff`,alt:w.name,className:"w-6 h-6 rounded-full object-cover bg-white/10"}),e.jsx("span",{className:"flex-1",children:w.name})]},w.$id))})]},r.teamId)};return e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl overflow-hidden",children:[I.length>0&&e.jsxs("div",{className:"border-b border-white/10",children:[e.jsx("div",{className:"px-3 py-2 bg-black/20 text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Portieri (Blocchi)"}),I.map(r=>z(r))]}),y.Difensore.length>0&&e.jsxs("div",{className:"border-b border-white/10",children:[e.jsxs("div",{className:"px-3 py-2 bg-black/20 text-xs font-bold text-gray-400 uppercase tracking-wider",children:["Difensori (",y.Difensore.length,")"]}),y.Difensore.map(r=>N(r))]}),y.Centrocampista.length>0&&e.jsxs("div",{className:"border-b border-white/10",children:[e.jsxs("div",{className:"px-3 py-2 bg-black/20 text-xs font-bold text-gray-400 uppercase tracking-wider",children:["Centrocampisti (",y.Centrocampista.length,")"]}),y.Centrocampista.map(r=>N(r))]}),y.Attaccante.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-3 py-2 bg-black/20 text-xs font-bold text-gray-400 uppercase tracking-wider",children:["Attaccanti (",y.Attaccante.length,")"]}),y.Attaccante.map(r=>N(r))]}),i.length===0&&e.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"Nessun giocatore in rosa"})]})},te=({proposal:i,type:f,proposerName:P,receiverName:v,proposerPlayerNames:B,receiverPlayerNames:$,proposerBlockNames:D,receiverBlockNames:p,onAccept:y,onReject:I,onCancel:N,loading:z=!1})=>{const r=b=>new Date(b).toLocaleDateString("it-IT",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}),d=B.length+D.length,x=$.length+p.length;return e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl overflow-hidden hover:border-white/20 transition",children:[e.jsxs("div",{className:"px-4 py-3 bg-black/20 border-b border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{size:16,className:"text-pl-teal"}),e.jsx("span",{className:"text-sm font-medium text-white",children:f==="received"?`Da ${P}`:f==="sent"?`A ${v}`:`${P} â†” ${v}`})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Me,{size:12}),r(i.$createdAt)]})]}),e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-gray-500 mb-2",children:f==="received"?"Ricevi":"Offre"}),e.jsxs("div",{className:"space-y-1",children:[B.map((b,n)=>e.jsx("div",{className:"text-sm text-white bg-white/5 px-2 py-1 rounded",children:b},n)),D.map((b,n)=>e.jsxs("div",{className:"text-sm text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded flex items-center gap-1",children:["ðŸ§¤ Blocco ",b]},`block-${n}`)),d===0&&e.jsx("div",{className:"text-sm text-gray-500 italic",children:"Nessun giocatore"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-gray-500 mb-2",children:f==="received"?"Dai":"Richiede"}),e.jsxs("div",{className:"space-y-1",children:[$.map((b,n)=>e.jsx("div",{className:"text-sm text-white bg-white/5 px-2 py-1 rounded",children:b},n)),p.map((b,n)=>e.jsxs("div",{className:"text-sm text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded flex items-center gap-1",children:["ðŸ§¤ Blocco ",b]},`block-${n}`)),x===0&&e.jsx("div",{className:"text-sm text-gray-500 italic",children:"Nessun giocatore"})]})]})]}),i.credits_offered!==0&&e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium ${i.credits_offered>0?f==="received"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400":f==="received"?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:[e.jsx(re,{size:14}),f==="received"?i.credits_offered>0?`+${i.credits_offered} crediti`:`${i.credits_offered} crediti`:i.credits_offered>0?`-${i.credits_offered} crediti`:`+${Math.abs(i.credits_offered)} crediti`]})}),f!=="history"&&e.jsxs("div",{className:"px-4 py-3 bg-black/20 border-t border-white/5 flex gap-2 justify-end",children:[f==="received"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:I,disabled:z,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 transition text-sm font-medium disabled:opacity-50",children:[e.jsx(ae,{size:14}),"Rifiuta"]}),e.jsxs("button",{onClick:y,disabled:z,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-green-500/20 text-green-400 hover:bg-green-500/30 transition text-sm font-medium disabled:opacity-50",children:[e.jsx(le,{size:14}),"Accetta"]})]}),f==="sent"&&e.jsxs("button",{onClick:N,disabled:z,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-gray-500/20 text-gray-400 hover:bg-gray-500/30 transition text-sm font-medium disabled:opacity-50",children:[e.jsx(ae,{size:14}),"Annulla"]})]}),f==="history"&&e.jsx("div",{className:"px-4 py-2 bg-green-500/10 border-t border-green-500/20 text-center",children:e.jsxs("span",{className:"text-xs font-bold text-green-400 uppercase",children:["âœ“ Completato il ",r(i.completed_at||i.$updatedAt)]})})]})},Oe=({isOpen:i,onClose:f,onSubmit:P,myTeamId:v,myUserId:B})=>{const{players:$,realTeams:D}=ve(),{user:p}=de(),[y,I]=l.useState([]),[N,z]=l.useState(""),[r,d]=l.useState(new Set),[x,b]=l.useState(new Set),[n,w]=l.useState(new Set),[_,Q]=l.useState(new Set),[o,c]=l.useState(0),[j,E]=l.useState("offer"),[R,M]=l.useState(!1),[A,k]=l.useState(!1),[L,V]=l.useState(null),[Y,ee]=l.useState("my-team"),[J,t]=l.useState([]);l.useEffect(()=>{i&&(async()=>{try{const m=(await g.listDocuments(u,G,[S.limit(100)])).documents.filter(q=>q.role!=="g_admin");t(m),I(m.filter(q=>q.$id!==v))}catch(a){console.error("Error fetching teams:",a)}})()},[i,v]);const h=l.useMemo(()=>{const s=J.find(a=>a.$id===v)||{manager_name:(p==null?void 0:p.name)||""};return $.filter(a=>a.owner===s.manager_name||a.owner===(p==null?void 0:p.name))},[$,v,J,p]),T=l.useMemo(()=>{const s=J.find(a=>a.$id===v);return(s==null?void 0:s.credits_remaining)||0},[J,v]),C=l.useMemo(()=>y.find(s=>s.$id===N),[y,N]),O=l.useMemo(()=>C?$.filter(s=>s.owner===C.manager_name):[],[$,C]),xe=(s,a)=>{const m={D:0,C:0,A:0};return s.forEach(q=>{const U=a.find(De=>De.$id===q);U&&(U.position==="Difensore"?m.D++:U.position==="Centrocampista"?m.C++:U.position==="Attaccante"&&m.A++)}),m},H=xe(r,h),F=xe(n,O),pe=r.size+x.size,he=n.size+_.size,fe=H.D===F.D&&H.C===F.C&&H.A===F.A&&x.size===_.size,ge=r.size>0||x.size>0||n.size>0||_.size>0,_e=fe&&ge&&r.size+x.size>0&&n.size+_.size>0,X=j==="offer"?o:-o,ue=j==="offer"?o<=T:o<=((C==null?void 0:C.credits_remaining)||0),ke=s=>{const a=new Set(r);a.has(s)?a.delete(s):a.add(s),d(a)},Se=(s,a)=>{const m=new Set(x);m.has(s)?m.delete(s):m.add(s),b(m)},$e=s=>{const a=new Set(n);a.has(s)?a.delete(s):a.add(s),w(a)},Ce=(s,a)=>{const m=new Set(_);m.has(s)?m.delete(s):m.add(s),Q(m)},Pe=async()=>{if(!C)return;const s={proposer_user_id:B,receiver_user_id:"",proposer_team_id:v,receiver_team_id:N,proposer_players:Array.from(r).filter(a=>!Array.from(x).some(m=>{var q;return((q=$.find(U=>U.$id===a))==null?void 0:q.team_id)===m})),receiver_players:Array.from(n).filter(a=>!Array.from(_).some(m=>{var q;return((q=$.find(U=>U.$id===a))==null?void 0:q.team_id)===m})),proposer_gk_blocks:Array.from(x),receiver_gk_blocks:Array.from(_),credits_offered:X};try{k(!0),V(null),await P(s),ie()}catch(a){V(a.message||"Errore nell'invio proposta")}finally{k(!1)}},ie=()=>{z(""),d(new Set),b(new Set),w(new Set),Q(new Set),c(0),E("offer"),M(!1),V(null),f()};return i?Te.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:ie}),e.jsxs("div",{className:"relative w-full max-w-6xl h-[80vh] md:h-auto md:max-h-[90vh] bg-[#18181b] rounded-2xl border border-white/10 shadow-2xl overflow-hidden flex flex-col",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10 bg-black/20 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"text-pl-teal",size:20}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Nuovo Scambio"})]}),e.jsx("button",{onClick:ie,className:"p-2 hover:bg-white/10 rounded-lg transition text-gray-400 hover:text-white",children:e.jsx(ae,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex md:hidden border-b border-white/10 shrink-0",children:[e.jsxs("button",{onClick:()=>ee("my-team"),className:`flex-1 py-3 text-sm font-bold text-center border-b-2 transition ${Y==="my-team"?"border-pl-teal text-white bg-white/5":"border-transparent text-gray-500"}`,children:["La Mia Rosa ",pe>0&&e.jsxs("span",{className:"ml-1 text-pl-teal",children:["(",pe,")"]})]}),e.jsxs("button",{onClick:()=>ee("opponent-team"),className:`flex-1 py-3 text-sm font-bold text-center border-b-2 transition ${Y==="opponent-team"?"border-pl-teal text-white bg-white/5":"border-transparent text-gray-500"}`,children:["Altro Partecipante ",he>0&&e.jsxs("span",{className:"ml-1 text-pl-teal",children:["(",he,")"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col md:flex-row relative",children:[e.jsxs("div",{className:`flex-1 flex-col border-r border-white/10 overflow-hidden ${Y==="my-team"?"flex":"hidden md:flex"}`,children:[e.jsxs("div",{className:"px-4 py-3 bg-pl-teal/10 border-b border-white/5 flex-shrink-0 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white",children:"La Mia Rosa"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Seleziona i giocatori da offrire"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-black/30 rounded-lg",children:[e.jsx(re,{size:14,className:"text-pl-teal"}),e.jsx("span",{className:"text-sm font-mono font-bold text-pl-teal",children:T})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx(je,{players:h,realTeams:D,ownerName:(p==null?void 0:p.name)||"",selectedPlayers:r,selectedBlocks:x,onTogglePlayer:ke,onToggleBlock:Se})})]}),e.jsxs("div",{className:`flex-1 flex-col overflow-hidden ${Y==="opponent-team"?"flex":"hidden md:flex"}`,children:[e.jsxs("div",{className:"px-4 py-3 bg-black/20 border-b border-white/5 flex-shrink-0 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"inline-flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4 text-gray-400 pointer-events-none",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),e.jsxs("select",{value:N,onChange:s=>{z(s.target.value),w(new Set),Q(new Set)},className:"bg-transparent text-white text-base font-bold focus:outline-none cursor-pointer appearance-none",children:[e.jsx("option",{value:"",children:"Seleziona partecipante..."}),y.filter(s=>s.$id!==v&&s.manager_name!==(p==null?void 0:p.name)&&s.user_id!==B).map(s=>e.jsxs("option",{value:s.$id,children:[s.manager_name," - ",s.team_name]},s.$id))]})]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Seleziona i giocatori da richiedere"})]}),C&&e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-black/30 rounded-lg",children:[e.jsx(re,{size:14,className:"text-pl-teal"}),e.jsx("span",{className:"text-sm font-mono font-bold text-pl-teal",children:C.credits_remaining})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:N?e.jsx(je,{players:O,realTeams:D,ownerName:(C==null?void 0:C.manager_name)||"",selectedPlayers:n,selectedBlocks:_,onTogglePlayer:$e,onToggleBlock:Ce}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Seleziona un partecipante per vedere la sua rosa"})})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-white/10 bg-black/20 flex-shrink-0",children:[e.jsx("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{size:16,className:"text-pl-teal"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Crediti:"}),e.jsxs("div",{className:"flex rounded-lg overflow-hidden border border-white/20",children:[e.jsx("button",{onClick:()=>E("offer"),className:`px-3 py-1.5 text-xs font-bold transition ${j==="offer"?"bg-red-500/30 text-red-400":"bg-white/5 text-gray-400 hover:bg-white/10"}`,children:"Offri"}),e.jsx("button",{onClick:()=>E("request"),className:`px-3 py-1.5 text-xs font-bold transition ${j==="request"?"bg-green-500/30 text-green-400":"bg-white/5 text-gray-400 hover:bg-white/10"}`,children:"Richiedi"})]}),e.jsx("input",{type:"number",min:"0",value:o===0?"":o,onChange:s=>c(s.target.value===""?0:Math.abs(parseInt(s.target.value))||0),className:"w-20 bg-white/10 border border-white/20 rounded-lg px-3 py-1.5 text-white text-sm text-center focus:border-pl-teal outline-none",placeholder:"0"})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[ge&&!fe&&e.jsxs("div",{className:"flex items-center gap-1.5 text-yellow-400 text-sm flex-wrap",children:[e.jsx(se,{size:14,className:"flex-shrink-0"}),e.jsxs("span",{children:["Ruoli non bilanciati:",H.D!==F.D&&` D(${H.D}â†”${F.D})`,H.C!==F.C&&` C(${H.C}â†”${F.C})`,H.A!==F.A&&` A(${H.A}â†”${F.A})`,x.size!==_.size&&` P(${x.size}â†”${_.size})`]})]}),!ue&&e.jsxs("div",{className:"flex items-center gap-1.5 text-red-400 text-sm",children:[e.jsx(se,{size:14}),"Crediti insufficienti"]}),L&&e.jsxs("div",{className:"flex items-center gap-1.5 text-red-400 text-sm",children:[e.jsx(se,{size:14}),L]})]}),e.jsxs("button",{onClick:()=>M(!0),disabled:!_e||!ue||!N||A,className:"flex items-center gap-2 px-6 py-2.5 rounded-xl bg-pl-teal text-pl-dark font-bold hover:bg-pl-teal/90 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ce,{size:16}),"Invia Proposta"]})]})]}),R&&e.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-10",children:e.jsxs("div",{className:"bg-[#18181b] border border-white/20 rounded-xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Conferma Proposta"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-red-400 mb-2",children:"Offri"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[Array.from(r).map(s=>{const a=h.find(m=>m.$id===s);return a?e.jsxs("div",{className:"flex items-center gap-2 bg-white/5 px-2 py-1 rounded",children:[e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${a.position==="Difensore"?"bg-blue-500/30 text-blue-400":a.position==="Centrocampista"?"bg-green-500/30 text-green-400":"bg-red-500/30 text-red-400"}`,children:a.position==="Difensore"?"D":a.position==="Centrocampista"?"C":"A"}),e.jsx("span",{className:"text-white",children:a.name})]},s):null}),Array.from(x).map(s=>{const a=D.find(m=>m.$id===s);return e.jsxs("div",{className:"flex items-center gap-2 bg-yellow-500/10 px-2 py-1 rounded text-yellow-400",children:[e.jsx("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded bg-yellow-500/30",children:"P"}),"Blocco ",(a==null?void 0:a.short_name)||"Squadra"]},s)}),X>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-500/10 px-2 py-1 rounded text-green-400",children:["ðŸ’° +",X," crediti"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-green-400 mb-2",children:"Richiedi"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[Array.from(n).map(s=>{const a=O.find(m=>m.$id===s);return a?e.jsxs("div",{className:"flex items-center gap-2 bg-white/5 px-2 py-1 rounded",children:[e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${a.position==="Difensore"?"bg-blue-500/30 text-blue-400":a.position==="Centrocampista"?"bg-green-500/30 text-green-400":"bg-red-500/30 text-red-400"}`,children:a.position==="Difensore"?"D":a.position==="Centrocampista"?"C":"A"}),e.jsx("span",{className:"text-white",children:a.name})]},s):null}),Array.from(_).map(s=>{const a=D.find(m=>m.$id===s);return e.jsxs("div",{className:"flex items-center gap-2 bg-yellow-500/10 px-2 py-1 rounded text-yellow-400",children:[e.jsx("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded bg-yellow-500/30",children:"P"}),"Blocco ",(a==null?void 0:a.short_name)||"Squadra"]},s)}),X<0&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-500/10 px-2 py-1 rounded text-green-400",children:["ðŸ’° +",Math.abs(X)," crediti"]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>M(!1),className:"px-4 py-2 rounded-lg bg-white/10 text-gray-300 hover:bg-white/20 transition",children:"Annulla"}),e.jsxs("button",{onClick:Pe,disabled:A,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-pl-teal text-pl-dark font-bold hover:bg-pl-teal/90 transition disabled:opacity-50",children:[A?e.jsx(Ne,{size:16,className:"animate-spin"}):e.jsx(ce,{size:16}),"Conferma"]})]})]})})]})]}),document.body):null},Ue=()=>{const{user:i}=de(),{receivedProposals:f,sentProposals:P,tradeHistory:v,leagueHistory:B,loading:$,error:D,createProposal:p,acceptProposal:y,rejectProposal:I,cancelProposal:N}=Le(),{players:z}=ve(),[r,d]=l.useState(!1),[x,b]=l.useState(!1),[n,w]=l.useState(""),[_,Q]=l.useState(new Map),[o,c]=l.useState(new Map),[j,E]=l.useState(new Map),[R,M]=l.useState(null);l.useEffect(()=>{(async()=>{try{const h=await g.listDocuments(u,G,[S.limit(100)]),T=new Map;h.documents.forEach(O=>{T.set(O.$id,O),O.user_id&&T.set(O.user_id,O)}),Q(T);const C=h.documents.find(O=>O.manager_name===(i==null?void 0:i.name));C&&w(C.$id)}catch(h){console.error("Error fetching fantasy teams:",h)}})()},[i==null?void 0:i.name]),l.useEffect(()=>{const t=new Map;z.forEach(T=>t.set(T.$id,T.name)),c(t);const h=new Map;z.forEach(T=>{h.has(T.team_id)||h.set(T.team_id,T.team_short_name)}),E(h)},[z]);const A=t=>{var h;return((h=_.get(t))==null?void 0:h.manager_name)||"Sconosciuto"},k=t=>t.map(h=>o.get(h)||"Giocatore sconosciuto"),L=t=>t.map(h=>j.get(h)||"Squadra"),V=async t=>{M(t);try{await y(t)}catch(h){console.error("Error accepting:",h)}finally{M(null)}},Y=async t=>{M(t);try{await I(t)}catch(h){console.error("Error rejecting:",h)}finally{M(null)}},ee=async t=>{M(t);try{await N(t)}catch(h){console.error("Error cancelling:",h)}finally{M(null)}},J=async t=>{await p(t)};return $?e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 gap-4",children:[e.jsx(Ne,{className:"h-8 w-8 animate-spin text-pl-teal"}),e.jsx("span",{className:"text-gray-400",children:"Caricamento mercato scambi..."})]}):e.jsxs("div",{className:"w-full px-4 md:px-12 lg:px-24 xl:px-32 container mx-auto pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-8 mt-6 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(me,{className:"text-pl-teal"}),"Mercato Scambi"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Proponi e gestisci scambi con altri partecipanti"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-pl-teal text-pl-dark font-bold hover:bg-pl-teal/90 transition flex-1 md:flex-none",children:[e.jsx(Be,{size:20}),"Nuovo Scambio"]}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white font-bold hover:bg-white/10 transition flex-none",children:[e.jsx(ye,{size:20,className:"text-blue-400"}),e.jsx("span",{className:"hidden md:inline",children:"Storico Lega"})]})]})]}),D&&e.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-xl flex items-center gap-3 text-red-400",children:[e.jsx(se,{size:20}),D]}),e.jsxs("section",{className:"mb-8",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2 mb-4",children:[e.jsx(Re,{size:20,className:"text-green-400"}),"Proposte Ricevute",f.length>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-green-500/20 text-green-400 text-xs font-bold rounded-full",children:f.length})]}),f.length===0?e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-xl p-8 text-center text-gray-500",children:"Nessuna proposta ricevuta"}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:f.map(t=>e.jsx(te,{proposal:t,type:"received",proposerName:A(t.proposer_team_id),receiverName:A(t.receiver_team_id),proposerPlayerNames:k(t.proposer_players),receiverPlayerNames:k(t.receiver_players),proposerBlockNames:L(t.proposer_gk_blocks),receiverBlockNames:L(t.receiver_gk_blocks),onAccept:()=>V(t.$id),onReject:()=>Y(t.$id),loading:R===t.$id},t.$id))})]}),e.jsxs("section",{className:"mb-8",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2 mb-4",children:[e.jsx(ce,{size:20,className:"text-blue-400"}),"Proposte Inviate",P.length>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-500/20 text-blue-400 text-xs font-bold rounded-full",children:P.length})]}),P.length===0?e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-xl p-8 text-center text-gray-500",children:"Nessuna proposta inviata"}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:P.map(t=>e.jsx(te,{proposal:t,type:"sent",proposerName:A(t.proposer_team_id),receiverName:A(t.receiver_team_id),proposerPlayerNames:k(t.proposer_players),receiverPlayerNames:k(t.receiver_players),proposerBlockNames:L(t.proposer_gk_blocks),receiverBlockNames:L(t.receiver_gk_blocks),onCancel:()=>ee(t.$id),loading:R===t.$id},t.$id))})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2 mb-4",children:[e.jsx(we,{size:20,className:"text-gray-400"}),"Storico Scambi"]}),v.length===0?e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-xl p-8 text-center text-gray-500",children:"Nessuno scambio completato"}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:v.map(t=>e.jsx(te,{proposal:t,type:"history",proposerName:A(t.proposer_team_id),receiverName:A(t.receiver_team_id),proposerPlayerNames:k(t.proposer_players),receiverPlayerNames:k(t.receiver_players),proposerBlockNames:L(t.proposer_gk_blocks),receiverBlockNames:L(t.receiver_gk_blocks)},t.$id))})]}),e.jsx(Oe,{isOpen:r,onClose:()=>d(!1),onSubmit:J,myTeamId:n,myUserId:(i==null?void 0:i.$id)||""}),x&&e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:()=>b(!1)}),e.jsxs("div",{className:"relative bg-[#18181b] w-full max-w-4xl h-[80vh] rounded-2xl border border-white/10 shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in-95 duration-200",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-white/10 bg-black/20 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(ye,{className:"text-blue-400"}),"Storico Scambi Lega"]}),e.jsx("button",{onClick:()=>b(!1),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white transition",children:e.jsx(ae,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-[#18181b]",children:B.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500 italic",children:[e.jsx(we,{size:32,className:"mb-2 opacity-50"}),"Nessuno scambio concluso nella lega"]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:B.map(t=>e.jsx(te,{proposal:t,type:"history",proposerName:A(t.proposer_team_id),receiverName:A(t.receiver_team_id),proposerPlayerNames:k(t.proposer_players),receiverPlayerNames:k(t.receiver_players),proposerBlockNames:L(t.proposer_gk_blocks),receiverBlockNames:L(t.receiver_gk_blocks)},t.$id))})})]})]})]})};export{Ue as TradeMarket};
