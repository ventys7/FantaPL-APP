import{c as u,u as q,r as o,d as c,D as d,g as m,Q as H,j as e,h as O,P as V,f as B,I as A}from"./index-D11w6Mer.js";import{L as K}from"./lock-D8JXJvVO.js";import{T as Q,C as F}from"./trash-2-BtSsIq01.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=u("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=u("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=u("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=u("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function se(){var k;const{user:n}=q(),[$,I]=o.useState([]),[X,y]=o.useState(!0),[R,x]=o.useState(!1),[i,S]=o.useState({key:"name",direction:"asc"}),[p,f]=o.useState(""),[g,j]=o.useState(""),[v,N]=o.useState(""),[C,D]=o.useState("user");o.useEffect(()=>{h()},[]);const h=async()=>{y(!0);try{const s=(await c.listDocuments(d,m,[H.limit(100)])).documents.map(a=>({$id:a.user_id||a.$id,name:a.manager_name,email:"N/A",status:!a.hidden,prefs:{role:a.role,teamId:a.$id}}));I(s)}catch(t){console.error("Error loading participants:",t)}finally{y(!1)}},w=t=>{let s="asc";i.key===t&&i.direction==="asc"&&(s="desc"),S({key:t,direction:s})},U=()=>{const t=[...$];return t.sort((s,a)=>{let r,l;return i.key==="role"?(r=s.prefs.role||"",l=a.prefs.role||""):i.key==="status"?(r=s.status?1:0,l=a.status?1:0):(r=s[i.key],l=a[i.key]),r<l?i.direction==="asc"?-1:1:r>l?i.direction==="asc"?1:-1:0}),t},z=async t=>{t.preventDefault();try{const s=`${g.toLowerCase().replace(/\s+/g,"")}@fantapl.app`,a=await B.create(A.unique(),s,v,p);await c.createDocument(d,m,A.unique(),{user_id:a.$id,manager_name:p,team_name:`Squadra di ${p}`,credits_remaining:500,role:C,hidden:!1,force_pass_reset:!0}),alert(`Utente ${p} creato con successo! Username: ${g}`),x(!1),f(""),j(""),N(""),h()}catch(s){console.error(s),s.code===409?alert("ERRORE: Questo Username o Email esiste già nel sistema Auth di Appwrite. Cambia username o elimina l'utente dalla Console di Appwrite."):alert(`Errore creazione: ${s.message}`)}},P=async(t,s)=>{if(confirm(`Sei sicuro di voler eliminare il profilo di ${s}?`))try{await c.deleteDocument(d,m,t),alert("Profilo database eliminato. Ricordati di rimuovere l'utente anche dalla Console Appwrite (Auth) per liberare l'username."),h()}catch(a){console.error(a),alert(`Errore eliminazione: ${a.message}`)}},E=async(t,s)=>{if(confirm(`Vuoi forzare il cambio password per ${s} al prossimo login?`))try{await c.updateDocument(d,m,t,{force_pass_reset:!0}),alert(`Reset impostato. ${s} dovrà cambiare password al prossimo login.`)}catch(a){console.error(a),alert(`Errore reset: ${a.message}`)}},L=async(t,s,a)=>{try{await c.updateDocument(d,m,t,{role:s}),alert(`Ruolo di ${a} aggiornato a ${s.toUpperCase()}`),h()}catch(r){alert(`Errore aggiornamento ruolo: ${r.message}`)}},_=async(t,s,a)=>{const r=s;try{await c.updateDocument(d,m,t,{hidden:r}),alert(`Account di ${a} ${r?"DISABILITATO":"RIABILITATO"}.`),h()}catch(l){alert(`Errore cambio stato: ${l.message}`)}},M=async(t,s)=>{const a=prompt("Nuovo nome per il manager:",s);if(!(!a||a===s))try{await c.updateDocument(d,m,t,{manager_name:a}),h()}catch(r){alert(`Errore rinomina: ${r.message}`)}},b=({colKey:t})=>i.key!==t?e.jsx("div",{className:"w-4 h-4 opacity-0"}):i.direction==="asc"?e.jsx(G,{size:14}):e.jsx(F,{size:14}),T=U();return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Gestione Partecipanti"}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 bg-pl-teal text-white px-4 py-2 rounded-lg hover:bg-pl-teal/80 transition",children:[e.jsx(W,{size:20}),"Nuovo Partecipante"]})]}),((k=n==null?void 0:n.name)==null?void 0:k.toLowerCase())==="admin"&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 p-4 rounded-lg mb-6 text-sm text-yellow-200",children:[e.jsxs("h4",{className:"font-bold flex items-center gap-2 mb-1",children:[e.jsx(O,{size:16})," Note Importanti per l'Admin"]}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 opacity-90",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Reset Password:"})," Imposta solo l'obbligo di cambio. Se l'utente ha ",e.jsx("em",{children:"dimenticato"})," la password, devi ",e.jsx("strong",{children:"Eliminare e Ricreare"})," l'utente (limitazione di sicurezza)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Eliminazione:"})," Rimuove solo il Profilo (Dati Fanta). Devi rimuovere manualmente l'account di Login (Auth) dalla Console Appwrite per riusare lo username."]})]})]}),R&&e.jsxs("div",{className:"bg-white/5 border border-white/20 rounded-xl p-6 mb-8 animate-fade-in",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Nuovo Utente"}),e.jsxs("form",{onSubmit:z,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Nome Manager (es. Paolo)",value:p,onChange:t=>f(t.target.value),className:"bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white",required:!0}),e.jsx("input",{type:"text",placeholder:"Username Login (es. paolo)",value:g,onChange:t=>j(t.target.value),className:"bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white",required:!0}),e.jsx("input",{type:"password",placeholder:"Password Provvisoria",value:v,onChange:t=>N(t.target.value),className:"bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white",required:!0}),e.jsxs("select",{value:C,onChange:t=>D(t.target.value),className:"bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white",children:[e.jsx("option",{value:"user",children:"Utente"}),e.jsx("option",{value:"helper",children:"Helper"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsxs("div",{className:"md:col-span-2 flex justify-end gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:"px-4 py-2 text-gray-300 hover:text-white",children:"Annulla"}),e.jsx("button",{type:"submit",className:"bg-green-500/20 text-green-400 border border-green-500/50 px-6 py-2 rounded-lg hover:bg-green-500/30",children:"Crea Utente"})]})]})]}),e.jsx("div",{className:"bg-white/5 border border-white/20 rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-black/20 text-gray-400 uppercase text-sm",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"p-4 cursor-pointer hover:text-white transition flex items-center gap-1",onClick:()=>w("name"),children:["Manager ",e.jsx(b,{colKey:"name"})]}),e.jsx("th",{className:"p-4 cursor-pointer hover:text-white transition",onClick:()=>w("role"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Ruolo ",e.jsx(b,{colKey:"role"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:text-white transition",onClick:()=>w("status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Stato ",e.jsx(b,{colKey:"status"})]})}),e.jsx("th",{className:"p-4 text-right",children:"Azioni"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:T.filter(t=>{var s;return t.name.toLowerCase()!=="admin"||((s=n==null?void 0:n.name)==null?void 0:s.toLowerCase())==="admin"}).map(t=>{var s,a;return e.jsxs("tr",{className:"hover:bg-white/5 transition",children:[e.jsxs("td",{className:"p-4 font-medium text-white",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:t.name}),e.jsxs("details",{className:"text-xs text-gray-500 cursor-pointer select-none",children:[e.jsx("summary",{className:"hover:text-gray-300 transition-colors",children:"Mostra ID"}),e.jsx("span",{className:"select-all font-mono bg-black/30 px-1 rounded",children:t.$id})]})]}),((s=t.prefs)==null?void 0:s.teamId)===((a=n==null?void 0:n.prefs)==null?void 0:a.teamId)&&e.jsx("span",{className:"ml-2 text-xs text-pl-teal",children:"(Tu)"})]}),e.jsx("td",{className:"p-4",children:e.jsxs("select",{value:t.prefs.role,onChange:r=>L(t.prefs.teamId,r.target.value,t.name),className:"bg-black/20 border border-white/10 rounded px-2 py-1 text-sm text-gray-300 focus:text-white",children:[e.jsx("option",{value:"user",children:"Utente"}),e.jsx("option",{value:"helper",children:"Helper"}),e.jsx("option",{value:"admin",children:"Admin"})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium border ${t.status?"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border-red-500/20"}`,children:t.status?"Attivo":"Non Attivo"})}),e.jsxs("td",{className:"p-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>_(t.prefs.teamId,t.status,t.name),className:`p-2 hover:bg-white/10 rounded-lg ${t.status?"text-orange-400":"text-green-400"}`,title:t.status?"Disabilita Account":"Riabilita Account",children:t.status?e.jsx(K,{size:16}):e.jsx(J,{size:16})}),e.jsx("button",{onClick:()=>M(t.prefs.teamId,t.name),className:"p-2 hover:bg-white/10 rounded-lg text-yellow-400",title:"Rinomina Manager",children:e.jsx(V,{size:16})}),e.jsx("button",{onClick:()=>E(t.prefs.teamId,t.name),className:"p-2 hover:bg-white/10 rounded-lg text-blue-400",title:"Imposta Reset Password al login",children:e.jsx(Y,{size:16})}),e.jsx("button",{onClick:()=>P(t.prefs.teamId,t.name),className:"p-2 hover:bg-white/10 rounded-lg text-red-400",title:"Elimina Profilo (Richiede anche delete Auth)",children:e.jsx(Q,{size:16})})]})]},t.$id)})})]})})]})}export{se as ParticipantManagement};
