import{t as ee,r as o,j as e,L as R,b as A,m as te,p as z,o as se,P as ae,X as O,S as re,d as x,D as p,i as oe,Q as u,v as q}from"./index-DX6niFWW.js";const F="real_teams",B=["Portiere","Difensore","Centrocampista","Attaccante"],Q={Portiere:1,Difensore:2,Centrocampista:3,Attaccante:4},le="695842e1003a3db19fea",ne=()=>{const{players:$,loading:G,refresh:I,teams:Y}=ee(),[y,k]=o.useState([]);o.useEffect(()=>{k($)},[$]);const[_,U]=o.useState([]),[c,D]=o.useState(null),[X,E]=o.useState(!1),[C,P]=o.useState(!1),[H,g]=o.useState([]),[r,d]=o.useState({}),[f,J]=o.useState(""),[j,K]=o.useState("Tutti"),[w,V]=o.useState("Tutti"),[m,W]=o.useState("Tutti"),[T,L]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const a=(await x.listDocuments(p,oe,[u.limit(100),u.equal("hidden",!1)])).documents.filter(l=>l.user_id!==le).map(l=>({name:l.manager_name,id:l.$id}));U(a)}catch(s){console.error("Error fetching managers:",s)}})()},[]),o.useEffect(()=>{if(!C)return;(async()=>{try{const s=await x.listDocuments(p,F,[u.limit(50)]);g(s.documents)}catch(s){console.error("Error fetching teams:",s)}})()},[C]);const S=async(t,s,a,l)=>{try{await x.updateDocument(p,F,t,{goalkeeper_owner:s,goalkeeper_quotation:a,goalkeeper_purchase_price:l});const N=(await x.listDocuments(p,q,[u.equal("team_id",t),u.equal("position","Portiere"),u.limit(10)])).documents.map(b=>x.updateDocument(p,q,b.$id,{owner:s}));await Promise.all(N),g(b=>b.map(n=>n.$id===t?{...n,goalkeeper_owner:s,goalkeeper_quotation:a,goalkeeper_purchase_price:l}:n)),k(b=>b.map(n=>n.team_id===t&&n.position==="Portiere"?{...n,owner:s}:n))}catch(i){console.error("Error saving block:",i),alert("Errore salvataggio blocco: "+i.message)}},M=t=>{D(t),d({position:t.position,quotation:t.quotation||0,purchase_price:t.purchase_price||0,owner:t.owner||""}),E(!0)},v=()=>{E(!1),D(null),d({})},Z=async()=>{if(!c)return;L(!0);const t={position:r.position,quotation:parseInt(r.quotation),purchase_price:parseInt(r.purchase_price),owner:r.owner===""?null:r.owner};({...c,...t},k(s=>s.map(a=>a.$id===c.$id?{...a,...t}:a))),v();try{await x.updateDocument(p,q,c.$id,t)}catch(s){console.error("Save error:",s),alert(`Errore salvataggio: ${s.message}`),I()}finally{L(!1)}},h=o.useMemo(()=>y.filter(s=>{if(f&&!s.name.toLowerCase().includes(f.toLowerCase())||j!=="Tutti"&&s.team_short_name!==j||w!=="Tutti"&&s.position!==w)return!1;if(m!=="Tutti"){if(m==="Svincolati"){if(s.owner)return!1}else if(s.owner!==m)return!1}return!0}).sort((s,a)=>{const l=(Q[s.position]||99)-(Q[a.position]||99);if(l!==0)return l;const i=(s.team_short_name||"").localeCompare(a.team_short_name||"");if(i!==0)return i;const N=(a.quotation||0)-(s.quotation||0);return N!==0?N:s.name.localeCompare(a.name)}),[y,f,j,w,m]);return G&&y.length===0?e.jsx("div",{className:"flex justify-center p-10",children:e.jsx(R,{className:"animate-spin text-pl-teal"})}):e.jsxs("div",{className:"p-4 md:p-8 max-w-full mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center text-center gap-2 mb-8",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-white flex items-center justify-center gap-3",children:[e.jsx(te,{className:"text-pl-teal w-8 h-8"}),"Gestione Listone"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1 max-w-md mx-auto",children:"Modifica ruoli, quotazioni e proprietari. Le modifiche sono istantanee."}),e.jsxs("button",{onClick:()=>P(!0),className:"mt-4 flex items-center gap-2 px-4 py-2 bg-pl-teal/10 text-pl-teal rounded-xl text-xs font-bold uppercase tracking-wider hover:bg-pl-teal/20 transition border border-pl-teal/20",children:[e.jsx(z,{size:14}),"Gestione Blocchi Portieri"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-2 mt-4 w-full max-w-2xl justify-center",children:[e.jsxs("div",{className:"relative group w-full md:w-auto",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-hover:text-pl-teal transition-colors w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Cerca...",value:f,onChange:t=>J(t.target.value),className:"h-[42px] bg-black/30 border border-white/10 rounded-xl pl-9 pr-4 text-sm text-white w-full md:w-56 focus:border-pl-teal/50 outline-none transition-all placeholder-gray-600 focus:bg-black/50"})]}),e.jsxs("select",{value:w,onChange:t=>V(t.target.value),className:"h-[42px] bg-black/30 border border-white/10 rounded-xl px-4 text-sm text-gray-300 outline-none hover:bg-black/40 transition cursor-pointer",children:[e.jsx("option",{value:"Tutti",children:"Tutti i Ruoli"}),B.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:j,onChange:t=>K(t.target.value),className:"h-[42px] bg-black/30 border border-white/10 rounded-xl px-4 text-sm text-gray-300 outline-none hover:bg-black/40 transition cursor-pointer",children:[e.jsx("option",{value:"Tutti",children:"Tutte le Squadre"}),Y.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:m,onChange:t=>W(t.target.value),className:"h-[42px] bg-black/30 border border-white/10 rounded-xl px-4 text-sm text-gray-300 outline-none hover:bg-black/40 transition cursor-pointer",children:[e.jsx("option",{value:"Tutti",children:"Tutti i Proprietari"}),e.jsx("option",{value:"Svincolati",children:"Svincolati"}),_.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]})]}),e.jsx("div",{className:"hidden md:block bg-[#1e1e24] border border-white/5 rounded-2xl overflow-hidden shadow-2xl max-w-6xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-base",children:[e.jsx("thead",{className:"bg-black/40 text-gray-400 font-bold uppercase text-sm tracking-wider sticky top-0 backdrop-blur-sm z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Giocatore"}),e.jsx("th",{className:"px-6 py-4 w-40",children:"Ruolo"}),e.jsx("th",{className:"px-6 py-4 w-32 text-center",children:"Quotazione"}),e.jsx("th",{className:"px-6 py-4 w-32 text-center",children:"Prezzo"}),e.jsx("th",{className:"px-6 py-4 w-56",children:"Proprietario"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-10 text-center text-gray-500 italic",children:"Nessun giocatore trovato"})}):h.slice(0,150).map(t=>e.jsxs("tr",{onClick:()=>M(t),className:"hover:bg-white/[0.03] transition-colors cursor-pointer group",children:[e.jsx("td",{className:"px-6 py-3",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-white group-hover:text-pl-teal transition-colors text-base",children:t.name}),e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide font-medium",children:t.team_short_name})]})})}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:`px-2.5 py-1 rounded-md text-xs uppercase font-bold tracking-widest border border-current opacity-80
                                                ${t.position==="Portiere"?"text-yellow-500 border-yellow-500/20 bg-yellow-500/10":t.position==="Difensore"?"text-blue-500 border-blue-500/20 bg-blue-500/10":t.position==="Centrocampista"?"text-green-500 border-green-500/20 bg-green-500/10":"text-red-500 border-red-500/20 bg-red-500/10"}`,children:t.position})}),e.jsx("td",{className:"px-6 py-3 text-center",children:e.jsx("span",{className:"text-gray-300 font-mono text-base",children:t.quotation})}),e.jsx("td",{className:"px-6 py-3 text-center",children:e.jsx("span",{className:`font-mono text-base ${t.purchase_price>0?"text-pl-teal font-bold":"text-gray-600"}`,children:t.purchase_price||"-"})}),e.jsx("td",{className:"px-6 py-3",children:t.owner?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-pl-teal shadow-[0_0_8px_rgba(56,189,248,0.5)]"}),e.jsx("span",{className:"text-sm text-white font-medium",children:t.owner})]}):e.jsx("span",{className:"text-sm text-gray-600 italic",children:"Svincolato"})})]},t.$id))})]})})})]}),e.jsxs("div",{className:"md:hidden space-y-3 pb-20",children:[h.length===0?e.jsx("div",{className:"text-center text-gray-500 py-10 bg-white/5 rounded-xl border border-white/5",children:"Nessun risultato"}):h.slice(0,50).map(t=>e.jsxs("div",{onClick:()=>M(t),className:"bg-[#1e1e24] border border-white/5 rounded-xl p-4 active:scale-[0.98] transition-all cursor-pointer shadow-lg relative overflow-hidden",children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${t.position==="Portiere"?"bg-yellow-500":t.position==="Difensore"?"bg-blue-500":t.position==="Centrocampista"?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{className:"flex justify-between items-start pl-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold text-base flex items-center gap-2",children:t.name}),e.jsx("div",{className:"text-[11px] text-gray-400 font-medium uppercase tracking-wide mt-0.5 mb-1",children:t.team_short_name}),e.jsx("div",{className:"flex items-center gap-2 mt-1"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider",children:"Prezzo"}),e.jsx("div",{className:`font-mono font-bold ${t.purchase_price>0?"text-pl-teal":"text-gray-600"}`,children:t.purchase_price||"-"})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/5 flex items-center justify-between pl-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Quotazione"}),e.jsx("span",{className:"text-sm text-white font-mono",children:t.quotation})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Proprietario"}),t.owner?e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-pl-teal shadow-[0_0_6px_rgba(56,189,248,0.5)]"}),e.jsx("span",{className:"text-xs text-white font-medium",children:t.owner})]}):e.jsx("span",{className:"text-xs text-gray-600 italic mt-0.5",children:"Svincolato"})]})]})]},t.$id)),h.length>50&&e.jsx("div",{className:"py-3 text-center text-xs text-gray-600",children:"Mostrati primi 50. Usa i filtri."})]}),X&&c&&A.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 transition-opacity animate-in fade-in duration-200",onClick:v}),e.jsxs("div",{className:"relative w-full max-w-lg mx-4 bg-[#18181b] rounded-2xl border border-white/10 shadow-[0_20px_60px_-15px_rgba(0,0,0,0.5)] overflow-hidden animate-in zoom-in-95 fade-in duration-200",onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-pl-teal/50 to-transparent"}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/5",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(ae,{size:18,className:"text-pl-teal"}),"Modifica Giocatore"]}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[c.name," (",c.team_short_name,")"]})]}),e.jsx("button",{onClick:v,className:"text-gray-500 hover:text-white transition p-2 hover:bg-white/10 rounded-lg",children:e.jsx(O,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs uppercase font-bold text-gray-500 tracking-wider",children:"Ruolo Fanta"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:B.map(t=>e.jsx("button",{onClick:()=>d({...r,position:t}),className:`py-2 px-1 rounded-lg text-[10px] font-bold uppercase transition border ${r.position===t?t==="Portiere"?"bg-yellow-500 text-black border-yellow-500":t==="Difensore"?"bg-blue-500 text-white border-blue-500":t==="Centrocampista"?"bg-green-500 text-white border-green-500":"bg-red-500 text-white border-red-500":"bg-white/5 text-gray-400 border-transparent hover:bg-white/10"}`,children:t},t))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs uppercase font-bold text-gray-500 tracking-wider",children:"Quotazione"}),e.jsx("input",{type:"number",value:r.quotation,onChange:t=>d({...r,quotation:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-pl-teal outline-none transition font-mono"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs uppercase font-bold text-gray-500 tracking-wider",children:"Prezzo Acquisto"}),e.jsx("input",{type:"number",value:r.purchase_price,onChange:t=>d({...r,purchase_price:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-pl-teal outline-none transition font-mono"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs uppercase font-bold text-gray-500 tracking-wider flex justify-between",children:["Proprietario",r.position==="Portiere"&&e.jsxs("span",{className:"text-pl-teal text-[10px] items-center flex gap-1",children:[e.jsx(z,{size:10})," Gestito da Blocco Squadra"]})]}),e.jsxs("select",{value:r.owner,onChange:t=>d({...r,owner:t.target.value}),disabled:r.position==="Portiere",className:`w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-pl-teal outline-none transition ${r.position==="Portiere"?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"-- Svincolato --"}),_.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"p-6 border-t border-white/5 flex justify-end gap-3 bg-black/20 rounded-b-2xl",children:[e.jsx("button",{onClick:v,className:"px-5 py-2.5 rounded-xl text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition",children:"Annulla"}),e.jsxs("button",{onClick:Z,disabled:T,className:"px-6 py-2.5 rounded-xl text-sm font-bold text-pl-dark bg-pl-teal hover:bg-pl-teal/90 transition shadow-lg shadow-pl-teal/20 flex items-center gap-2",children:[T?e.jsx(R,{size:16,className:"animate-spin"}):e.jsx(re,{size:16}),"Salva Modifiche"]})]})]})]}),document.body),C&&A.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in",onClick:()=>P(!1)}),e.jsxs("div",{className:"relative w-full max-w-2xl bg-[#18181b] rounded-2xl border border-white/10 shadow-2xl overflow-hidden animate-in zoom-in-95 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-black/20",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(z,{className:"text-pl-teal",size:20}),"Blocchi Portieri"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Assegna l'intero reparto portieri a un manager."})]}),e.jsx("button",{onClick:()=>P(!1),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white",children:e.jsx(O,{size:20})})]}),e.jsx("div",{className:"p-6 overflow-y-auto space-y-4",children:H.sort((t,s)=>t.name.localeCompare(s.name)).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"font-bold text-white",children:t.name})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:t.goalkeeper_owner||"",onChange:s=>S(t.$id,s.target.value||null,t.goalkeeper_quotation||0,t.goalkeeper_purchase_price||0),className:"bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-pl-teal outline-none w-32 md:w-36",children:[e.jsx("option",{value:"",children:"-- Nessuno --"}),_.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),e.jsxs("div",{className:"flex flex-col w-16",children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Quot."}),e.jsx("input",{type:"number",value:t.goalkeeper_quotation||0,onChange:s=>{const a=parseInt(s.target.value);g(l=>l.map(i=>i.$id===t.$id?{...i,goalkeeper_quotation:a}:i))},onBlur:s=>S(t.$id,t.goalkeeper_owner,parseInt(s.target.value),t.goalkeeper_purchase_price||0),className:"bg-black/40 border border-white/10 rounded-lg px-2 py-2 text-sm text-white focus:border-pl-teal outline-none text-center font-mono"})]}),e.jsxs("div",{className:"flex flex-col w-16",children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Prezzo"}),e.jsx("input",{type:"number",value:t.goalkeeper_purchase_price||0,onChange:s=>{const a=parseInt(s.target.value);g(l=>l.map(i=>i.$id===t.$id?{...i,goalkeeper_purchase_price:a}:i))},onBlur:s=>S(t.$id,t.goalkeeper_owner,t.goalkeeper_quotation||0,parseInt(s.target.value)),className:"bg-black/40 border border-white/10 rounded-lg px-2 py-2 text-sm text-pl-teal font-bold focus:border-pl-teal outline-none text-center font-mono"})]})]})]},t.$id))})]})]}),document.body)]})};export{ne as AdminPlayers};
