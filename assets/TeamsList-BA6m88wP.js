import{r as y,j as e,b as k,q as I,A as R,w as z,u as F,F as C,L as U,U as B,d as D,D as M,g as O,l as H}from"./index-IQCk0ePk.js";import{C as Q}from"./coins-eN-SbOWY.js";const A=({players:t,role:u,label:o,required:N,countType:h="player",realTeams:f=[],managerName:_=""})=>{const[b,$]=y.useState(new Set),S=n=>{$(i=>{const c=new Set(i);return c.has(n)?c.delete(n):c.add(n),c})},v=t.filter(n=>n.position===u);if(u==="Portiere"){const n=new Set(f.filter(s=>s.goalkeeper_owner===_).map(s=>s.$id)),i=t.filter(s=>s.position==="Portiere"&&n.has(s.team_id)),g=[...new Set(i.map(s=>s.team_id))].map(s=>{var l,x;const r=f.find(m=>m.$id===s),a=i.filter(m=>m.team_id===s);return{teamId:s,teamName:((l=a[0])==null?void 0:l.team_name)||"Team",teamShortName:((x=a[0])==null?void 0:x.team_short_name)||"???",quotation:(r==null?void 0:r.goalkeeper_quotation)||0,purchasePrice:(r==null?void 0:r.goalkeeper_purchase_price)||0,players:a}});return g.sort((s,r)=>r.purchasePrice-s.purchasePrice),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"flex items-center justify-between mb-2 px-1",children:e.jsxs("span",{className:"text-[10px] uppercase font-bold text-gray-500",children:[o," (Blocchi)"]})}),g.length===0?e.jsx("div",{className:"px-2 py-1 text-xs text-gray-600 italic",children:"-"}):e.jsx("div",{className:"space-y-1",children:g.map(s=>e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>S(s.teamId),className:"flex items-center justify-between px-2 py-2 rounded hover:bg-white/5 transition group cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 flex items-center justify-center shrink-0",title:s.teamName,children:e.jsx("img",{src:`https://images.fotmob.com/image_resources/logo/teamlogo/${s.teamId.replace("team_","")}.png`,alt:s.teamShortName,className:"w-full h-full object-contain drop-shadow-md",loading:"lazy",onError:r=>{var l;const a=r.target;a.style.display="none",a.parentElement&&(a.parentElement.innerText=((l=s.teamShortName)==null?void 0:l.substring(0,3))||"?",a.parentElement.className="w-8 h-8 md:w-9 md:h-9 flex items-center justify-center shrink-0 bg-white/10 rounded-md text-[9px] font-bold text-gray-400")}})}),e.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 shrink-0 overflow-hidden rounded-full border border-white/20 bg-slate-800 shadow-lg pl-0",children:e.jsx("div",{className:`grid w-full h-full p-[1px] gap-[1px] ${s.players.length===2?"grid-cols-2":s.players.length>=3?"grid-cols-2 grid-rows-2":"grid-cols-1"}`,children:s.players.length===1?e.jsx("div",{className:"w-full h-full overflow-hidden",children:e.jsx("img",{src:s.players[0].image_url,alt:"",className:"w-full h-full object-cover"})}):s.players.length===2?s.players.map(r=>e.jsx("div",{className:"w-full h-full overflow-hidden",children:e.jsx("img",{src:r.image_url,alt:"",className:"w-full h-full object-cover scale-[1.1]"})},r.$id)):s.players.length===3?s.players.map(r=>e.jsx("div",{className:"w-full h-full overflow-hidden",children:e.jsx("img",{src:r.image_url,alt:"",className:"w-full h-full object-cover scale-[1.2]"})},r.$id)):s.players.slice(0,4).map((r,a)=>e.jsxs("div",{className:"w-full h-full overflow-hidden relative",children:[e.jsx("img",{src:r.image_url,alt:"",className:"w-full h-full object-cover scale-[1.2]"}),a===3&&s.players.length>4&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-[8px] font-bold text-white",children:["+",s.players.length-3]})]},r.$id))})}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs("span",{className:"text-sm md:text-base text-gray-200 truncate group-hover:text-white transition font-medium",children:["Blocco ",s.teamShortName]}),e.jsx(k,{size:14,className:`text-gray-500 transition shrink-0 ${b.has(s.teamId)?"rotate-180":""}`})]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0 ml-2",children:[e.jsxs("div",{className:"flex flex-col items-end leading-none",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-500 mb-0.5",children:"Q"}),e.jsx("span",{className:"text-xs md:text-base font-bold text-white",children:s.quotation})]}),e.jsxs("div",{className:"flex flex-col items-end leading-none w-8",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-500 mb-0.5",children:"P"}),e.jsx("span",{className:"text-xs md:text-base font-bold text-pl-teal",children:s.purchasePrice||"-"})]})]})]}),b.has(s.teamId)&&e.jsx("div",{className:"ml-6 pl-3 border-l border-white/10 space-y-1 py-1",children:s.players.map(r=>e.jsxs("div",{className:"flex items-center gap-2 py-1 text-xs text-gray-400",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-white/10 overflow-hidden border border-white/20 shrink-0",children:r.image_url?e.jsx("img",{src:r.image_url,alt:r.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-[8px] text-gray-500",children:"?"})}),e.jsxs("span",{className:`truncate ${r.is_active===!1?"italic text-gray-500":""}`,children:[r.name,r.is_active===!1?"*":""]})]},r.$id))})]},s.teamId))})]})}return v.sort((n,i)=>(i.purchase_price||0)-(n.purchase_price||0)),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-500",children:o}),e.jsx("span",{className:`text-[10px] font-mono ${v.length===(h==="block"?99:N)?"text-green-400":"text-gray-600"}`})]}),v.length===0?e.jsx("div",{className:"px-2 py-1 text-xs text-gray-600 italic",children:"-"}):e.jsx("div",{className:"space-y-1",children:v.map(n=>e.jsxs("div",{className:"flex items-center justify-between px-2 py-2 rounded hover:bg-white/5 transition group",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 flex items-center justify-center shrink-0",title:n.team_name,children:e.jsx("img",{src:`https://images.fotmob.com/image_resources/logo/teamlogo/${n.team_id.replace("team_","")}.png`,alt:n.team_short_name,className:"w-full h-full object-contain drop-shadow-md",loading:"lazy",onError:i=>{var g;const c=i.target;c.style.display="none",c.parentElement&&(c.parentElement.innerText=((g=n.team_short_name)==null?void 0:g.substring(0,3))||"?",c.parentElement.className="w-8 h-8 md:w-9 md:h-9 flex items-center justify-center shrink-0 bg-white/10 rounded-md text-[9px] font-bold text-gray-400")}})}),e.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 rounded-full bg-slate-800 border border-white/20 overflow-hidden shrink-0 shadow-lg",children:n.image_url?e.jsx("img",{src:n.image_url,alt:n.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-[8px] text-gray-500",children:"?"})}),e.jsxs("span",{className:`text-sm md:text-base text-gray-200 truncate group-hover:text-white transition font-medium ${n.is_active===!1?"italic !text-gray-500":""}`,children:[n.name,n.is_active===!1?"*":""]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0 ml-2",children:[e.jsxs("div",{className:"flex flex-col items-end leading-none",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-500 mb-0.5",children:"Q"}),e.jsx("span",{className:"text-xs md:text-base font-bold text-white",children:n.quotation})]}),e.jsxs("div",{className:"flex flex-col items-end leading-none w-8",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-500 mb-0.5",children:"P"}),e.jsx("span",{className:"text-xs md:text-base font-bold text-pl-teal",children:n.purchase_price||"-"})]})]})]},n.$id))})]})},G=({team:t,realTeams:u})=>{const[o,N]=y.useState("ALL"),h=f=>{N(_=>_===f?"ALL":f)};return e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-2xl overflow-hidden hover:border-white/20 transition group",children:[e.jsxs("div",{className:"p-5 bg-gradient-to-r from-white/5 to-transparent border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-pl-teal/10 border-2 border-pl-teal/20 flex items-center justify-center overflow-hidden shrink-0 shadow-lg",children:t.logoUrl?e.jsx("img",{src:t.logoUrl,alt:t.teamName,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-2xl font-bold text-pl-teal",children:t.managerName.charAt(0)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-white truncate",title:t.teamName,children:t.teamName}),e.jsxs("div",{className:"text-sm text-gray-400 font-medium",children:["Allenatore: ",e.jsx("span",{className:"text-gray-200",children:t.managerName})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-500 font-bold uppercase tracking-wider",children:"Budget"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-pl-teal font-mono font-bold text-lg",children:[e.jsx(Q,{size:16}),t.remaining," ",e.jsxs("span",{className:"text-xs text-gray-500 font-normal self-end mb-0.5",children:["/ ",t.budget]})]})]}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-xs font-bold border flex items-center gap-1.5 ${t.isComplete?"bg-green-500/20 text-green-400 border-green-500/30":"bg-yellow-500/10 text-yellow-400 border-yellow-500/20"}`,children:[t.isComplete?e.jsx(I,{size:12}):e.jsx(R,{size:12}),t.isComplete?"ROSA COMPLETA":"INCOMPLETA"]})]})]}),e.jsxs("div",{className:"p-4 bg-black/20 text-xs text-gray-400 grid grid-cols-4 gap-2 text-center border-b border-white/5",children:[e.jsxs("button",{onClick:()=>h("P"),className:`transition-colors py-1 rounded hover:bg-white/5 ${o==="P"?"bg-white/10 ring-1 ring-white/20":""} ${t.roleCounts.P===2?"text-green-400 font-bold":""}`,children:["P: ",t.roleCounts.P,"/2"]}),e.jsxs("button",{onClick:()=>h("D"),className:`transition-colors py-1 rounded hover:bg-white/5 ${o==="D"?"bg-white/10 ring-1 ring-white/20":""} ${t.roleCounts.D===8?"text-green-400 font-bold":""}`,children:["D: ",t.roleCounts.D,"/8"]}),e.jsxs("button",{onClick:()=>h("C"),className:`transition-colors py-1 rounded hover:bg-white/5 ${o==="C"?"bg-white/10 ring-1 ring-white/20":""} ${t.roleCounts.C===8?"text-green-400 font-bold":""}`,children:["C: ",t.roleCounts.C,"/8"]}),e.jsxs("button",{onClick:()=>h("A"),className:`transition-colors py-1 rounded hover:bg-white/5 ${o==="A"?"bg-white/10 ring-1 ring-white/20":""} ${t.roleCounts.A===6?"text-green-400 font-bold":""}`,children:["A: ",t.roleCounts.A,"/6"]})]}),e.jsxs("div",{className:"max-h-[480px] overflow-y-auto divide-y divide-white/5 bg-black/10 transition-all",children:[(o==="ALL"||o==="P")&&e.jsx(A,{players:t.players,role:"Portiere",label:"Portieri",required:2,countType:"block",realTeams:u,managerName:t.managerName}),(o==="ALL"||o==="D")&&e.jsx(A,{players:t.players,role:"Difensore",label:"Difensori",required:8,realTeams:u}),(o==="ALL"||o==="C")&&e.jsx(A,{players:t.players,role:"Centrocampista",label:"Centrocampisti",required:8,realTeams:u}),(o==="ALL"||o==="A")&&e.jsx(A,{players:t.players,role:"Attaccante",label:"Attaccanti",required:6,realTeams:u})]})]})},E=t=>(t==null?void 0:t.trim())||"Svincolato",J=()=>{const{players:t,loading:u,error:o,realTeams:N}=z(),{user:h}=F(),[f,_]=y.useState([]),[b,$]=y.useState(new Map),[S,v]=y.useState(!0),n=async()=>{try{const i=await D.listDocuments(M,O),c=new Map;i.documents.forEach(g=>{c.set(E(g.manager_name),g)}),$(c)}catch(i){H.error("[TeamsList] Error fetching fantasy teams:",i)}};return y.useEffect(()=>{n()},[]),y.useEffect(()=>{var r;if(!t.length)return;const i=new Map;t.forEach(a=>{const l=E(a.owner||"");l!=="Svincolato"&&(i.has(l)||i.set(l,[]),i.get(l).push(a))}),N.forEach(a=>{var x;const l=E(a.goalkeeper_owner||"");if(l&&l!=="Svincolato"){const m=t.filter(w=>w.team_id===a.$id&&w.position==="Portiere");if(m.length>0&&!i.has(l)&&i.set(l,[]),m.length>0){const w=new Set(((x=i.get(l))==null?void 0:x.map(j=>j.$id))||[]);m.forEach(j=>{w.has(j.$id)||i.get(l).push({...j,quotation:a.goalkeeper_quotation||j.quotation,purchase_price:a.goalkeeper_purchase_price||0})})}}});const c=[];i.forEach((a,l)=>{const x=new Set(a.filter(p=>p.position==="Portiere").map(p=>p.team_id)).size,m=a.filter(p=>p.position==="Difensore").length,w=a.filter(p=>p.position==="Centrocampista").length,j=a.filter(p=>p.position==="Attaccante").length,d=b.get(l),L=a.reduce((p,q)=>p+(q.purchase_price||0),0),P=(d==null?void 0:d.credits_remaining)??0,T=(d==null?void 0:d.budget)??500;c.push({managerName:l,teamName:(d==null?void 0:d.team_name)||`Team ${l}`,logoUrl:d==null?void 0:d.fantasylogo_url,budget:T,spent:L,remaining:P,players:a,isComplete:x===C.P&&m===C.D&&w===C.C&&j===C.A,roleCounts:{P:x,D:m,C:w,A:j},totalPlayers:a.length,teamId:d==null?void 0:d.$id})}),c.sort((a,l)=>{const x=a.managerName.includes("-"),m=l.managerName.includes("-");return x&&!m?1:!x&&m?-1:a.managerName.localeCompare(l.managerName)});const g=((r=h==null?void 0:h.prefs)==null?void 0:r.role)||"user",s=c.filter(a=>{const l=b.get(a.managerName);return!((l==null?void 0:l.role)==="g_admin"&&g!=="g_admin")});_(s),v(!1)},[t,N,b,h]),u||S?e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 gap-4",children:[e.jsx(U,{className:"h-8 w-8 animate-spin text-pl-teal"}),e.jsx("span",{className:"text-gray-400",children:"Caricamento rose..."})]}):o?e.jsx("div",{className:"flex flex-col items-center justify-center h-96 text-red-400",children:e.jsxs("p",{children:["Errore: ",o]})}):e.jsxs("div",{className:"w-full px-4 md:px-12 lg:px-24 xl:px-32 container mx-auto pb-20",children:[e.jsx("div",{className:"flex flex-col items-center justify-center mb-8 mt-6 text-center",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center justify-center gap-3",children:[e.jsx(B,{className:"text-pl-teal"}),"Rose Fantacalcio"]}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[f.length," squadre registrate"]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:f.map(i=>e.jsx(G,{team:i,realTeams:N},i.managerName))})]})};export{J as TeamsList};
