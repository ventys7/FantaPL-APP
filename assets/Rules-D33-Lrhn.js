import{c as Y,r as l,d as ct,D as dt,C as Bt,l as ut,a as Pn,Q as $n,j as c,X as rn,u as wt,R as q,b as Le,S as Bn,e as Un,f as Fn}from"./index-Ya582L2f.js";import{P as on,M as _n}from"./plus-BgE7A89X.js";import{T as Hn}from"./trash-2-BRh6aF_N.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=Y("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=Y("AlignJustify",[["line",{x1:"3",x2:"21",y1:"6",y2:"6",key:"4m8b97"}],["line",{x1:"3",x2:"21",y1:"12",y2:"12",key:"10d38w"}],["line",{x1:"3",x2:"21",y1:"18",y2:"18",key:"kwyyxn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yn=Y("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=Y("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gn=Y("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=Y("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kn=Y("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=Y("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=Y("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=Y("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=Y("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=Y("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=Y("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=Y("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=Y("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]),ir=[{id:2,title:"2. Ruoli Lega",key:"ruoliLega",content:""},{id:3,title:"3. Modalità Asta, Composizione Rosa, Bonus & Malus",key:"astaRosa",content:""},{id:4,title:"4. Formazione della Squadra",key:"formazione",content:""},{id:5,title:"5. Svolgimento Giornata Campionato",key:"giornata",content:""},{id:6,title:"6. Campionato con Girone e Playoff",key:"campionato",content:""},{id:7,title:"7. Coppa (Coppa Italia e Supercoppa)",key:"coppa",content:""},{id:8,title:"8. Champions/Europa League",key:"champions",content:""},{id:9,title:"9. Mercato e Scambi",key:"mercato",content:""},{id:10,title:"10. Premi",key:"premi",content:""},{id:11,title:"11. Clausole e Punizioni",key:"clausole",content:""},{id:12,title:"12. Conclusione",key:"conclusione",content:""},{id:13,title:"13. Link Utili",key:"link",content:""}],Ft={title:"1. Cenni Principali e Avvertenze",mainText:'Il "PianginaCUP" è a titolo gratuito.',partecipanti:`Partecipanti:
1. Manager 1
2. Manager 2`};function or(){const[e,t]=l.useState(!0),[n,r]=l.useState(!1),[i,o]=l.useState(Ft),[a,s]=l.useState(ir),[d,u]=l.useState([]),[h,f]=l.useState([]),[v,g]=l.useState(null),k=async()=>{try{const p=await ct.listDocuments(dt,Bt);if(p.documents.length>0){const x=p.documents[0];if(g(x.$id),x.cenni_main_text&&o({mainText:x.cenni_main_text,partecipanti:x.cenni_partecipanti||Ft.partecipanti}),x.sections_json)try{const C=JSON.parse(x.sections_json);Array.isArray(C)?s(C):C.sections&&(s(C.sections),C.mainTitle&&o(E=>({...E,title:C.mainTitle})))}catch(C){ut.error("Error parsing sections:",C)}}}catch(p){ut.error("Error loading rules:",p)}finally{t(!1)}},m=async()=>{try{const p=await ct.listDocuments(dt,Pn,[$n.orderDesc("archived_at")]);u(p.documents)}catch{u([])}},w=async()=>{if(!v)return!1;r(!0);try{const p={mainTitle:i.title,sections:a};return await ct.updateDocument(dt,Bt,v,{cenni_main_text:i.mainText,cenni_partecipanti:i.partecipanti,sections_json:JSON.stringify(p)}),!0}catch(p){return ut.error("Error saving rules:",p),!1}finally{r(!1)}},R=(p,x,C)=>{s(E=>E.map(T=>T.id===p?{...T,[x]:C}:T))},y=()=>{const p=Math.max(...a.map(x=>x.id))+1;s(x=>[...x,{id:p,title:`${p}. Nuova Sezione`,key:`section${p}`,content:""}])},S=p=>{confirm("Sei sicuro di voler eliminare questa sezione?")&&s(x=>x.filter(C=>C.id!==p))},N=(p,x)=>{f(C=>[...C,{field:p,value:x}])},j=()=>{if(h.length===0)return;const p=h[h.length-1];if(f(x=>x.slice(0,-1)),p.field==="mainText")o(x=>({...x,mainText:p.value}));else if(p.field==="partecipanti")o(x=>({...x,partecipanti:p.value}));else if(p.field.startsWith("section-")){const x=parseInt(p.field.replace("section-",""));s(C=>C.map(E=>E.id===x?{...E,content:p.value}:E))}},A=()=>{f([])};return l.useEffect(()=>{k(),m()},[]),{loading:e,saving:n,cenniPrincipali:i,sections:a,archivedRules:d,undoHistory:h,setCenniPrincipali:o,setSections:s,loadRules:k,saveRules:w,updateSection:R,addSection:y,removeSection:S,addToUndoHistory:N,undo:j,clearUndoHistory:A}}function sr({archive:e,onClose:t}){var n;return c.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:c.jsxs("div",{className:"bg-pl-dark border border-white/20 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[c.jsxs("div",{className:"p-6 border-b border-white/10 flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsxs("h3",{className:"text-2xl font-bold text-white",children:["Regolamento Stagione ",e.season]}),c.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:["Archiviato il ",new Date(e.archived_at).toLocaleDateString("it-IT")]})]}),c.jsx("button",{onClick:t,className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",children:c.jsx(rn,{size:24})})]}),c.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[c.jsxs("div",{className:"mb-8",children:[c.jsx("h4",{className:"text-xl font-bold text-pl-teal mb-4",children:"1. Cenni Principali"}),c.jsx("div",{className:"text-gray-200 leading-relaxed",dangerouslySetInnerHTML:{__html:((n=e.cenni_main_text)==null?void 0:n.replace(/\n/g,"<br/>"))||""}})]}),e.sections_json&&c.jsx("div",{className:"space-y-6",children:JSON.parse(e.sections_json).map(r=>{var i;return c.jsxs("div",{children:[c.jsx("h4",{className:"text-xl font-bold text-pl-teal mb-3",children:r.title}),c.jsx("div",{className:"text-gray-200 leading-relaxed",dangerouslySetInnerHTML:{__html:((i=r.content)==null?void 0:i.replace(/\n/g,"<br/>"))||""}})]},r.id)})})]})]})})}const ar=(e,t)=>t?e.replace(/<blur>(.*?)<\/blur>/gi,(n,r)=>"█".repeat(r.length)):e;function lr({children:e}){const{user:t}=wt(),r=ar(e,!t);return c.jsx("span",{dangerouslySetInnerHTML:{__html:r.replace(/\n/g,"<br/>")}})}function _t({value:e,onChange:t,editMode:n,multiline:r=!1,className:i="",textareaRef:o,dataField:a}){const{hasRole:s}=wt();return n&&s("admin")?r?c.jsx("textarea",{ref:o,"data-field":a,value:e,onChange:d=>t(d.target.value),className:`w-full bg-pl-dark/50 border border-pl-pink/30 rounded-lg p-4 text-white focus:outline-none focus:ring-2 focus:ring-pl-pink resize-y min-h-[200px] font-mono text-sm leading-relaxed ${i}`}):c.jsx("input",{type:"text",value:e,onChange:d=>t(d.target.value),className:`w-full bg-pl-dark/50 border border-pl-pink/30 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-pl-pink ${i}`}):c.jsx("div",{className:`leading-relaxed ${i}`,children:c.jsx(lr,{children:e})})}function cr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.useMemo(()=>r=>{t.forEach(i=>i(r))},t)}const nt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ee(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function St(e){return"nodeType"in e}function K(e){var t,n;return e?Ee(e)?e:St(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Ct(e){const{Document:t}=K(e);return e instanceof t}function Xe(e){return Ee(e)?!1:e instanceof K(e).HTMLElement}function sn(e){return e instanceof K(e).SVGElement}function Me(e){return e?Ee(e)?e.document:St(e)?Ct(e)?e:Xe(e)||sn(e)?e.ownerDocument:document:document:document}const ce=nt?l.useLayoutEffect:l.useEffect;function Dt(e){const t=l.useRef(e);return ce(()=>{t.current=e}),l.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.current==null?void 0:t.current(...r)},[])}function dr(){const e=l.useRef(null),t=l.useCallback((r,i)=>{e.current=setInterval(r,i)},[]),n=l.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Ue(e,t){t===void 0&&(t=[e]);const n=l.useRef(e);return ce(()=>{n.current!==e&&(n.current=e)},t),n}function Ve(e,t){const n=l.useRef();return l.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Qe(e){const t=Dt(e),n=l.useRef(null),r=l.useCallback(i=>{i!==n.current&&(t==null||t(i,n.current)),n.current=i},[]);return[n,r]}function vt(e){const t=l.useRef();return l.useEffect(()=>{t.current=e},[e]),t.current}let ft={};function Ye(e,t){return l.useMemo(()=>{if(t)return t;const n=ft[e]==null?0:ft[e]+1;return ft[e]=n,e+"-"+n},[e,t])}function an(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.reduce((o,a)=>{const s=Object.entries(a);for(const[d,u]of s){const h=o[d];h!=null&&(o[d]=h+e*u)}return o},{...t})}}const je=an(1),Fe=an(-1);function ur(e){return"clientX"in e&&"clientY"in e}function Rt(e){if(!e)return!1;const{KeyboardEvent:t}=K(e.target);return t&&e instanceof t}function fr(e){if(!e)return!1;const{TouchEvent:t}=K(e.target);return t&&e instanceof t}function bt(e){if(fr(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return ur(e)?{x:e.clientX,y:e.clientY}:null}const _e=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[_e.Translate.toString(e),_e.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Ht="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function hr(e){return e.matches(Ht)?e:e.querySelector(Ht)}const gr={display:"none"};function pr(e){let{id:t,value:n}=e;return q.createElement("div",{id:t,style:gr},n)}function vr(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return q.createElement("div",{id:t,style:i,role:"status","aria-live":r,"aria-atomic":!0},n)}function br(){const[e,t]=l.useState("");return{announce:l.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const ln=l.createContext(null);function xr(e){const t=l.useContext(ln);l.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function mr(){const[e]=l.useState(()=>new Set),t=l.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[l.useCallback(r=>{let{type:i,event:o}=r;e.forEach(a=>{var s;return(s=a[i])==null?void 0:s.call(a,o)})},[e]),t]}const yr={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},wr={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Sr(e){let{announcements:t=wr,container:n,hiddenTextDescribedById:r,screenReaderInstructions:i=yr}=e;const{announce:o,announcement:a}=br(),s=Ye("DndLiveRegion"),[d,u]=l.useState(!1);if(l.useEffect(()=>{u(!0)},[]),xr(l.useMemo(()=>({onDragStart(f){let{active:v}=f;o(t.onDragStart({active:v}))},onDragMove(f){let{active:v,over:g}=f;t.onDragMove&&o(t.onDragMove({active:v,over:g}))},onDragOver(f){let{active:v,over:g}=f;o(t.onDragOver({active:v,over:g}))},onDragEnd(f){let{active:v,over:g}=f;o(t.onDragEnd({active:v,over:g}))},onDragCancel(f){let{active:v,over:g}=f;o(t.onDragCancel({active:v,over:g}))}}),[o,t])),!d)return null;const h=q.createElement(q.Fragment,null,q.createElement(pr,{id:r,value:i.draggable}),q.createElement(vr,{id:s,announcement:a}));return n?Le.createPortal(h,n):h}var L;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(L||(L={}));function Ze(){}function Xt(e,t){return l.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Cr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const oe=Object.freeze({x:0,y:0});function cn(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function dn(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function Dr(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Vt(e){let{left:t,top:n,height:r,width:i}=e;return[{x:t,y:n},{x:t+i,y:n},{x:t,y:n+r},{x:t+i,y:n+r}]}function un(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Yt(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const Rr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=Yt(t,t.left,t.top),o=[];for(const a of r){const{id:s}=a,d=n.get(s);if(d){const u=cn(Yt(d),i);o.push({id:s,data:{droppableContainer:a,value:u}})}}return o.sort(dn)},Nr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=Vt(t),o=[];for(const a of r){const{id:s}=a,d=n.get(s);if(d){const u=Vt(d),h=i.reduce((v,g,k)=>v+cn(u[k],g),0),f=Number((h/4).toFixed(4));o.push({id:s,data:{droppableContainer:a,value:f}})}}return o.sort(dn)};function kr(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),a=i-r,s=o-n;if(r<i&&n<o){const d=t.width*t.height,u=e.width*e.height,h=a*s,f=h/(d+u-h);return Number(f.toFixed(4))}return 0}const jr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=[];for(const o of r){const{id:a}=o,s=n.get(a);if(s){const d=kr(s,t);d>0&&i.push({id:a,data:{droppableContainer:o,value:d}})}}return i.sort(Dr)};function Er(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function fn(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:oe}function Mr(e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i.reduce((a,s)=>({...a,top:a.top+e*s.y,bottom:a.bottom+e*s.y,left:a.left+e*s.x,right:a.right+e*s.x}),{...n})}}const Ar=Mr(1);function Tr(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Ir(e,t,n){const r=Tr(t);if(!r)return e;const{scaleX:i,scaleY:o,x:a,y:s}=r,d=e.left-a-(1-i)*parseFloat(n),u=e.top-s-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),h=i?e.width/i:e.width,f=o?e.height/o:e.height;return{width:h,height:f,top:u,right:d+h,bottom:u+f,left:d}}const zr={ignoreTransform:!1};function Ae(e,t){t===void 0&&(t=zr);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:u,transformOrigin:h}=K(e).getComputedStyle(e);u&&(n=Ir(n,u,h))}const{top:r,left:i,width:o,height:a,bottom:s,right:d}=n;return{top:r,left:i,width:o,height:a,bottom:s,right:d}}function Wt(e){return Ae(e,{ignoreTransform:!0})}function Or(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Lr(e,t){return t===void 0&&(t=K(e).getComputedStyle(e)),t.position==="fixed"}function Pr(e,t){t===void 0&&(t=K(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const o=t[i];return typeof o=="string"?n.test(o):!1})}function rt(e,t){const n=[];function r(i){if(t!=null&&n.length>=t||!i)return n;if(Ct(i)&&i.scrollingElement!=null&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!Xe(i)||sn(i)||n.includes(i))return n;const o=K(e).getComputedStyle(i);return i!==e&&Pr(i,o)&&n.push(i),Lr(i,o)?n:r(i.parentNode)}return e?r(e):n}function hn(e){const[t]=rt(e,1);return t??null}function ht(e){return!nt||!e?null:Ee(e)?e:St(e)?Ct(e)||e===Me(e).scrollingElement?window:Xe(e)?e:null:null}function gn(e){return Ee(e)?e.scrollX:e.scrollLeft}function pn(e){return Ee(e)?e.scrollY:e.scrollTop}function xt(e){return{x:gn(e),y:pn(e)}}var $;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})($||($={}));function vn(e){return!nt||!e?!1:e===document.scrollingElement}function bn(e){const t={x:0,y:0},n=vn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},i=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,a=e.scrollTop>=r.y,s=e.scrollLeft>=r.x;return{isTop:i,isLeft:o,isBottom:a,isRight:s,maxScroll:r,minScroll:t}}const $r={x:.2,y:.2};function Br(e,t,n,r,i){let{top:o,left:a,right:s,bottom:d}=n;r===void 0&&(r=10),i===void 0&&(i=$r);const{isTop:u,isBottom:h,isLeft:f,isRight:v}=bn(e),g={x:0,y:0},k={x:0,y:0},m={height:t.height*i.y,width:t.width*i.x};return!u&&o<=t.top+m.height?(g.y=$.Backward,k.y=r*Math.abs((t.top+m.height-o)/m.height)):!h&&d>=t.bottom-m.height&&(g.y=$.Forward,k.y=r*Math.abs((t.bottom-m.height-d)/m.height)),!v&&s>=t.right-m.width?(g.x=$.Forward,k.x=r*Math.abs((t.right-m.width-s)/m.width)):!f&&a<=t.left+m.width&&(g.x=$.Backward,k.x=r*Math.abs((t.left+m.width-a)/m.width)),{direction:g,speed:k}}function Ur(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:t,left:n,right:r,bottom:i}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}function xn(e){return e.reduce((t,n)=>je(t,xt(n)),oe)}function Fr(e){return e.reduce((t,n)=>t+gn(n),0)}function _r(e){return e.reduce((t,n)=>t+pn(n),0)}function Hr(e,t){if(t===void 0&&(t=Ae),!e)return;const{top:n,left:r,bottom:i,right:o}=t(e);hn(e)&&(i<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Xr=[["x",["left","right"],Fr],["y",["top","bottom"],_r]];class Nt{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=rt(n),i=xn(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,a,s]of Xr)for(const d of a)Object.defineProperty(this,d,{get:()=>{const u=s(r),h=i[o]-u;return this.rect[d]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Pe{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var i;(i=this.target)==null||i.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function Vr(e){const{EventTarget:t}=K(e);return e instanceof t?e:Me(e)}function gt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var re;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(re||(re={}));function Gt(e){e.preventDefault()}function Yr(e){e.stopPropagation()}var M;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(M||(M={}));const mn={start:[M.Space,M.Enter],cancel:[M.Esc],end:[M.Space,M.Enter,M.Tab]},Wr=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case M.Right:return{...n,x:n.x+25};case M.Left:return{...n,x:n.x-25};case M.Down:return{...n,y:n.y+25};case M.Up:return{...n,y:n.y-25}}};class kt{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Pe(Me(n)),this.windowListeners=new Pe(K(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(re.Resize,this.handleCancel),this.windowListeners.add(re.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(re.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&Hr(r),n(oe)}handleKeyDown(t){if(Rt(t)){const{active:n,context:r,options:i}=this.props,{keyboardCodes:o=mn,coordinateGetter:a=Wr,scrollBehavior:s="smooth"}=i,{code:d}=t;if(o.end.includes(d)){this.handleEnd(t);return}if(o.cancel.includes(d)){this.handleCancel(t);return}const{collisionRect:u}=r.current,h=u?{x:u.left,y:u.top}:oe;this.referenceCoordinates||(this.referenceCoordinates=h);const f=a(t,{active:n,context:r.current,currentCoordinates:h});if(f){const v=Fe(f,h),g={x:0,y:0},{scrollableAncestors:k}=r.current;for(const m of k){const w=t.code,{isTop:R,isRight:y,isLeft:S,isBottom:N,maxScroll:j,minScroll:A}=bn(m),p=Ur(m),x={x:Math.min(w===M.Right?p.right-p.width/2:p.right,Math.max(w===M.Right?p.left:p.left+p.width/2,f.x)),y:Math.min(w===M.Down?p.bottom-p.height/2:p.bottom,Math.max(w===M.Down?p.top:p.top+p.height/2,f.y))},C=w===M.Right&&!y||w===M.Left&&!S,E=w===M.Down&&!N||w===M.Up&&!R;if(C&&x.x!==f.x){const T=m.scrollLeft+v.x,W=w===M.Right&&T<=j.x||w===M.Left&&T>=A.x;if(W&&!v.y){m.scrollTo({left:T,behavior:s});return}W?g.x=m.scrollLeft-T:g.x=w===M.Right?m.scrollLeft-j.x:m.scrollLeft-A.x,g.x&&m.scrollBy({left:-g.x,behavior:s});break}else if(E&&x.y!==f.y){const T=m.scrollTop+v.y,W=w===M.Down&&T<=j.y||w===M.Up&&T>=A.y;if(W&&!v.x){m.scrollTo({top:T,behavior:s});return}W?g.y=m.scrollTop-T:g.y=w===M.Down?m.scrollTop-j.y:m.scrollTop-A.y,g.y&&m.scrollBy({top:-g.y,behavior:s});break}}this.handleMove(t,je(Fe(f,this.referenceCoordinates),g))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}kt.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=mn,onActivation:i}=t,{active:o}=n;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const s=o.activatorNode.current;return s&&e.target!==s?!1:(e.preventDefault(),i==null||i({event:e.nativeEvent}),!0)}return!1}}];function qt(e){return!!(e&&"distance"in e)}function Kt(e){return!!(e&&"delay"in e)}class jt{constructor(t,n,r){var i;r===void 0&&(r=Vr(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:o}=t,{target:a}=o;this.props=t,this.events=n,this.document=Me(a),this.documentListeners=new Pe(this.document),this.listeners=new Pe(r),this.windowListeners=new Pe(K(a)),this.initialCoordinates=(i=bt(o))!=null?i:oe,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(re.Resize,this.handleCancel),this.windowListeners.add(re.DragStart,Gt),this.windowListeners.add(re.VisibilityChange,this.handleCancel),this.windowListeners.add(re.ContextMenu,Gt),this.documentListeners.add(re.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Kt(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(qt(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:i}=this.props;i(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(re.Click,Yr,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(re.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:i,props:o}=this,{onMove:a,options:{activationConstraint:s}}=o;if(!i)return;const d=(n=bt(t))!=null?n:oe,u=Fe(i,d);if(!r&&s){if(qt(s)){if(s.tolerance!=null&&gt(u,s.tolerance))return this.handleCancel();if(gt(u,s.distance))return this.handleStart()}if(Kt(s)&&gt(u,s.tolerance))return this.handleCancel();this.handlePending(s,u);return}t.cancelable&&t.preventDefault(),a(d)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===M.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Gr={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Et extends jt{constructor(t){const{event:n}=t,r=Me(n.target);super(t,Gr,r)}}Et.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const qr={move:{name:"mousemove"},end:{name:"mouseup"}};var mt;(function(e){e[e.RightClick=2]="RightClick"})(mt||(mt={}));class Kr extends jt{constructor(t){super(t,qr,Me(t.event.target))}}Kr.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===mt.RightClick?!1:(r==null||r({event:n}),!0)}}];const pt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Jr extends jt{constructor(t){super(t,pt)}static setup(){return window.addEventListener(pt.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(pt.move.name,t)};function t(){}}}Jr.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:i}=n;return i.length>1?!1:(r==null||r({event:n}),!0)}}];var $e;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})($e||($e={}));var et;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(et||(et={}));function Qr(e){let{acceleration:t,activator:n=$e.Pointer,canScroll:r,draggingRect:i,enabled:o,interval:a=5,order:s=et.TreeOrder,pointerCoordinates:d,scrollableAncestors:u,scrollableAncestorRects:h,delta:f,threshold:v}=e;const g=ei({delta:f,disabled:!o}),[k,m]=dr(),w=l.useRef({x:0,y:0}),R=l.useRef({x:0,y:0}),y=l.useMemo(()=>{switch(n){case $e.Pointer:return d?{top:d.y,bottom:d.y,left:d.x,right:d.x}:null;case $e.DraggableRect:return i}},[n,i,d]),S=l.useRef(null),N=l.useCallback(()=>{const A=S.current;if(!A)return;const p=w.current.x*R.current.x,x=w.current.y*R.current.y;A.scrollBy(p,x)},[]),j=l.useMemo(()=>s===et.TreeOrder?[...u].reverse():u,[s,u]);l.useEffect(()=>{if(!o||!u.length||!y){m();return}for(const A of j){if((r==null?void 0:r(A))===!1)continue;const p=u.indexOf(A),x=h[p];if(!x)continue;const{direction:C,speed:E}=Br(A,x,y,t,v);for(const T of["x","y"])g[T][C[T]]||(E[T]=0,C[T]=0);if(E.x>0||E.y>0){m(),S.current=A,k(N,a),w.current=E,R.current=C;return}}w.current={x:0,y:0},R.current={x:0,y:0},m()},[t,N,r,m,o,a,JSON.stringify(y),JSON.stringify(g),k,u,j,h,JSON.stringify(v)])}const Zr={x:{[$.Backward]:!1,[$.Forward]:!1},y:{[$.Backward]:!1,[$.Forward]:!1}};function ei(e){let{delta:t,disabled:n}=e;const r=vt(t);return Ve(i=>{if(n||!r||!i)return Zr;const o={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[$.Backward]:i.x[$.Backward]||o.x===-1,[$.Forward]:i.x[$.Forward]||o.x===1},y:{[$.Backward]:i.y[$.Backward]||o.y===-1,[$.Forward]:i.y[$.Forward]||o.y===1}}},[n,t,r])}function ti(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return Ve(i=>{var o;return t==null?null:(o=r??i)!=null?o:null},[r,t])}function ni(e,t){return l.useMemo(()=>e.reduce((n,r)=>{const{sensor:i}=r,o=i.activators.map(a=>({eventName:a.eventName,handler:t(a.handler,r)}));return[...n,...o]},[]),[e,t])}var He;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(He||(He={}));var yt;(function(e){e.Optimized="optimized"})(yt||(yt={}));const Jt=new Map;function ri(e,t){let{dragging:n,dependencies:r,config:i}=t;const[o,a]=l.useState(null),{frequency:s,measure:d,strategy:u}=i,h=l.useRef(e),f=w(),v=Ue(f),g=l.useCallback(function(R){R===void 0&&(R=[]),!v.current&&a(y=>y===null?R:y.concat(R.filter(S=>!y.includes(S))))},[v]),k=l.useRef(null),m=Ve(R=>{if(f&&!n)return Jt;if(!R||R===Jt||h.current!==e||o!=null){const y=new Map;for(let S of e){if(!S)continue;if(o&&o.length>0&&!o.includes(S.id)&&S.rect.current){y.set(S.id,S.rect.current);continue}const N=S.node.current,j=N?new Nt(d(N),N):null;S.rect.current=j,j&&y.set(S.id,j)}return y}return R},[e,o,n,f,d]);return l.useEffect(()=>{h.current=e},[e]),l.useEffect(()=>{f||g()},[n,f]),l.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),l.useEffect(()=>{f||typeof s!="number"||k.current!==null||(k.current=setTimeout(()=>{g(),k.current=null},s))},[s,f,g,...r]),{droppableRects:m,measureDroppableContainers:g,measuringScheduled:o!=null};function w(){switch(u){case He.Always:return!1;case He.BeforeDragging:return n;default:return!n}}}function yn(e,t){return Ve(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function ii(e,t){return yn(e,t)}function oi(e){let{callback:t,disabled:n}=e;const r=Dt(t),i=l.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return l.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function it(e){let{callback:t,disabled:n}=e;const r=Dt(t),i=l.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return l.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function si(e){return new Nt(Ae(e),e)}function Qt(e,t,n){t===void 0&&(t=si);const[r,i]=l.useState(null);function o(){i(d=>{if(!e)return null;if(e.isConnected===!1){var u;return(u=d??n)!=null?u:null}const h=t(e);return JSON.stringify(d)===JSON.stringify(h)?d:h})}const a=oi({callback(d){if(e)for(const u of d){const{type:h,target:f}=u;if(h==="childList"&&f instanceof HTMLElement&&f.contains(e)){o();break}}}}),s=it({callback:o});return ce(()=>{o(),e?(s==null||s.observe(e),a==null||a.observe(document.body,{childList:!0,subtree:!0})):(s==null||s.disconnect(),a==null||a.disconnect())},[e]),r}function ai(e){const t=yn(e);return fn(e,t)}const Zt=[];function li(e){const t=l.useRef(e),n=Ve(r=>e?r&&r!==Zt&&e&&t.current&&e.parentNode===t.current.parentNode?r:rt(e):Zt,[e]);return l.useEffect(()=>{t.current=e},[e]),n}function ci(e){const[t,n]=l.useState(null),r=l.useRef(e),i=l.useCallback(o=>{const a=ht(o.target);a&&n(s=>s?(s.set(a,xt(a)),new Map(s)):null)},[]);return l.useEffect(()=>{const o=r.current;if(e!==o){a(o);const s=e.map(d=>{const u=ht(d);return u?(u.addEventListener("scroll",i,{passive:!0}),[u,xt(u)]):null}).filter(d=>d!=null);n(s.length?new Map(s):null),r.current=e}return()=>{a(e),a(o)};function a(s){s.forEach(d=>{const u=ht(d);u==null||u.removeEventListener("scroll",i)})}},[i,e]),l.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,a)=>je(o,a),oe):xn(e):oe,[e,t])}function en(e,t){t===void 0&&(t=[]);const n=l.useRef(null);return l.useEffect(()=>{n.current=null},t),l.useEffect(()=>{const r=e!==oe;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?Fe(e,n.current):oe}function di(e){l.useEffect(()=>{if(!nt)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function ui(e,t){return l.useMemo(()=>e.reduce((n,r)=>{let{eventName:i,handler:o}=r;return n[i]=a=>{o(a,t)},n},{}),[e,t])}function wn(e){return l.useMemo(()=>e?Or(e):null,[e])}const tn=[];function fi(e,t){t===void 0&&(t=Ae);const[n]=e,r=wn(n?K(n):null),[i,o]=l.useState(tn);function a(){o(()=>e.length?e.map(d=>vn(d)?r:new Nt(t(d),d)):tn)}const s=it({callback:a});return ce(()=>{s==null||s.disconnect(),a(),e.forEach(d=>s==null?void 0:s.observe(d))},[e]),i}function hi(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Xe(t)?t:e}function gi(e){let{measure:t}=e;const[n,r]=l.useState(null),i=l.useCallback(u=>{for(const{target:h}of u)if(Xe(h)){r(f=>{const v=t(h);return f?{...f,width:v.width,height:v.height}:v});break}},[t]),o=it({callback:i}),a=l.useCallback(u=>{const h=hi(u);o==null||o.disconnect(),h&&(o==null||o.observe(h)),r(h?t(h):null)},[t,o]),[s,d]=Qe(a);return l.useMemo(()=>({nodeRef:s,rect:n,setRef:d}),[n,s,d])}const pi=[{sensor:Et,options:{}},{sensor:kt,options:{}}],vi={current:{}},Je={draggable:{measure:Wt},droppable:{measure:Wt,strategy:He.WhileDragging,frequency:yt.Optimized},dragOverlay:{measure:Ae}};class Be extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const bi={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Be,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ze},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Je,measureDroppableContainers:Ze,windowRect:null,measuringScheduled:!1},xi={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ze,draggableNodes:new Map,over:null,measureDroppableContainers:Ze},ot=l.createContext(xi),Sn=l.createContext(bi);function mi(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Be}}}function yi(e,t){switch(t.type){case L.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case L.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case L.DragEnd:case L.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case L.RegisterDroppable:{const{element:n}=t,{id:r}=n,i=new Be(e.droppable.containers);return i.set(r,n),{...e,droppable:{...e.droppable,containers:i}}}case L.SetDroppableDisabled:{const{id:n,key:r,disabled:i}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const a=new Be(e.droppable.containers);return a.set(n,{...o,disabled:i}),{...e,droppable:{...e.droppable,containers:a}}}case L.UnregisterDroppable:{const{id:n,key:r}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const o=new Be(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function wi(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:i}=l.useContext(ot),o=vt(r),a=vt(n==null?void 0:n.id);return l.useEffect(()=>{if(!t&&!r&&o&&a!=null){if(!Rt(o)||document.activeElement===o.target)return;const s=i.get(a);if(!s)return;const{activatorNode:d,node:u}=s;if(!d.current&&!u.current)return;requestAnimationFrame(()=>{for(const h of[d.current,u.current]){if(!h)continue;const f=hr(h);if(f){f.focus();break}}})}},[r,t,i,a,o]),null}function Si(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((i,o)=>o({transform:i,...r}),n):n}function Ci(e){return l.useMemo(()=>({draggable:{...Je.draggable,...e==null?void 0:e.draggable},droppable:{...Je.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Je.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Di(e){let{activeNode:t,measure:n,initialRect:r,config:i=!0}=e;const o=l.useRef(!1),{x:a,y:s}=typeof i=="boolean"?{x:i,y:i}:i;ce(()=>{if(!a&&!s||!t){o.current=!1;return}if(o.current||!r)return;const u=t==null?void 0:t.node.current;if(!u||u.isConnected===!1)return;const h=n(u),f=fn(h,r);if(a||(f.x=0),s||(f.y=0),o.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const v=hn(u);v&&v.scrollBy({top:f.y,left:f.x})}},[t,a,s,r,n])}const Cn=l.createContext({...oe,scaleX:1,scaleY:1});var me;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(me||(me={}));const Ri=l.memo(function(t){var n,r,i,o;let{id:a,accessibility:s,autoScroll:d=!0,children:u,sensors:h=pi,collisionDetection:f=jr,measuring:v,modifiers:g,...k}=t;const m=l.useReducer(yi,void 0,mi),[w,R]=m,[y,S]=mr(),[N,j]=l.useState(me.Uninitialized),A=N===me.Initialized,{draggable:{active:p,nodes:x,translate:C},droppable:{containers:E}}=w,T=p!=null?x.get(p):null,W=l.useRef({initial:null,translated:null}),G=l.useMemo(()=>{var H;return p!=null?{id:p,data:(H=T==null?void 0:T.data)!=null?H:vi,rect:W}:null},[p,T]),J=l.useRef(null),[fe,ye]=l.useState(null),[B,Ce]=l.useState(null),ie=Ue(k,Object.values(k)),we=Ye("DndDescribedBy",a),De=l.useMemo(()=>E.getEnabled(),[E]),F=Ci(v),{droppableRects:te,measureDroppableContainers:de,measuringScheduled:Se}=ri(De,{dragging:A,dependencies:[C.x,C.y],config:F.droppable}),b=ti(x,p),z=l.useMemo(()=>B?bt(B):null,[B]),I=Ln(),_=ii(b,F.draggable.measure);Di({activeNode:p!=null?x.get(p):null,config:I.layoutShiftCompensation,initialRect:_,measure:F.draggable.measure});const D=Qt(b,F.draggable.measure,_),O=Qt(b?b.parentElement:null),P=l.useRef({activatorEvent:null,active:null,activeNode:b,collisionRect:null,collisions:null,droppableRects:te,draggableNodes:x,draggingNode:null,draggingNodeRect:null,droppableContainers:E,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),X=E.getNodeFor((n=P.current.over)==null?void 0:n.id),V=gi({measure:F.dragOverlay.measure}),he=(r=V.nodeRef.current)!=null?r:b,se=A?(i=V.rect)!=null?i:D:null,At=!!(V.nodeRef.current&&V.rect),Tt=ai(At?null:D),st=wn(he?K(he):null),ge=li(A?X??b:null),We=fi(ge),Ge=Si(g,{transform:{x:C.x-Tt.x,y:C.y-Tt.y,scaleX:1,scaleY:1},activatorEvent:B,active:G,activeNodeRect:D,containerNodeRect:O,draggingNodeRect:se,over:P.current.over,overlayNodeRect:V.rect,scrollableAncestors:ge,scrollableAncestorRects:We,windowRect:st}),It=z?je(z,C):null,zt=ci(ge),En=en(zt),Mn=en(zt,[D]),Re=je(Ge,En),Ne=se?Ar(se,Ge):null,Te=G&&Ne?f({active:G,collisionRect:Ne,droppableRects:te,droppableContainers:De,pointerCoordinates:It}):null,Ot=un(Te,"id"),[pe,Lt]=l.useState(null),An=At?Ge:je(Ge,Mn),Tn=Er(An,(o=pe==null?void 0:pe.rect)!=null?o:null,D),at=l.useRef(null),Pt=l.useCallback((H,Q)=>{let{sensor:Z,options:ve}=Q;if(J.current==null)return;const ne=x.get(J.current);if(!ne)return;const ee=H.nativeEvent,ae=new Z({active:J.current,activeNode:ne,event:ee,options:ve,context:P,onAbort(U){if(!x.get(U))return;const{onDragAbort:le}=ie.current,ue={id:U};le==null||le(ue),y({type:"onDragAbort",event:ue})},onPending(U,be,le,ue){if(!x.get(U))return;const{onDragPending:ze}=ie.current,xe={id:U,constraint:be,initialCoordinates:le,offset:ue};ze==null||ze(xe),y({type:"onDragPending",event:xe})},onStart(U){const be=J.current;if(be==null)return;const le=x.get(be);if(!le)return;const{onDragStart:ue}=ie.current,Ie={activatorEvent:ee,active:{id:be,data:le.data,rect:W}};Le.unstable_batchedUpdates(()=>{ue==null||ue(Ie),j(me.Initializing),R({type:L.DragStart,initialCoordinates:U,active:be}),y({type:"onDragStart",event:Ie}),ye(at.current),Ce(ee)})},onMove(U){R({type:L.DragMove,coordinates:U})},onEnd:ke(L.DragEnd),onCancel:ke(L.DragCancel)});at.current=ae;function ke(U){return async function(){const{active:le,collisions:ue,over:Ie,scrollAdjustedTranslate:ze}=P.current;let xe=null;if(le&&ze){const{cancelDrop:Oe}=ie.current;xe={activatorEvent:ee,active:le,collisions:ue,delta:ze,over:Ie},U===L.DragEnd&&typeof Oe=="function"&&await Promise.resolve(Oe(xe))&&(U=L.DragCancel)}J.current=null,Le.unstable_batchedUpdates(()=>{R({type:U}),j(me.Uninitialized),Lt(null),ye(null),Ce(null),at.current=null;const Oe=U===L.DragEnd?"onDragEnd":"onDragCancel";if(xe){const lt=ie.current[Oe];lt==null||lt(xe),y({type:Oe,event:xe})}})}}},[x]),In=l.useCallback((H,Q)=>(Z,ve)=>{const ne=Z.nativeEvent,ee=x.get(ve);if(J.current!==null||!ee||ne.dndKit||ne.defaultPrevented)return;const ae={active:ee};H(Z,Q.options,ae)===!0&&(ne.dndKit={capturedBy:Q.sensor},J.current=ve,Pt(Z,Q))},[x,Pt]),$t=ni(h,In);di(h),ce(()=>{D&&N===me.Initializing&&j(me.Initialized)},[D,N]),l.useEffect(()=>{const{onDragMove:H}=ie.current,{active:Q,activatorEvent:Z,collisions:ve,over:ne}=P.current;if(!Q||!Z)return;const ee={active:Q,activatorEvent:Z,collisions:ve,delta:{x:Re.x,y:Re.y},over:ne};Le.unstable_batchedUpdates(()=>{H==null||H(ee),y({type:"onDragMove",event:ee})})},[Re.x,Re.y]),l.useEffect(()=>{const{active:H,activatorEvent:Q,collisions:Z,droppableContainers:ve,scrollAdjustedTranslate:ne}=P.current;if(!H||J.current==null||!Q||!ne)return;const{onDragOver:ee}=ie.current,ae=ve.get(Ot),ke=ae&&ae.rect.current?{id:ae.id,rect:ae.rect.current,data:ae.data,disabled:ae.disabled}:null,U={active:H,activatorEvent:Q,collisions:Z,delta:{x:ne.x,y:ne.y},over:ke};Le.unstable_batchedUpdates(()=>{Lt(ke),ee==null||ee(U),y({type:"onDragOver",event:U})})},[Ot]),ce(()=>{P.current={activatorEvent:B,active:G,activeNode:b,collisionRect:Ne,collisions:Te,droppableRects:te,draggableNodes:x,draggingNode:he,draggingNodeRect:se,droppableContainers:E,over:pe,scrollableAncestors:ge,scrollAdjustedTranslate:Re},W.current={initial:se,translated:Ne}},[G,b,Te,Ne,x,he,se,te,E,pe,ge,Re]),Qr({...I,delta:C,draggingRect:Ne,pointerCoordinates:It,scrollableAncestors:ge,scrollableAncestorRects:We});const zn=l.useMemo(()=>({active:G,activeNode:b,activeNodeRect:D,activatorEvent:B,collisions:Te,containerNodeRect:O,dragOverlay:V,draggableNodes:x,droppableContainers:E,droppableRects:te,over:pe,measureDroppableContainers:de,scrollableAncestors:ge,scrollableAncestorRects:We,measuringConfiguration:F,measuringScheduled:Se,windowRect:st}),[G,b,D,B,Te,O,V,x,E,te,pe,de,ge,We,F,Se,st]),On=l.useMemo(()=>({activatorEvent:B,activators:$t,active:G,activeNodeRect:D,ariaDescribedById:{draggable:we},dispatch:R,draggableNodes:x,over:pe,measureDroppableContainers:de}),[B,$t,G,D,R,we,x,pe,de]);return q.createElement(ln.Provider,{value:S},q.createElement(ot.Provider,{value:On},q.createElement(Sn.Provider,{value:zn},q.createElement(Cn.Provider,{value:Tn},u)),q.createElement(wi,{disabled:(s==null?void 0:s.restoreFocus)===!1})),q.createElement(Sr,{...s,hiddenTextDescribedById:we}));function Ln(){const H=(fe==null?void 0:fe.autoScrollEnabled)===!1,Q=typeof d=="object"?d.enabled===!1:d===!1,Z=A&&!H&&!Q;return typeof d=="object"?{...d,enabled:Z}:{enabled:Z}}}),Ni=l.createContext(null),nn="button",ki="Draggable";function ji(e){let{id:t,data:n,disabled:r=!1,attributes:i}=e;const o=Ye(ki),{activators:a,activatorEvent:s,active:d,activeNodeRect:u,ariaDescribedById:h,draggableNodes:f,over:v}=l.useContext(ot),{role:g=nn,roleDescription:k="draggable",tabIndex:m=0}=i??{},w=(d==null?void 0:d.id)===t,R=l.useContext(w?Cn:Ni),[y,S]=Qe(),[N,j]=Qe(),A=ui(a,t),p=Ue(n);ce(()=>(f.set(t,{id:t,key:o,node:y,activatorNode:N,data:p}),()=>{const C=f.get(t);C&&C.key===o&&f.delete(t)}),[f,t]);const x=l.useMemo(()=>({role:g,tabIndex:m,"aria-disabled":r,"aria-pressed":w&&g===nn?!0:void 0,"aria-roledescription":k,"aria-describedby":h.draggable}),[r,g,m,w,k,h.draggable]);return{active:d,activatorEvent:s,activeNodeRect:u,attributes:x,isDragging:w,listeners:r?void 0:A,node:y,over:v,setNodeRef:S,setActivatorNodeRef:j,transform:R}}function Ei(){return l.useContext(Sn)}const Mi="Droppable",Ai={timeout:25};function Ti(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:i}=e;const o=Ye(Mi),{active:a,dispatch:s,over:d,measureDroppableContainers:u}=l.useContext(ot),h=l.useRef({disabled:n}),f=l.useRef(!1),v=l.useRef(null),g=l.useRef(null),{disabled:k,updateMeasurementsFor:m,timeout:w}={...Ai,...i},R=Ue(m??r),y=l.useCallback(()=>{if(!f.current){f.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{u(Array.isArray(R.current)?R.current:[R.current]),g.current=null},w)},[w]),S=it({callback:y,disabled:k||!a}),N=l.useCallback((x,C)=>{S&&(C&&(S.unobserve(C),f.current=!1),x&&S.observe(x))},[S]),[j,A]=Qe(N),p=Ue(t);return l.useEffect(()=>{!S||!j.current||(S.disconnect(),f.current=!1,S.observe(j.current))},[j,S]),l.useEffect(()=>(s({type:L.RegisterDroppable,element:{id:r,key:o,disabled:n,node:j,rect:v,data:p}}),()=>s({type:L.UnregisterDroppable,key:o,id:r})),[r]),l.useEffect(()=>{n!==h.current.disabled&&(s({type:L.SetDroppableDisabled,id:r,key:o,disabled:n}),h.current.disabled=n)},[r,o,n,s]),{active:a,rect:v,isOver:(d==null?void 0:d.id)===r,node:j,over:d,setNodeRef:A}}function Mt(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function Ii(e,t){return e.reduce((n,r,i)=>{const o=t.get(r);return o&&(n[i]=o),n},Array(e.length))}function qe(e){return e!==null&&e>=0}function zi(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Oi(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Dn=e=>{let{rects:t,activeIndex:n,overIndex:r,index:i}=e;const o=Mt(t,r,n),a=t[i],s=o[i];return!s||!a?null:{x:s.left-a.left,y:s.top-a.top,scaleX:s.width/a.width,scaleY:s.height/a.height}},Ke={scaleX:1,scaleY:1},Li=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:i,rects:o,overIndex:a}=e;const s=(t=o[n])!=null?t:r;if(!s)return null;if(i===n){const u=o[a];return u?{x:0,y:n<a?u.top+u.height-(s.top+s.height):u.top-s.top,...Ke}:null}const d=Pi(o,i,n);return i>n&&i<=a?{x:0,y:-s.height-d,...Ke}:i<n&&i>=a?{x:0,y:s.height+d,...Ke}:{x:0,y:0,...Ke}};function Pi(e,t,n){const r=e[t],i=e[t-1],o=e[t+1];return r?n<t?i?r.top-(i.top+i.height):o?o.top-(r.top+r.height):0:o?o.top-(r.top+r.height):i?r.top-(i.top+i.height):0:0}const Rn="Sortable",Nn=q.createContext({activeIndex:-1,containerId:Rn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Dn,disabled:{draggable:!1,droppable:!1}});function $i(e){let{children:t,id:n,items:r,strategy:i=Dn,disabled:o=!1}=e;const{active:a,dragOverlay:s,droppableRects:d,over:u,measureDroppableContainers:h}=Ei(),f=Ye(Rn,n),v=s.rect!==null,g=l.useMemo(()=>r.map(A=>typeof A=="object"&&"id"in A?A.id:A),[r]),k=a!=null,m=a?g.indexOf(a.id):-1,w=u?g.indexOf(u.id):-1,R=l.useRef(g),y=!zi(g,R.current),S=w!==-1&&m===-1||y,N=Oi(o);ce(()=>{y&&k&&h(g)},[y,g,k,h]),l.useEffect(()=>{R.current=g},[g]);const j=l.useMemo(()=>({activeIndex:m,containerId:f,disabled:N,disableTransforms:S,items:g,overIndex:w,useDragOverlay:v,sortedRects:Ii(g,d),strategy:i}),[m,f,N.draggable,N.droppable,S,g,w,d,v,i]);return q.createElement(Nn.Provider,{value:j},t)}const Bi=e=>{let{id:t,items:n,activeIndex:r,overIndex:i}=e;return Mt(n,r,i).indexOf(t)},Ui=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:i,items:o,newIndex:a,previousItems:s,previousContainerId:d,transition:u}=e;return!u||!r||s!==o&&i===a?!1:n?!0:a!==i&&t===d},Fi={duration:200,easing:"ease"},kn="transform",_i=_e.Transition.toString({property:kn,duration:0,easing:"linear"}),Hi={roleDescription:"sortable"};function Xi(e){let{disabled:t,index:n,node:r,rect:i}=e;const[o,a]=l.useState(null),s=l.useRef(n);return ce(()=>{if(!t&&n!==s.current&&r.current){const d=i.current;if(d){const u=Ae(r.current,{ignoreTransform:!0}),h={x:d.left-u.left,y:d.top-u.top,scaleX:d.width/u.width,scaleY:d.height/u.height};(h.x||h.y)&&a(h)}}n!==s.current&&(s.current=n)},[t,n,r,i]),l.useEffect(()=>{o&&a(null)},[o]),o}function Vi(e){let{animateLayoutChanges:t=Ui,attributes:n,disabled:r,data:i,getNewIndex:o=Bi,id:a,strategy:s,resizeObserverConfig:d,transition:u=Fi}=e;const{items:h,containerId:f,activeIndex:v,disabled:g,disableTransforms:k,sortedRects:m,overIndex:w,useDragOverlay:R,strategy:y}=l.useContext(Nn),S=Yi(r,g),N=h.indexOf(a),j=l.useMemo(()=>({sortable:{containerId:f,index:N,items:h},...i}),[f,i,N,h]),A=l.useMemo(()=>h.slice(h.indexOf(a)),[h,a]),{rect:p,node:x,isOver:C,setNodeRef:E}=Ti({id:a,data:j,disabled:S.droppable,resizeObserverConfig:{updateMeasurementsFor:A,...d}}),{active:T,activatorEvent:W,activeNodeRect:G,attributes:J,setNodeRef:fe,listeners:ye,isDragging:B,over:Ce,setActivatorNodeRef:ie,transform:we}=ji({id:a,data:j,attributes:{...Hi,...n},disabled:S.draggable}),De=cr(E,fe),F=!!T,te=F&&!k&&qe(v)&&qe(w),de=!R&&B,Se=de&&te?we:null,z=te?Se??(s??y)({rects:m,activeNodeRect:G,activeIndex:v,overIndex:w,index:N}):null,I=qe(v)&&qe(w)?o({id:a,items:h,activeIndex:v,overIndex:w}):N,_=T==null?void 0:T.id,D=l.useRef({activeId:_,items:h,newIndex:I,containerId:f}),O=h!==D.current.items,P=t({active:T,containerId:f,isDragging:B,isSorting:F,id:a,index:N,items:h,newIndex:D.current.newIndex,previousItems:D.current.items,previousContainerId:D.current.containerId,transition:u,wasDragging:D.current.activeId!=null}),X=Xi({disabled:!P,index:N,node:x,rect:p});return l.useEffect(()=>{F&&D.current.newIndex!==I&&(D.current.newIndex=I),f!==D.current.containerId&&(D.current.containerId=f),h!==D.current.items&&(D.current.items=h)},[F,I,f,h]),l.useEffect(()=>{if(_===D.current.activeId)return;if(_!=null&&D.current.activeId==null){D.current.activeId=_;return}const he=setTimeout(()=>{D.current.activeId=_},50);return()=>clearTimeout(he)},[_]),{active:T,activeIndex:v,attributes:J,data:j,rect:p,index:N,newIndex:I,items:h,isOver:C,isSorting:F,isDragging:B,listeners:ye,node:x,overIndex:w,over:Ce,setNodeRef:De,setActivatorNodeRef:ie,setDroppableNodeRef:E,setDraggableNodeRef:fe,transform:X??z,transition:V()};function V(){if(X||O&&D.current.newIndex===N)return _i;if(!(de&&!Rt(W)||!u)&&(F||P))return _e.Transition.toString({...u,property:kn})}}function Yi(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}function tt(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const Wi=[M.Down,M.Right,M.Up,M.Left],Gi=(e,t)=>{let{context:{active:n,collisionRect:r,droppableRects:i,droppableContainers:o,over:a,scrollableAncestors:s}}=t;if(Wi.includes(e.code)){if(e.preventDefault(),!n||!r)return;const d=[];o.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const v=i.get(f.id);if(v)switch(e.code){case M.Down:r.top<v.top&&d.push(f);break;case M.Up:r.top>v.top&&d.push(f);break;case M.Left:r.left>v.left&&d.push(f);break;case M.Right:r.left<v.left&&d.push(f);break}});const u=Nr({collisionRect:r,droppableRects:i,droppableContainers:d});let h=un(u,"id");if(h===(a==null?void 0:a.id)&&u.length>1&&(h=u[1].id),h!=null){const f=o.get(n.id),v=o.get(h),g=v?i.get(v.id):null,k=v==null?void 0:v.node.current;if(k&&g&&f&&v){const w=rt(k).some((A,p)=>s[p]!==A),R=jn(f,v),y=qi(f,v),S=w||!R?{x:0,y:0}:{x:y?r.width-g.width:0,y:y?r.height-g.height:0},N={x:g.left,y:g.top};return S.x&&S.y?N:Fe(N,S)}}}};function jn(e,t){return!tt(e)||!tt(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function qi(e,t){return!tt(e)||!tt(t)||!jn(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}function Ki({id:e,children:t,editMode:n}){const{attributes:r,listeners:i,setNodeRef:o,transform:a,transition:s,isDragging:d}=Vi({id:e}),u={transform:_e.Transform.toString(a),transition:s,zIndex:d?50:"auto",opacity:d?.3:1};return c.jsxs("div",{ref:o,style:u,className:"relative",children:[n&&c.jsx("div",{...r,...i,className:"absolute left-[-40px] top-6 p-2 cursor-grab active:cursor-grabbing text-gray-500 hover:text-white transition-colors touch-none",title:"Trascina per riordinare",children:c.jsx(Qn,{size:24})}),t]})}const Ji=({onFormat:e,onUndo:t,visible:n,canUndo:r})=>{const[i,o]=l.useState(!1),a=[{name:"Verde",value:"#00ff85"},{name:"Rosso",value:"#ff4444"},{name:"Azzurro",value:"#00d4ff"},{name:"Rosa",value:"#ff2882"},{name:"Viola",value:"#a855f7"},{name:"Giallo",value:"#fbbf24"},{name:"Bianco",value:"#ffffff"},{name:"Grigio",value:"#9ca3af"}];return n?c.jsxs("div",{className:"fixed right-4 top-1/2 -translate-y-1/2 bg-pl-dark/95 backdrop-blur-lg border border-white/20 rounded-xl shadow-2xl p-4 z-40 w-64",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"text-white font-bold text-sm",children:"Formatta Testo"}),c.jsx("button",{onMouseDown:s=>{s.preventDefault(),t()},disabled:!r,className:`p-2 rounded-lg transition ${r?"bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-400":"bg-white/5 text-gray-500 cursor-not-allowed"}`,title:"Annulla (Undo)",children:c.jsx(rr,{size:16})})]}),c.jsxs("div",{className:"mb-3",children:[c.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"Stile"}),c.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[c.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("strong")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Grassetto",children:c.jsx(Kn,{size:18})}),c.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("em")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Corsivo",children:c.jsx(Zn,{size:18})}),c.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("u")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Sottolineato",children:c.jsx(nr,{size:18})})]})]}),c.jsxs("div",{className:"mb-3",children:[c.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"Dimensione"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onMouseDown:s=>{s.preventDefault(),e("font-size-increase")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition flex items-center justify-center gap-1",title:"Aumenta",children:[c.jsx(on,{size:16}),c.jsx(Ut,{size:16})]}),c.jsxs("button",{onMouseDown:s=>{s.preventDefault(),e("font-size-decrease")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition flex items-center justify-center gap-1",title:"Diminuisci",children:[c.jsx(_n,{size:16}),c.jsx(Ut,{size:16})]})]})]}),c.jsxs("div",{className:"mb-3",children:[c.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"Allineamento"}),c.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[c.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("align-left")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Sinistra",children:c.jsx(Yn,{size:16})}),c.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("align-center")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Centro",children:c.jsx(Xn,{size:16})}),c.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("align-right")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Destra",children:c.jsx(Wn,{size:16})}),c.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("align-justify")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Giustificato",children:c.jsx(Vn,{size:16})})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("p",{className:"text-gray-400 text-xs",children:"Colore"}),c.jsx("button",{onMouseDown:s=>{s.preventDefault(),o(!i)},className:"p-1 bg-white/10 hover:bg-white/20 rounded text-white transition",children:c.jsx(er,{size:16})})]}),i&&c.jsx("div",{className:"grid grid-cols-4 gap-2",children:a.map(s=>c.jsx("button",{onMouseDown:d=>{d.preventDefault(),e("color",s.value),o(!1)},className:"w-8 h-8 rounded-lg border-2 border-white/20 hover:border-white/50 transition",style:{backgroundColor:s.value},title:s.name},s.value))})]}),c.jsx("div",{className:"mt-3 pt-3 border-t border-white/10",children:c.jsx("p",{className:"text-gray-400 text-xs",children:"Seleziona testo nella textarea per formattare"})})]}):null};function to(){const{user:e,hasRole:t}=wt(),{loading:n,saving:r,cenniPrincipali:i,sections:o,archivedRules:a,undoHistory:s,setCenniPrincipali:d,setSections:u,loadRules:h,saveRules:f,updateSection:v,addSection:g,removeSection:k,addToUndoHistory:m,undo:w,clearUndoHistory:R}=or(),[y,S]=l.useState(!1),[N,j]=l.useState(null),[A,p]=l.useState(!1),[x,C]=l.useState(!1),[E,T]=l.useState(null),[W,G]=l.useState(null),[J,fe]=l.useState(null),ye=l.useRef(null),B=l.useRef({}),Ce=Cr(Xt(Et),Xt(kt,{coordinateGetter:Gi})),ie=b=>{const{active:z,over:I}=b;z.id!==(I==null?void 0:I.id)&&I&&u(_=>{const D=_.findIndex(P=>P.id===z.id),O=_.findIndex(P=>P.id===I.id);return Mt(_,D,O)})};l.useEffect(()=>{if(!y||!t("admin")){C(!1);return}const b=z=>{const I=z.target;I.tagName==="TEXTAREA"&&I.selectionStart!==I.selectionEnd?(T(I),G({start:I.selectionStart,end:I.selectionEnd}),C(!0)):setTimeout(()=>{I.tagName==="TEXTAREA"&&I.selectionStart===I.selectionEnd&&(C(!1),G(null))},100)};return document.addEventListener("selectionchange",b),document.addEventListener("mouseup",b),()=>{document.removeEventListener("selectionchange",b),document.removeEventListener("mouseup",b)}},[y,t]);const we=(b,z)=>{if(!E||!W)return;const{start:I,end:_}=W,D=E.value.substring(I,_);if(!D)return;let O="";switch(b){case"strong":O=`<strong>${D}</strong>`;break;case"em":O=`<em>${D}</em>`;break;case"u":O=`<u>${D}</u>`;break;case"font-size-increase":O=`<span style="font-size: 1.2em;">${D}</span>`;break;case"font-size-decrease":O=`<span style="font-size: 0.9em;">${D}</span>`;break;case"color":O=`<span style="color: ${z};">${D}</span>`;break;case"align-left":O=`<div style="text-align: left;">${D}</div>`;break;case"align-center":O=`<div style="text-align: center;">${D}</div>`;break;case"align-right":O=`<div style="text-align: right;">${D}</div>`;break;case"align-justify":O=`<div style="text-align: justify;">${D}</div>`;break;default:return}const P=E.value.substring(0,I)+O+E.value.substring(_),X=E.getAttribute("data-field");if(X&&m(X,E.value),X==="mainText")d(V=>({...V,mainText:P}));else if(X==="partecipanti")d(V=>({...V,partecipanti:P}));else if(X!=null&&X.startsWith("section-")){const V=parseInt(X.replace("section-",""));u(he=>he.map(se=>se.id===V?{...se,content:P}:se))}setTimeout(()=>{E&&(E.focus(),E.setSelectionRange(I+O.length,I+O.length))},50)},De=()=>{w(),C(!0)},F=async()=>{await f()?(alert("Regolamento salvato con successo!"),S(!1),R()):alert("Errore durante il salvataggio.")},te=b=>{j(b),p(!0),setTimeout(()=>{var z;(z=B.current[b])==null||z.scrollIntoView({behavior:"smooth",block:"start"})},100)},de=()=>{j(null),setTimeout(()=>{var b;(b=ye.current)==null||b.scrollIntoView({behavior:"smooth",block:"start"})},100)},Se=b=>{N===b?(j(null),p(!1)):(j(b),p(!1))};return n?c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pl-dark via-pl-dark to-pl-purple flex items-center justify-center",children:c.jsx("div",{className:"text-white text-xl",children:"Caricamento regolamento..."})}):c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pl-dark via-pl-dark to-pl-purple py-8",children:c.jsxs("div",{className:"max-w-5xl mx-auto px-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-8",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Jn,{className:"w-10 h-10 text-pl-pink"}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-4xl font-black text-white",children:"Regolamento PianginaCUP"}),c.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Stagione 2025/26"})]})]}),t("admin")&&c.jsx("div",{className:"flex gap-2",children:y?c.jsx("span",{className:"text-pl-pink text-sm",children:"✏️ Modalità Modifica Attiva"}):c.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-2 px-4 py-2 bg-pl-pink/20 hover:bg-pl-pink/30 rounded-lg text-white border border-pl-pink/50 transition",children:[c.jsx(tr,{size:18}),"Modifica"]})})]}),y&&t("admin")&&c.jsxs("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 bg-pl-dark/95 backdrop-blur-lg border border-white/20 rounded-xl shadow-2xl px-6 py-3 z-50 flex gap-4",children:[c.jsxs("button",{onClick:F,disabled:r,className:"flex items-center gap-2 px-5 py-2 bg-green-500/20 hover:bg-green-500/30 rounded-lg text-white border border-green-500/50 transition disabled:opacity-50",children:[c.jsx(Bn,{size:18}),r?"Salvataggio...":"Salva Modifiche"]}),c.jsxs("button",{onClick:()=>{S(!1),R(),h()},className:"flex items-center gap-2 px-5 py-2 bg-red-500/20 hover:bg-red-500/30 rounded-lg text-white border border-red-500/50 transition",children:[c.jsx(rn,{size:18}),"Annulla"]})]}),c.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-start",children:[c.jsxs("div",{className:"w-full md:w-1/4 md:sticky md:top-8 order-1",children:[c.jsxs("div",{ref:ye,className:"bg-white/10 backdrop-blur-xl rounded-2xl p-6 border border-white/20",children:[c.jsx("h2",{className:"text-xl font-bold text-pl-teal mb-4 flex items-center gap-2",children:"📑 Indice"}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("button",{onClick:()=>te(-1),className:"text-left text-gray-300 hover:text-white font-medium px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition text-sm",children:i.title||"1. Cenni Principali e Avvertenze"}),o.map(b=>c.jsx("button",{onClick:()=>te(b.id),className:"text-left text-gray-300 hover:text-white font-medium px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition text-sm",children:b.title},b.id))]})]}),c.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-6 border border-white/20 mt-4",children:[c.jsxs("h2",{className:"text-xl font-bold text-amber-400 mb-4 flex items-center gap-2",children:[c.jsx(Gn,{size:24}),"Archivio"]}),a.length===0?c.jsx("p",{className:"text-gray-400 text-sm italic",children:"Nessun archivio."}):c.jsx("div",{className:"space-y-2",children:a.map(b=>c.jsxs("button",{onClick:()=>fe(b),className:"w-full text-left text-gray-300 hover:text-white font-medium px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition text-sm flex items-center gap-2",children:[c.jsx(Un,{size:14,className:"text-amber-400"}),c.jsxs("span",{children:["Stagione ",b.season]})]},b.$id))})]})]}),c.jsxs("div",{className:"w-full md:w-3/4 order-2 space-y-8",children:[c.jsxs("div",{ref:b=>B.current[-1]=b,className:"bg-white/10 backdrop-blur-xl rounded-2xl p-8 border border-white/20",children:[c.jsx("div",{className:"text-center mb-8",children:y&&t("admin")?c.jsx("input",{type:"text",value:i.title||"1. Cenni Principali e Avvertenze",onChange:b=>d(z=>({...z,title:b.target.value})),className:"text-3xl font-bold text-pl-teal bg-transparent border-b border-pl-pink/30 focus:outline-none focus:border-pl-pink text-center w-full"}):c.jsx("h2",{className:"text-3xl font-bold text-pl-teal",children:i.title||"1. Cenni Principali e Avvertenze"})}),c.jsx("div",{className:"text-gray-200 leading-relaxed space-y-4",children:c.jsx(_t,{value:i.mainText,onChange:b=>d(z=>({...z,mainText:b})),editMode:y,multiline:!0,dataField:"mainText"})})]}),c.jsx(Ri,{sensors:Ce,collisionDetection:Rr,onDragEnd:ie,children:c.jsx($i,{items:o.map(b=>b.id),strategy:Li,disabled:!y||!t("admin"),children:c.jsxs("div",{className:"space-y-4",children:[y&&t("admin")&&c.jsxs("button",{onClick:g,className:"w-full flex items-center justify-center gap-2 py-3 bg-pl-teal/20 hover:bg-pl-teal/30 rounded-xl text-white border border-pl-teal/50 transition",children:[c.jsx(on,{size:20}),"Aggiungi Sezione"]}),o.map(b=>c.jsx(Ki,{id:b.id,editMode:y&&t("admin"),children:c.jsxs("div",{ref:z=>B.current[b.id]=z,className:"bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 overflow-hidden",children:[c.jsxs("div",{className:"flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition",onClick:()=>Se(b.id),children:[y&&t("admin")?c.jsx("input",{type:"text",value:b.title,onChange:z=>v(b.id,"title",z.target.value),onClick:z=>z.stopPropagation(),className:"flex-1 text-xl font-bold text-white bg-transparent border-b border-pl-pink/30 focus:outline-none focus:border-pl-pink text-center"}):c.jsx("h3",{className:"flex-1 text-xl font-bold text-white text-center",children:b.title}),c.jsx(Fn,{size:24,className:`text-gray-400 transition-transform ml-4 ${N===b.id?"rotate-180":""}`}),y&&t("admin")&&c.jsx("button",{onClick:z=>{z.stopPropagation(),k(b.id)},className:"ml-2 p-2 bg-red-500/20 hover:bg-red-500/30 rounded-lg text-red-400 border border-red-500/50 transition",children:c.jsx(Hn,{size:18})})]}),N===b.id&&c.jsxs("div",{className:"p-6 pt-0 border-t border-white/10",children:[c.jsx("div",{className:"text-gray-200 leading-relaxed space-y-3",children:c.jsx(_t,{value:b.content,onChange:z=>v(b.id,"content",z),editMode:y,multiline:!0,dataField:`section-${b.id}`})}),A&&N===b.id&&c.jsxs("button",{onClick:de,className:"mt-6 flex items-center gap-2 px-4 py-2 bg-pl-teal/20 hover:bg-pl-teal/30 rounded-lg text-white border border-pl-teal/50 transition mx-auto md:hidden",children:[c.jsx(qn,{size:18}),"Torna all'Indice"]})]})]})},b.id))]})})})]}),J&&c.jsx(sr,{archive:J,onClose:()=>fe(null)}),y&&t("admin")&&c.jsx(Ji,{visible:x,onFormat:we,onUndo:De,canUndo:s.length>0})]})]})})}export{to as Rules};
