import{r as c,a as V,j as e,P as xe,X as F,s as W,q as M,L as ee,S as ue,b as pe,p as me,t as he,v as ge,w as be,u as fe,x as we,y as Z,i as ve,d as _,D as k,g as je,Q as P,l as T,n as Ne,z as O}from"./index-IQCk0ePk.js";import{T as I}from"./trash-2-DbOOYVSY.js";const ye=({isOpen:m,player:d,managers:h,onClose:r,onSave:g})=>{const[x,u]=c.useState({}),[b,f]=c.useState(!1);c.useEffect(()=>{d&&u({position:d.position,quotation:d.quotation||0,purchase_price:d.purchase_price||0,owner:d.owner||""})},[d]);const N=async()=>{if(d){f(!0);try{await g(d,x)}finally{f(!1)}}};return!m||!d?null:V.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 transition-opacity animate-in fade-in duration-200",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-lg mx-4 bg-[#18181b] rounded-2xl border border-white/10 shadow-[0_20px_60px_-15px_rgba(0,0,0,0.5)] overflow-hidden animate-in zoom-in-95 fade-in duration-200",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-pl-teal/50 to-transparent"}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/5",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(xe,{size:18,className:"text-pl-teal"}),"Modifica Giocatore"]}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[d.name," (",d.team_short_name,")"]})]}),e.jsx("button",{onClick:r,className:"text-gray-500 hover:text-white transition p-2 hover:bg-white/10 rounded-lg",children:e.jsx(F,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs uppercase font-bold text-gray-500 tracking-wider",children:"Ruolo Fanta"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:W.map(s=>e.jsx("button",{onClick:()=>u({...x,position:s}),className:`py-2 px-1 rounded-lg text-[10px] font-bold uppercase transition border ${x.position===s?s==="Portiere"?"bg-yellow-500 text-black border-yellow-500":s==="Difensore"?"bg-blue-500 text-white border-blue-500":s==="Centrocampista"?"bg-green-500 text-white border-green-500":"bg-red-500 text-white border-red-500":"bg-white/5 text-gray-400 border-transparent hover:bg-white/10"}`,children:s},s))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs uppercase font-bold text-gray-500 tracking-wider",children:"Quotazione"}),e.jsx("input",{type:"number",value:x.quotation,onChange:s=>u({...x,quotation:s.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-pl-teal outline-none transition font-mono"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs uppercase font-bold text-gray-500 tracking-wider",children:"Prezzo Acquisto"}),e.jsx("input",{type:"number",value:x.purchase_price,onChange:s=>u({...x,purchase_price:s.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-pl-teal outline-none transition font-mono"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs uppercase font-bold text-gray-500 tracking-wider flex justify-between",children:["Proprietario",x.position==="Portiere"&&e.jsxs("span",{className:"text-pl-teal text-[10px] items-center flex gap-1",children:[e.jsx(M,{size:10})," Gestito da Blocco Squadra"]})]}),e.jsxs("select",{value:x.owner||"",onChange:s=>u({...x,owner:s.target.value}),disabled:x.position==="Portiere",className:`w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-pl-teal outline-none transition ${x.position==="Portiere"?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"-- Svincolato --"}),h.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"p-6 border-t border-white/5 flex justify-end gap-3 bg-black/20 rounded-b-2xl",children:[e.jsx("button",{onClick:r,className:"px-5 py-2.5 rounded-xl text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition",children:"Annulla"}),e.jsxs("button",{onClick:N,disabled:b,className:"px-6 py-2.5 rounded-xl text-sm font-bold text-pl-dark bg-pl-teal hover:bg-pl-teal/90 transition shadow-lg shadow-pl-teal/20 flex items-center gap-2",children:[b?e.jsx(ee,{size:16,className:"animate-spin"}):e.jsx(ue,{size:16}),"Salva Modifiche"]})]})]})]}),document.body)},_e=({isOpen:m,realTeams:d,managers:h,onClose:r,onSaveBlock:g,onUpdateTeamLocal:x,getGKsByTeam:u})=>{const[b,f]=c.useState(null);if(!m)return null;const N=[...d].sort((s,w)=>(s.short_name||"").localeCompare(w.short_name||""));return V.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-2xl bg-[#18181b] rounded-2xl border border-white/10 shadow-2xl overflow-hidden animate-in zoom-in-95 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-black/20",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(M,{className:"text-pl-teal",size:20}),"Blocchi Portieri"]}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Assegna l'intero reparto portieri a un manager."})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white",children:e.jsx(F,{size:20})})]}),e.jsx("div",{className:"p-4 md:p-6 overflow-y-auto space-y-4 max-h-[70vh]",children:N.map(s=>{const w=b===s.$id,y=u(s.$id);return e.jsxs("div",{className:"bg-[#1e1e24] border border-white/5 rounded-xl overflow-hidden shadow-lg transition-all hover:border-white/10",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer bg-white/[0.02] hover:bg-white/[0.05] transition",onClick:()=>f(w?null:s.$id),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 flex-shrink-0",children:s.logo_url?e.jsx("img",{src:s.logo_url,alt:s.short_name,className:"w-full h-full object-contain drop-shadow-[0_2px_4px_rgba(0,0,0,0.5)]"}):e.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-gray-800 to-black border border-white/10 flex items-center justify-center font-bold text-gray-500 text-xs shadow-inner",children:s.short_name?s.short_name.substring(0,3):s.name.substring(0,3)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold text-lg tracking-wide",children:s.short_name||s.name}),e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5 font-medium",children:[y.length," Portieri"]})]})]}),e.jsx("div",{className:`p-2 rounded-full transition-transform duration-300 ${w?"rotate-180 bg-white/10":""}`,children:e.jsx(pe,{size:20,className:"text-gray-400"})})]}),w&&e.jsxs("div",{className:"p-4 border-t border-white/5 bg-black/20 space-y-6 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-6 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500 tracking-wider",children:"Proprietario Blocco"}),e.jsxs("select",{value:s.goalkeeper_owner||"",onChange:o=>g(s.$id,o.target.value||null,s.goalkeeper_quotation||0,s.goalkeeper_purchase_price||0),onClick:o=>o.stopPropagation(),className:"w-full bg-black/40 border border-white/10 rounded-xl px-3 py-2.5 text-sm text-white focus:border-pl-teal outline-none transition",children:[e.jsx("option",{value:"",children:"-- Svincolato --"}),h.map(o=>e.jsx("option",{value:o.name,children:o.name},o.id))]})]}),e.jsxs("div",{className:"md:col-span-3 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500 tracking-wider",children:"Quot. Totale"}),e.jsx("input",{type:"number",value:s.goalkeeper_quotation||"",onChange:o=>{const v=o.target.value===""?0:parseInt(o.target.value)||0;x(s.$id,{goalkeeper_quotation:v})},onBlur:o=>g(s.$id,s.goalkeeper_owner||null,parseInt(o.target.value)||0,s.goalkeeper_purchase_price||0),onClick:o=>o.stopPropagation(),placeholder:"0",className:"w-full bg-black/40 border border-white/10 rounded-xl px-3 py-2.5 text-sm text-white focus:border-pl-teal outline-none font-mono text-center"})]}),e.jsxs("div",{className:"md:col-span-3 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-500 tracking-wider",children:"Prezzo Asta"}),e.jsx("input",{type:"number",value:s.goalkeeper_purchase_price||"",onChange:o=>{const v=o.target.value===""?0:parseInt(o.target.value)||0;x(s.$id,{goalkeeper_purchase_price:v})},onBlur:o=>g(s.$id,s.goalkeeper_owner||null,s.goalkeeper_quotation||0,parseInt(o.target.value)||0),onClick:o=>o.stopPropagation(),placeholder:"0",className:"w-full bg-black/40 border border-white/10 rounded-xl px-3 py-2.5 text-sm text-pl-teal font-bold focus:border-pl-teal outline-none font-mono text-center"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs uppercase font-bold text-gray-500 tracking-wider mb-2 flex items-center gap-2",children:[e.jsx(M,{size:10}),"Portieri Inclusi"]}),e.jsxs("div",{className:"space-y-2",children:[y.map(o=>e.jsx("div",{className:"flex justify-between items-center bg-black/40 p-2 rounded-lg border border-white/5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${o.is_active?"bg-green-500":"bg-red-500"} shadow-[0_0_4px_currentColor]`}),e.jsx("span",{className:`text-sm ${o.is_active?"text-gray-300":"text-gray-500 italic line-through"}`,children:o.name})]})},o.$id)),y.length===0&&e.jsx("div",{className:"text-xs text-gray-600 italic",children:"Nessun portiere trovato."})]})]})]})]},s.$id)})})]})]}),document.body)},ke=({searchQuery:m,setSearchQuery:d,showNewOnly:h,setShowNewOnly:r,showInactiveOnly:g,setShowInactiveOnly:x,roleFilter:u,setRoleFilter:b,teamFilter:f,setTeamFilter:N,ownerFilter:s,setOwnerFilter:w,teams:y,managers:o,onReset:v})=>{const z=m||h||g||u!=="Tutti"||f!=="Tutti"||s!=="Tutti";return e.jsxs("div",{className:"flex flex-col md:flex-row flex-wrap gap-2 mt-4 w-full justify-center",children:[e.jsxs("div",{className:"relative group w-full md:w-auto",children:[e.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-hover:text-pl-teal transition-colors w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Cerca...",value:m,onChange:l=>d(l.target.value),className:"h-[42px] bg-black/30 border border-white/10 rounded-xl pl-9 pr-4 text-sm text-white w-full md:w-56 focus:border-pl-teal/50 outline-none transition-all placeholder-gray-600 focus:bg-black/50"})]}),e.jsxs("button",{onClick:()=>r(!h),className:`h-[42px] px-4 rounded-xl border flex items-center justify-start gap-2 text-sm font-bold transition whitespace-nowrap w-full md:w-fit ${h?"bg-pl-teal text-pl-dark border-pl-teal":"bg-black/30 border-white/10 text-gray-300 hover:bg-black/40"}`,children:[e.jsx(he,{size:16}),"Nuovi"]}),e.jsxs("button",{onClick:()=>x(!g),className:`h-[42px] px-4 rounded-xl border flex items-center justify-start gap-2 text-sm font-bold transition whitespace-nowrap w-full md:w-fit ${g?"bg-red-500 text-white border-red-500":"bg-black/30 border-white/10 text-gray-300 hover:bg-black/40"}`,title:"Mostra solo inattivi",children:[e.jsx(ge,{size:16}),"Inattivi"]}),e.jsxs("select",{value:u,onChange:l=>b(l.target.value),className:"h-[42px] bg-black/30 border border-white/10 rounded-xl px-4 text-sm text-gray-300 outline-none hover:bg-black/40 transition cursor-pointer w-full md:w-fit text-left",children:[e.jsx("option",{value:"Tutti",children:"Tutti i Ruoli"}),W.filter(l=>l!=="Portiere").map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsxs("select",{value:f,onChange:l=>N(l.target.value),className:"h-[42px] bg-black/30 border border-white/10 rounded-xl px-4 text-sm text-gray-300 outline-none hover:bg-black/40 transition cursor-pointer w-full md:w-fit text-left",children:[e.jsx("option",{value:"Tutti",children:"Tutte le Squadre"}),y.map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsxs("select",{value:s,onChange:l=>w(l.target.value),className:"h-[42px] bg-black/30 border border-white/10 rounded-xl px-4 text-sm text-gray-300 outline-none hover:bg-black/40 transition cursor-pointer w-full md:w-fit text-left",children:[e.jsx("option",{value:"Tutti",children:"Tutti i Proprietari"}),e.jsx("option",{value:"Svincolati",children:"Svincolati"}),o.map(l=>e.jsx("option",{value:l.name,children:l.name},l.id))]}),z&&e.jsx("button",{onClick:v,className:"h-[42px] w-[42px] rounded-xl border border-red-500/30 bg-red-500/10 text-red-400 hover:bg-red-500/20 flex items-center justify-center transition",title:"Resetta Filtri",children:e.jsx(F,{size:20})})]})},Se=({players:m,onEdit:d,onDelete:h})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block bg-[#1e1e24] border border-white/5 rounded-2xl overflow-hidden shadow-2xl max-w-6xl mx-auto",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-base",children:[e.jsx("thead",{className:"bg-black/40 text-gray-400 font-bold uppercase text-sm tracking-wider sticky top-0 backdrop-blur-sm z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Giocatore"}),e.jsx("th",{className:"px-6 py-4 w-40",children:"Ruolo"}),e.jsx("th",{className:"px-6 py-4 w-32 text-center",children:"Quotazione"}),e.jsx("th",{className:"px-6 py-4 w-32 text-center",children:"Prezzo"}),e.jsx("th",{className:"px-6 py-4 w-56",children:"Proprietario"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-10 text-center text-gray-500 italic",children:"Nessun giocatore trovato"})}):m.slice(0,150).map(r=>e.jsxs("tr",{onClick:()=>d(r),className:"hover:bg-white/[0.03] transition-colors cursor-pointer group",children:[e.jsx("td",{className:"px-6 py-3",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:`font-semibold transition-colors text-base flex items-center gap-2 ${r.is_active?"text-white group-hover:text-pl-teal":"text-gray-500 italic decoration-slate-600"}`,children:[r.name," ",!r.is_active&&"*",!r.is_active&&e.jsx("button",{onClick:g=>h(g,r),title:"Elimina definitivamente",className:"bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white p-1 rounded transition ml-2",children:e.jsx(I,{size:12})})]}),e.jsx("span",{className:`text-xs uppercase tracking-wide font-medium ${r.is_active?"text-gray-500":"text-gray-600"}`,children:r.team_short_name})]})})}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:`px-2.5 py-1 rounded-md text-xs uppercase font-bold tracking-widest border border-current opacity-80
                                                ${r.position==="Portiere"?"text-yellow-500 border-yellow-500/20 bg-yellow-500/10":r.position==="Difensore"?"text-blue-500 border-blue-500/20 bg-blue-500/10":r.position==="Centrocampista"?"text-green-500 border-green-500/20 bg-green-500/10":"text-red-500 border-red-500/20 bg-red-500/10"}`,children:r.position})}),e.jsx("td",{className:"px-6 py-3 text-center",children:e.jsx("span",{className:"text-gray-300 font-mono text-base",children:r.quotation})}),e.jsx("td",{className:"px-6 py-3 text-center",children:e.jsx("span",{className:`font-mono text-base ${r.purchase_price>0?"text-pl-teal font-bold":"text-gray-600"}`,children:r.purchase_price||"-"})}),e.jsx("td",{className:"px-6 py-3",children:r.owner?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-pl-teal shadow-[0_0_8px_rgba(56,189,248,0.5)]"}),e.jsx("span",{className:"text-sm text-white font-medium",children:r.owner})]}):e.jsx("span",{className:"text-sm text-gray-600 italic",children:"Svincolato"})})]},r.$id))})]})})}),e.jsxs("div",{className:"md:hidden space-y-3 pb-20 w-full max-w-2xl mx-auto",children:[m.length===0?e.jsx("div",{className:"text-center text-gray-500 py-10 bg-white/5 rounded-xl border border-white/5",children:"Nessun risultato"}):m.slice(0,50).map(r=>e.jsxs("div",{onClick:()=>d(r),className:"bg-[#1e1e24] border border-white/5 rounded-xl p-4 active:scale-[0.98] transition-all cursor-pointer shadow-lg relative overflow-hidden",children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${r.position==="Portiere"?"bg-yellow-500":r.position==="Difensore"?"bg-blue-500":r.position==="Centrocampista"?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{className:"flex justify-between items-start pl-3",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-2 text-left",children:[e.jsxs("h3",{className:`font-bold text-base flex items-center justify-start gap-2 ${r.is_active?"text-white":"text-gray-500 italic"}`,children:[e.jsx("span",{className:"truncate",children:r.name}),!r.is_active&&"*",!r.is_active&&e.jsx("button",{onClick:g=>h(g,r),className:"bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white p-1 rounded-full transition flex-shrink-0",children:e.jsx(I,{size:14})})]}),e.jsx("div",{className:"text-[11px] text-gray-400 font-medium uppercase tracking-wide mt-0.5 mb-1 truncate",children:r.team_short_name||r.team_name||"-"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider",children:"Prezzo"}),e.jsx("div",{className:`font-mono font-bold ${r.purchase_price>0?"text-pl-teal":"text-gray-600"}`,children:r.purchase_price||"-"})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/5 flex items-center justify-between pl-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Quotazione"}),e.jsx("span",{className:"text-sm text-white font-mono",children:r.quotation})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Proprietario"}),r.owner?e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-pl-teal shadow-[0_0_6px_rgba(56,189,248,0.5)]"}),e.jsx("span",{className:"text-xs text-white font-medium",children:r.owner})]}):e.jsx("span",{className:"text-xs text-gray-600 italic mt-0.5",children:"Svincolato"})]})]})]},r.$id)),m.length>50&&e.jsx("div",{className:"py-3 text-center text-xs text-gray-600",children:"Mostrati primi 50. Usa i filtri."})]})]}),H="real_teams",$e=()=>{const{players:m,loading:d,refresh:h,teams:r}=be(),{user:g,hasRole:x}=fe(),[u,b]=c.useState([]);c.useEffect(()=>{b(m)},[m]);const[f,N]=c.useState([]),[s,w]=c.useState(null),[y,o]=c.useState(!1),[v,z]=c.useState(!1),[l,A]=c.useState([]),te=a=>u.filter(t=>t.team_id===a&&t.position==="Portiere"),[E,Q]=c.useState(""),[q,G]=c.useState("Tutti"),[R,U]=c.useState("Tutti"),[$,K]=c.useState("Tutti"),[L,X]=c.useState(!1),[B,Y]=c.useState(!1),[se,D]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const n=(await _.listDocuments(k,je,[P.limit(100),P.equal("hidden",!1)])).documents.filter(i=>i.role!=="g_admin").map(i=>({name:i.manager_name,id:i.$id}));N(n)}catch(t){console.error("Error fetching managers:",t),T.error("Error fetching managers",{error:t})}})()},[]),c.useEffect(()=>{if(!v)return;(async()=>{try{const n=(await _.listDocuments(k,H,[P.limit(50)])).documents.map(i=>({$id:i.$id,name:i.name,short_name:i.short_name,logo_url:i.logo_url,goalkeeper_owner:i.goalkeeper_owner,goalkeeper_quotation:i.goalkeeper_quotation,goalkeeper_purchase_price:i.goalkeeper_purchase_price}));A(n)}catch(t){console.error("Error fetching teams:",t),T.error("Error fetching real teams",{error:t})}})()},[v]);const re=async(a,t,n,i)=>{try{await _.updateDocument(k,H,a,{goalkeeper_owner:t,goalkeeper_quotation:n,goalkeeper_purchase_price:i});const S=(await _.listDocuments(k,O,[P.equal("team_id",a),P.equal("position","Portiere"),P.limit(10)])).documents.map(C=>_.updateDocument(k,O,C.$id,{owner:t}));await Promise.all(S),A(C=>C.map(j=>j.$id===a?{...j,goalkeeper_owner:t,goalkeeper_quotation:n,goalkeeper_purchase_price:i}:j)),b(C=>C.map(j=>j.team_id===a&&j.position==="Portiere"?{...j,owner:t}:j))}catch(p){console.error("Error saving block:",p),T.error("Error saving block",{error:p}),alert("Errore salvataggio blocco: "+p.message)}},ae=(a,t)=>{A(n=>n.map(i=>i.$id===a?{...i,...t}:i))},ie=a=>{w(a),o(!0)},J=()=>{o(!1),w(null)},oe=async(a,t)=>{const n={position:t.position||a.position,quotation:typeof t.quotation=="string"?parseInt(t.quotation):t.quotation||a.quotation,purchase_price:typeof t.purchase_price=="string"?parseInt(t.purchase_price):t.purchase_price||a.purchase_price,owner:t.owner===""?null:t.owner===void 0?a.owner:t.owner};({...a,...n},b(i=>i.map(p=>p.$id===a.$id?{...p,...n}:p))),J();try{await _.updateDocument(k,O,a.$id,n)}catch(i){console.error("Save error:",i),T.error("Error saving player",{error:i}),alert(`Errore salvataggio: ${i.message}`),h()}},ne=async(a,t)=>{if(a.stopPropagation(),!!window.confirm(`Sei sicuro di voler eliminare definitivamente ${t.name}?`)){D(!0);try{await _.deleteDocument(k,O,t.$id),b(n=>n.filter(i=>i.$id!==t.$id))}catch(n){console.error("Delete error:",n),T.error("Error deleting player",{error:n,playerId:t.$id}),alert(`Errore eliminazione: ${n.message}`)}finally{D(!1)}}},le="reset_squads",ce=async()=>{if(window.confirm(`⚠️ SEI SICURO?

Questo svuoterà TUTTE le rose:
- Rimuoverà proprietari da tutti i giocatori
- Resetterà prezzi a 0
- Le QUOTAZIONI rimangono invariate

Questa azione NON può essere annullata!`)){D(!0);try{const a=await Ne.createExecution(le,"{}",!0);if(a.status==="completed"){const t=a.responseBody?JSON.parse(a.responseBody):{};t.success?(alert(`✅ Rose svuotate!

Giocatori: ${t.playersReset}
Blocchi: ${t.teamsReset}`),h()):alert(`Errore: ${t.error}`)}else alert("⏳ Reset in corso (background). Ricarica la pagina tra qualche secondo."),setTimeout(h,3e3)}catch(a){console.error("Reset error:",a),T.error("Error resetting squads",{error:a}),alert(`Errore reset: ${a.message}`)}finally{D(!1)}}},de=c.useMemo(()=>{let a=u;if(a=a.filter(t=>t.position!=="Portiere"),E&&(a=a.filter(t=>we(t.name,E))),q!=="Tutti"&&(a=a.filter(t=>t.team_short_name===q)),R!=="Tutti"&&(a=a.filter(t=>t.position===R)),$!=="Tutti"&&($==="Svincolati"?a=a.filter(t=>!t.owner):a=a.filter(t=>t.owner===$)),B&&(a=a.filter(t=>!t.is_active)),L&&u.length>0){const t=u.map(p=>new Date(p.created_at).getTime()),i=Math.max(...t)-20*60*1e3;return a.filter(p=>new Date(p.created_at).getTime()>i).sort((p,S)=>new Date(S.created_at).getTime()-new Date(p.created_at).getTime())}return a.sort((t,n)=>{const i=(Z[t.position]||99)-(Z[n.position]||99);if(i!==0)return i;const p=(t.team_short_name||"").localeCompare(n.team_short_name||"");if(p!==0)return p;const S=(n.quotation||0)-(t.quotation||0);return S!==0?S:t.name.localeCompare(n.name)})},[u,E,q,R,$,L,B]);return d&&u.length===0?e.jsx("div",{className:"flex justify-center p-10",children:e.jsx(ee,{className:"animate-spin text-pl-teal"})}):e.jsxs("div",{className:"p-4 md:p-8 max-w-full mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center text-center gap-2 mb-8",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-white flex items-center justify-center gap-3",children:[e.jsx(ve,{className:"text-pl-teal w-8 h-8"}),"Gestione Listone"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1 max-w-md mx-auto",children:"Modifica ruoli, quotazioni e proprietari. Le modifiche sono istantanee."}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 justify-center",children:[e.jsxs("button",{onClick:()=>z(!0),className:"flex items-center gap-2 px-4 py-2 bg-pl-teal/10 text-pl-teal rounded-xl text-xs font-bold uppercase tracking-wider hover:bg-pl-teal/20 transition border border-pl-teal/20",children:[e.jsx(M,{size:14}),"Gestione Blocchi Portieri"]}),x("g_admin")&&e.jsxs("button",{onClick:ce,disabled:se,className:"flex items-center gap-2 px-4 py-2 bg-red-500/10 text-red-400 rounded-xl text-xs font-bold uppercase tracking-wider hover:bg-red-500/20 transition border border-red-500/20 disabled:opacity-50",children:[e.jsx(I,{size:14}),"Svuota Rose"]})]}),e.jsx(ke,{searchQuery:E,setSearchQuery:Q,showNewOnly:L,setShowNewOnly:X,showInactiveOnly:B,setShowInactiveOnly:Y,roleFilter:R,setRoleFilter:U,teamFilter:q,setTeamFilter:G,ownerFilter:$,setOwnerFilter:K,teams:r,managers:f,onReset:()=>{Q(""),X(!1),Y(!1),U("Tutti"),G("Tutti"),K("Tutti")}}),e.jsx(Se,{players:de,onEdit:ie,onDelete:ne})]}),e.jsx(ye,{isOpen:y,player:s,managers:f,onClose:J,onSave:oe}),e.jsx(_e,{isOpen:v,realTeams:l,managers:f,onClose:()=>z(!1),onSaveBlock:re,onUpdateTeamLocal:ae,getGKsByTeam:te})]})};export{$e as AdminPlayers};
