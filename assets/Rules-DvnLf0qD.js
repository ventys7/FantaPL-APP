import{c as W,r as l,d as Pt,D as $t,C as Bt,l as ct,j as u,R as Y,a as Le,B as Ln,S as Pn,X as $n,u as mt,b as Bn}from"./index-IQCk0ePk.js";import{P as nn}from"./plus--n6VeLsI.js";import{M as Un}from"./minus-DTGOMW6_.js";import{T as Fn}from"./trash-2-DbOOYVSY.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=W("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=W("AlignJustify",[["line",{x1:"3",x2:"21",y1:"6",y2:"6",key:"4m8b97"}],["line",{x1:"3",x2:"21",y1:"12",y2:"12",key:"10d38w"}],["line",{x1:"3",x2:"21",y1:"18",y2:"18",key:"kwyyxn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _n=W("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=W("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yn=W("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=W("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gn=W("BookText",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}],["path",{d:"M8 7h6",key:"1f0q6e"}],["path",{d:"M8 11h8",key:"vwpz6n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=W("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kn=W("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=W("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=W("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=W("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=W("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=W("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]),tr=[{id:2,title:"2. Ruoli Lega",key:"ruoliLega",content:""},{id:3,title:"3. Modalità Asta, Composizione Rosa, Bonus & Malus",key:"astaRosa",content:""},{id:4,title:"4. Formazione della Squadra",key:"formazione",content:""},{id:5,title:"5. Svolgimento Giornata Campionato",key:"giornata",content:""},{id:6,title:"6. Campionato con Girone e Playoff",key:"campionato",content:""},{id:7,title:"7. Coppa (Coppa Italia e Supercoppa)",key:"coppa",content:""},{id:8,title:"8. Champions/Europa League",key:"champions",content:""},{id:9,title:"9. Mercato e Scambi",key:"mercato",content:""},{id:10,title:"10. Premi",key:"premi",content:""},{id:11,title:"11. Clausole e Punizioni",key:"clausole",content:""},{id:12,title:"12. Conclusione",key:"conclusione",content:""},{id:13,title:"13. Link Utili",key:"link",content:""}],Ft={title:"1. Cenni Principali e Avvertenze",mainText:'Il "PianginaCUP" è a titolo gratuito.',partecipanti:`Partecipanti:
1. Manager 1
2. Manager 2`};function nr(){const[e,t]=l.useState(!0),[n,r]=l.useState(!1),[o,i]=l.useState(Ft),[a,s]=l.useState(tr),[c,d]=l.useState([]),[h,f]=l.useState(null),g=async()=>{try{const v=await Pt.listDocuments($t,Bt);if(v.documents.length>0){const b=v.documents[0];if(f(b.$id),b.cenni_main_text&&i({mainText:b.cenni_main_text,partecipanti:b.cenni_partecipanti||Ft.partecipanti}),b.sections_json)try{const y=JSON.parse(b.sections_json);Array.isArray(y)?s(y):y.sections&&(s(y.sections),y.mainTitle&&i(w=>({...w,title:y.mainTitle})))}catch(y){ct.error("Error parsing sections:",y)}}}catch(v){ct.error("Error loading rules:",v)}finally{t(!1)}},p=async()=>{if(!h)return!1;r(!0);try{const v={mainTitle:o.title,sections:a};return await Pt.updateDocument($t,Bt,h,{cenni_main_text:o.mainText,cenni_partecipanti:o.partecipanti,sections_json:JSON.stringify(v)}),!0}catch(v){return ct.error("Error saving rules:",v),!1}finally{r(!1)}},k=(v,b,y)=>{s(w=>w.map(R=>R.id===v?{...R,[b]:y}:R))},x=()=>{const v=Math.max(...a.map(b=>b.id))+1;s(b=>[...b,{id:v,title:`${v}. Nuova Sezione`,key:`section${v}`,content:""}])},m=v=>{confirm("Sei sicuro di voler eliminare questa sezione?")&&s(b=>b.filter(y=>y.id!==v))},S=(v,b)=>{d(y=>[...y,{field:v,value:b}])},D=()=>{if(c.length===0)return;const v=c[c.length-1];if(d(b=>b.slice(0,-1)),v.field==="mainText")i(b=>({...b,mainText:v.value}));else if(v.field==="partecipanti")i(b=>({...b,partecipanti:v.value}));else if(v.field.startsWith("section-")){const b=parseInt(v.field.replace("section-",""));s(y=>y.map(w=>w.id===b?{...w,content:v.value}:w))}},C=()=>{d([])};return l.useEffect(()=>{g()},[]),{loading:e,saving:n,cenniPrincipali:o,sections:a,undoHistory:c,setCenniPrincipali:i,setSections:s,loadRules:g,saveRules:p,updateSection:k,addSection:x,removeSection:m,addToUndoHistory:S,undo:D,clearUndoHistory:C}}const rr=({onFormat:e,onUndo:t,visible:n,canUndo:r})=>{const[o,i]=l.useState(!1),a=[{name:"Verde",value:"#00ff85"},{name:"Rosso",value:"#ff4444"},{name:"Azzurro",value:"#00d4ff"},{name:"Rosa",value:"#ff2882"},{name:"Viola",value:"#a855f7"},{name:"Giallo",value:"#fbbf24"},{name:"Bianco",value:"#ffffff"},{name:"Grigio",value:"#9ca3af"}];return n?u.jsxs("div",{className:"fixed right-4 top-1/2 -translate-y-1/2 bg-pl-dark/95 backdrop-blur-lg border border-white/20 rounded-xl shadow-2xl p-4 z-40 w-64",children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsx("h3",{className:"text-white font-bold text-sm",children:"Formatta Testo"}),u.jsx("button",{onMouseDown:s=>{s.preventDefault(),t()},disabled:!r,className:`p-2 rounded-lg transition ${r?"bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-400":"bg-white/5 text-gray-500 cursor-not-allowed"}`,title:"Annulla (Undo)",children:u.jsx(er,{size:16})})]}),u.jsxs("div",{className:"mb-3",children:[u.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"Stile"}),u.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[u.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("strong")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Grassetto",children:u.jsx(Wn,{size:18})}),u.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("em")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Corsivo",children:u.jsx(Kn,{size:18})}),u.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("u")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Sottolineato",children:u.jsx(Qn,{size:18})})]})]}),u.jsxs("div",{className:"mb-3",children:[u.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"Dimensione"}),u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs("button",{onMouseDown:s=>{s.preventDefault(),e("font-size-increase")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition flex items-center justify-center gap-1",title:"Aumenta",children:[u.jsx(nn,{size:16}),u.jsx(Ut,{size:16})]}),u.jsxs("button",{onMouseDown:s=>{s.preventDefault(),e("font-size-decrease")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition flex items-center justify-center gap-1",title:"Diminuisci",children:[u.jsx(Un,{size:16}),u.jsx(Ut,{size:16})]})]})]}),u.jsxs("div",{className:"mb-3",children:[u.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"Allineamento"}),u.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[u.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("align-left")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Sinistra",children:u.jsx(_n,{size:16})}),u.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("align-center")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Centro",children:u.jsx(Hn,{size:16})}),u.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("align-right")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Destra",children:u.jsx(Vn,{size:16})}),u.jsx("button",{onMouseDown:s=>{s.preventDefault(),e("align-justify")},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition",title:"Giustificato",children:u.jsx(Xn,{size:16})})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("p",{className:"text-gray-400 text-xs",children:"Colore"}),u.jsx("button",{onMouseDown:s=>{s.preventDefault(),i(!o)},className:"p-1 bg-white/10 hover:bg-white/20 rounded text-white transition",children:u.jsx(Jn,{size:16})})]}),o&&u.jsx("div",{className:"grid grid-cols-4 gap-2",children:a.map(s=>u.jsx("button",{onMouseDown:c=>{c.preventDefault(),e("color",s.value),i(!1)},className:"w-8 h-8 rounded-lg border-2 border-white/20 hover:border-white/50 transition",style:{backgroundColor:s.value},title:s.name},s.value))})]}),u.jsx("div",{className:"mt-3 pt-3 border-t border-white/10",children:u.jsx("p",{className:"text-gray-400 text-xs",children:"Seleziona testo nella textarea per formattare"})})]}):null};function or(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.useMemo(()=>r=>{t.forEach(o=>o(r))},t)}const nt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ee(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function yt(e){return"nodeType"in e}function G(e){var t,n;return e?Ee(e)?e:yt(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function wt(e){const{Document:t}=G(e);return e instanceof t}function _e(e){return Ee(e)?!1:e instanceof G(e).HTMLElement}function rn(e){return e instanceof G(e).SVGElement}function je(e){return e?Ee(e)?e.document:yt(e)?wt(e)?e:_e(e)||rn(e)?e.ownerDocument:document:document:document}const ce=nt?l.useLayoutEffect:l.useEffect;function Ct(e){const t=l.useRef(e);return ce(()=>{t.current=e}),l.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}function ir(){const e=l.useRef(null),t=l.useCallback((r,o)=>{e.current=setInterval(r,o)},[]),n=l.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Ue(e,t){t===void 0&&(t=[e]);const n=l.useRef(e);return ce(()=>{n.current!==e&&(n.current=e)},t),n}function Ve(e,t){const n=l.useRef();return l.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Ze(e){const t=Ct(e),n=l.useRef(null),r=l.useCallback(o=>{o!==n.current&&(t==null||t(o,n.current)),n.current=o},[]);return[n,r]}function gt(e){const t=l.useRef();return l.useEffect(()=>{t.current=e},[e]),t.current}let ut={};function Ye(e,t){return l.useMemo(()=>{if(t)return t;const n=ut[e]==null?0:ut[e]+1;return ut[e]=n,e+"-"+n},[e,t])}function on(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.reduce((i,a)=>{const s=Object.entries(a);for(const[c,d]of s){const h=i[c];h!=null&&(i[c]=h+e*d)}return i},{...t})}}const Ne=on(1),Fe=on(-1);function sr(e){return"clientX"in e&&"clientY"in e}function St(e){if(!e)return!1;const{KeyboardEvent:t}=G(e.target);return t&&e instanceof t}function ar(e){if(!e)return!1;const{TouchEvent:t}=G(e.target);return t&&e instanceof t}function pt(e){if(ar(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return sr(e)?{x:e.clientX,y:e.clientY}:null}const He=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[He.Translate.toString(e),He.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Ht="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function lr(e){return e.matches(Ht)?e:e.querySelector(Ht)}const cr={display:"none"};function ur(e){let{id:t,value:n}=e;return Y.createElement("div",{id:t,style:cr},n)}function dr(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Y.createElement("div",{id:t,style:o,role:"status","aria-live":r,"aria-atomic":!0},n)}function fr(){const[e,t]=l.useState("");return{announce:l.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const sn=l.createContext(null);function hr(e){const t=l.useContext(sn);l.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function gr(){const[e]=l.useState(()=>new Set),t=l.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[l.useCallback(r=>{let{type:o,event:i}=r;e.forEach(a=>{var s;return(s=a[o])==null?void 0:s.call(a,i)})},[e]),t]}const pr={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},vr={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function br(e){let{announcements:t=vr,container:n,hiddenTextDescribedById:r,screenReaderInstructions:o=pr}=e;const{announce:i,announcement:a}=fr(),s=Ye("DndLiveRegion"),[c,d]=l.useState(!1);if(l.useEffect(()=>{d(!0)},[]),hr(l.useMemo(()=>({onDragStart(f){let{active:g}=f;i(t.onDragStart({active:g}))},onDragMove(f){let{active:g,over:p}=f;t.onDragMove&&i(t.onDragMove({active:g,over:p}))},onDragOver(f){let{active:g,over:p}=f;i(t.onDragOver({active:g,over:p}))},onDragEnd(f){let{active:g,over:p}=f;i(t.onDragEnd({active:g,over:p}))},onDragCancel(f){let{active:g,over:p}=f;i(t.onDragCancel({active:g,over:p}))}}),[i,t])),!c)return null;const h=Y.createElement(Y.Fragment,null,Y.createElement(ur,{id:r,value:o.draggable}),Y.createElement(dr,{id:s,announcement:a}));return n?Le.createPortal(h,n):h}var $;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})($||($={}));function Qe(){}function Xt(e,t){return l.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function xr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const ie=Object.freeze({x:0,y:0});function an(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function ln(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function mr(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function _t(e){let{left:t,top:n,height:r,width:o}=e;return[{x:t,y:n},{x:t+o,y:n},{x:t,y:n+r},{x:t+o,y:n+r}]}function cn(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Vt(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const yr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=Vt(t,t.left,t.top),i=[];for(const a of r){const{id:s}=a,c=n.get(s);if(c){const d=an(Vt(c),o);i.push({id:s,data:{droppableContainer:a,value:d}})}}return i.sort(ln)},wr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=_t(t),i=[];for(const a of r){const{id:s}=a,c=n.get(s);if(c){const d=_t(c),h=o.reduce((g,p,k)=>g+an(d[k],p),0),f=Number((h/4).toFixed(4));i.push({id:s,data:{droppableContainer:a,value:f}})}}return i.sort(ln)};function Cr(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height),a=o-r,s=i-n;if(r<o&&n<i){const c=t.width*t.height,d=e.width*e.height,h=a*s,f=h/(c+d-h);return Number(f.toFixed(4))}return 0}const Sr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=[];for(const i of r){const{id:a}=i,s=n.get(a);if(s){const c=Cr(s,t);c>0&&o.push({id:a,data:{droppableContainer:i,value:c}})}}return o.sort(mr)};function Dr(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function un(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:ie}function Rr(e){return function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return o.reduce((a,s)=>({...a,top:a.top+e*s.y,bottom:a.bottom+e*s.y,left:a.left+e*s.x,right:a.right+e*s.x}),{...n})}}const kr=Rr(1);function Nr(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Er(e,t,n){const r=Nr(t);if(!r)return e;const{scaleX:o,scaleY:i,x:a,y:s}=r,c=e.left-a-(1-o)*parseFloat(n),d=e.top-s-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),h=o?e.width/o:e.width,f=i?e.height/i:e.height;return{width:h,height:f,top:d,right:c+h,bottom:d+f,left:c}}const jr={ignoreTransform:!1};function Te(e,t){t===void 0&&(t=jr);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:d,transformOrigin:h}=G(e).getComputedStyle(e);d&&(n=Er(n,d,h))}const{top:r,left:o,width:i,height:a,bottom:s,right:c}=n;return{top:r,left:o,width:i,height:a,bottom:s,right:c}}function Yt(e){return Te(e,{ignoreTransform:!0})}function Tr(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Mr(e,t){return t===void 0&&(t=G(e).getComputedStyle(e)),t.position==="fixed"}function Ar(e,t){t===void 0&&(t=G(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const i=t[o];return typeof i=="string"?n.test(i):!1})}function rt(e,t){const n=[];function r(o){if(t!=null&&n.length>=t||!o)return n;if(wt(o)&&o.scrollingElement!=null&&!n.includes(o.scrollingElement))return n.push(o.scrollingElement),n;if(!_e(o)||rn(o)||n.includes(o))return n;const i=G(e).getComputedStyle(o);return o!==e&&Ar(o,i)&&n.push(o),Mr(o,i)?n:r(o.parentNode)}return e?r(e):n}function dn(e){const[t]=rt(e,1);return t??null}function dt(e){return!nt||!e?null:Ee(e)?e:yt(e)?wt(e)||e===je(e).scrollingElement?window:_e(e)?e:null:null}function fn(e){return Ee(e)?e.scrollX:e.scrollLeft}function hn(e){return Ee(e)?e.scrollY:e.scrollTop}function vt(e){return{x:fn(e),y:hn(e)}}var B;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(B||(B={}));function gn(e){return!nt||!e?!1:e===document.scrollingElement}function pn(e){const t={x:0,y:0},n=gn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},o=e.scrollTop<=t.y,i=e.scrollLeft<=t.x,a=e.scrollTop>=r.y,s=e.scrollLeft>=r.x;return{isTop:o,isLeft:i,isBottom:a,isRight:s,maxScroll:r,minScroll:t}}const Ir={x:.2,y:.2};function Or(e,t,n,r,o){let{top:i,left:a,right:s,bottom:c}=n;r===void 0&&(r=10),o===void 0&&(o=Ir);const{isTop:d,isBottom:h,isLeft:f,isRight:g}=pn(e),p={x:0,y:0},k={x:0,y:0},x={height:t.height*o.y,width:t.width*o.x};return!d&&i<=t.top+x.height?(p.y=B.Backward,k.y=r*Math.abs((t.top+x.height-i)/x.height)):!h&&c>=t.bottom-x.height&&(p.y=B.Forward,k.y=r*Math.abs((t.bottom-x.height-c)/x.height)),!g&&s>=t.right-x.width?(p.x=B.Forward,k.x=r*Math.abs((t.right-x.width-s)/x.width)):!f&&a<=t.left+x.width&&(p.x=B.Backward,k.x=r*Math.abs((t.left+x.width-a)/x.width)),{direction:p,speed:k}}function zr(e){if(e===document.scrollingElement){const{innerWidth:i,innerHeight:a}=window;return{top:0,left:0,right:i,bottom:a,width:i,height:a}}const{top:t,left:n,right:r,bottom:o}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:o,width:e.clientWidth,height:e.clientHeight}}function vn(e){return e.reduce((t,n)=>Ne(t,vt(n)),ie)}function Lr(e){return e.reduce((t,n)=>t+fn(n),0)}function Pr(e){return e.reduce((t,n)=>t+hn(n),0)}function $r(e,t){if(t===void 0&&(t=Te),!e)return;const{top:n,left:r,bottom:o,right:i}=t(e);dn(e)&&(o<=0||i<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Br=[["x",["left","right"],Lr],["y",["top","bottom"],Pr]];class Dt{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=rt(n),o=vn(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[i,a,s]of Br)for(const c of a)Object.defineProperty(this,c,{get:()=>{const d=s(r),h=o[i]-d;return this.rect[c]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Pe{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var o;(o=this.target)==null||o.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function Ur(e){const{EventTarget:t}=G(e);return e instanceof t?e:je(e)}function ft(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var ne;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(ne||(ne={}));function Wt(e){e.preventDefault()}function Fr(e){e.stopPropagation()}var j;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(j||(j={}));const bn={start:[j.Space,j.Enter],cancel:[j.Esc],end:[j.Space,j.Enter,j.Tab]},Hr=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case j.Right:return{...n,x:n.x+25};case j.Left:return{...n,x:n.x-25};case j.Down:return{...n,y:n.y+25};case j.Up:return{...n,y:n.y-25}}};class Rt{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Pe(je(n)),this.windowListeners=new Pe(G(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(ne.Resize,this.handleCancel),this.windowListeners.add(ne.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(ne.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&$r(r),n(ie)}handleKeyDown(t){if(St(t)){const{active:n,context:r,options:o}=this.props,{keyboardCodes:i=bn,coordinateGetter:a=Hr,scrollBehavior:s="smooth"}=o,{code:c}=t;if(i.end.includes(c)){this.handleEnd(t);return}if(i.cancel.includes(c)){this.handleCancel(t);return}const{collisionRect:d}=r.current,h=d?{x:d.left,y:d.top}:ie;this.referenceCoordinates||(this.referenceCoordinates=h);const f=a(t,{active:n,context:r.current,currentCoordinates:h});if(f){const g=Fe(f,h),p={x:0,y:0},{scrollableAncestors:k}=r.current;for(const x of k){const m=t.code,{isTop:S,isRight:D,isLeft:C,isBottom:v,maxScroll:b,minScroll:y}=pn(x),w=zr(x),R={x:Math.min(m===j.Right?w.right-w.width/2:w.right,Math.max(m===j.Right?w.left:w.left+w.width/2,f.x)),y:Math.min(m===j.Down?w.bottom-w.height/2:w.bottom,Math.max(m===j.Down?w.top:w.top+w.height/2,f.y))},I=m===j.Right&&!D||m===j.Left&&!C,O=m===j.Down&&!v||m===j.Up&&!S;if(I&&R.x!==f.x){const M=x.scrollLeft+g.x,F=m===j.Right&&M<=b.x||m===j.Left&&M>=y.x;if(F&&!g.y){x.scrollTo({left:M,behavior:s});return}F?p.x=x.scrollLeft-M:p.x=m===j.Right?x.scrollLeft-b.x:x.scrollLeft-y.x,p.x&&x.scrollBy({left:-p.x,behavior:s});break}else if(O&&R.y!==f.y){const M=x.scrollTop+g.y,F=m===j.Down&&M<=b.y||m===j.Up&&M>=y.y;if(F&&!g.x){x.scrollTo({top:M,behavior:s});return}F?p.y=x.scrollTop-M:p.y=m===j.Down?x.scrollTop-b.y:x.scrollTop-y.y,p.y&&x.scrollBy({top:-p.y,behavior:s});break}}this.handleMove(t,Ne(Fe(f,this.referenceCoordinates),p))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Rt.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=bn,onActivation:o}=t,{active:i}=n;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const s=i.activatorNode.current;return s&&e.target!==s?!1:(e.preventDefault(),o==null||o({event:e.nativeEvent}),!0)}return!1}}];function Gt(e){return!!(e&&"distance"in e)}function qt(e){return!!(e&&"delay"in e)}class kt{constructor(t,n,r){var o;r===void 0&&(r=Ur(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:i}=t,{target:a}=i;this.props=t,this.events=n,this.document=je(a),this.documentListeners=new Pe(this.document),this.listeners=new Pe(r),this.windowListeners=new Pe(G(a)),this.initialCoordinates=(o=pt(i))!=null?o:ie,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(ne.Resize,this.handleCancel),this.windowListeners.add(ne.DragStart,Wt),this.windowListeners.add(ne.VisibilityChange,this.handleCancel),this.windowListeners.add(ne.ContextMenu,Wt),this.documentListeners.add(ne.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(qt(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Gt(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:o}=this.props;o(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(ne.Click,Fr,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(ne.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:o,props:i}=this,{onMove:a,options:{activationConstraint:s}}=i;if(!o)return;const c=(n=pt(t))!=null?n:ie,d=Fe(o,c);if(!r&&s){if(Gt(s)){if(s.tolerance!=null&&ft(d,s.tolerance))return this.handleCancel();if(ft(d,s.distance))return this.handleStart()}if(qt(s)&&ft(d,s.tolerance))return this.handleCancel();this.handlePending(s,d);return}t.cancelable&&t.preventDefault(),a(c)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===j.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Xr={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Nt extends kt{constructor(t){const{event:n}=t,r=je(n.target);super(t,Xr,r)}}Nt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const _r={move:{name:"mousemove"},end:{name:"mouseup"}};var bt;(function(e){e[e.RightClick=2]="RightClick"})(bt||(bt={}));class Vr extends kt{constructor(t){super(t,_r,je(t.event.target))}}Vr.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===bt.RightClick?!1:(r==null||r({event:n}),!0)}}];const ht={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Yr extends kt{constructor(t){super(t,ht)}static setup(){return window.addEventListener(ht.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(ht.move.name,t)};function t(){}}}Yr.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:o}=n;return o.length>1?!1:(r==null||r({event:n}),!0)}}];var $e;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})($e||($e={}));var et;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(et||(et={}));function Wr(e){let{acceleration:t,activator:n=$e.Pointer,canScroll:r,draggingRect:o,enabled:i,interval:a=5,order:s=et.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:h,delta:f,threshold:g}=e;const p=qr({delta:f,disabled:!i}),[k,x]=ir(),m=l.useRef({x:0,y:0}),S=l.useRef({x:0,y:0}),D=l.useMemo(()=>{switch(n){case $e.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case $e.DraggableRect:return o}},[n,o,c]),C=l.useRef(null),v=l.useCallback(()=>{const y=C.current;if(!y)return;const w=m.current.x*S.current.x,R=m.current.y*S.current.y;y.scrollBy(w,R)},[]),b=l.useMemo(()=>s===et.TreeOrder?[...d].reverse():d,[s,d]);l.useEffect(()=>{if(!i||!d.length||!D){x();return}for(const y of b){if((r==null?void 0:r(y))===!1)continue;const w=d.indexOf(y),R=h[w];if(!R)continue;const{direction:I,speed:O}=Or(y,R,D,t,g);for(const M of["x","y"])p[M][I[M]]||(O[M]=0,I[M]=0);if(O.x>0||O.y>0){x(),C.current=y,k(v,a),m.current=O,S.current=I;return}}m.current={x:0,y:0},S.current={x:0,y:0},x()},[t,v,r,x,i,a,JSON.stringify(D),JSON.stringify(p),k,d,b,h,JSON.stringify(g)])}const Gr={x:{[B.Backward]:!1,[B.Forward]:!1},y:{[B.Backward]:!1,[B.Forward]:!1}};function qr(e){let{delta:t,disabled:n}=e;const r=gt(t);return Ve(o=>{if(n||!r||!o)return Gr;const i={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[B.Backward]:o.x[B.Backward]||i.x===-1,[B.Forward]:o.x[B.Forward]||i.x===1},y:{[B.Backward]:o.y[B.Backward]||i.y===-1,[B.Forward]:o.y[B.Forward]||i.y===1}}},[n,t,r])}function Kr(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return Ve(o=>{var i;return t==null?null:(i=r??o)!=null?i:null},[r,t])}function Jr(e,t){return l.useMemo(()=>e.reduce((n,r)=>{const{sensor:o}=r,i=o.activators.map(a=>({eventName:a.eventName,handler:t(a.handler,r)}));return[...n,...i]},[]),[e,t])}var Xe;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Xe||(Xe={}));var xt;(function(e){e.Optimized="optimized"})(xt||(xt={}));const Kt=new Map;function Zr(e,t){let{dragging:n,dependencies:r,config:o}=t;const[i,a]=l.useState(null),{frequency:s,measure:c,strategy:d}=o,h=l.useRef(e),f=m(),g=Ue(f),p=l.useCallback(function(S){S===void 0&&(S=[]),!g.current&&a(D=>D===null?S:D.concat(S.filter(C=>!D.includes(C))))},[g]),k=l.useRef(null),x=Ve(S=>{if(f&&!n)return Kt;if(!S||S===Kt||h.current!==e||i!=null){const D=new Map;for(let C of e){if(!C)continue;if(i&&i.length>0&&!i.includes(C.id)&&C.rect.current){D.set(C.id,C.rect.current);continue}const v=C.node.current,b=v?new Dt(c(v),v):null;C.rect.current=b,b&&D.set(C.id,b)}return D}return S},[e,i,n,f,c]);return l.useEffect(()=>{h.current=e},[e]),l.useEffect(()=>{f||p()},[n,f]),l.useEffect(()=>{i&&i.length>0&&a(null)},[JSON.stringify(i)]),l.useEffect(()=>{f||typeof s!="number"||k.current!==null||(k.current=setTimeout(()=>{p(),k.current=null},s))},[s,f,p,...r]),{droppableRects:x,measureDroppableContainers:p,measuringScheduled:i!=null};function m(){switch(d){case Xe.Always:return!1;case Xe.BeforeDragging:return n;default:return!n}}}function xn(e,t){return Ve(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Qr(e,t){return xn(e,t)}function eo(e){let{callback:t,disabled:n}=e;const r=Ct(t),o=l.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(r)},[r,n]);return l.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function ot(e){let{callback:t,disabled:n}=e;const r=Ct(t),o=l.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(r)},[n]);return l.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function to(e){return new Dt(Te(e),e)}function Jt(e,t,n){t===void 0&&(t=to);const[r,o]=l.useState(null);function i(){o(c=>{if(!e)return null;if(e.isConnected===!1){var d;return(d=c??n)!=null?d:null}const h=t(e);return JSON.stringify(c)===JSON.stringify(h)?c:h})}const a=eo({callback(c){if(e)for(const d of c){const{type:h,target:f}=d;if(h==="childList"&&f instanceof HTMLElement&&f.contains(e)){i();break}}}}),s=ot({callback:i});return ce(()=>{i(),e?(s==null||s.observe(e),a==null||a.observe(document.body,{childList:!0,subtree:!0})):(s==null||s.disconnect(),a==null||a.disconnect())},[e]),r}function no(e){const t=xn(e);return un(e,t)}const Zt=[];function ro(e){const t=l.useRef(e),n=Ve(r=>e?r&&r!==Zt&&e&&t.current&&e.parentNode===t.current.parentNode?r:rt(e):Zt,[e]);return l.useEffect(()=>{t.current=e},[e]),n}function oo(e){const[t,n]=l.useState(null),r=l.useRef(e),o=l.useCallback(i=>{const a=dt(i.target);a&&n(s=>s?(s.set(a,vt(a)),new Map(s)):null)},[]);return l.useEffect(()=>{const i=r.current;if(e!==i){a(i);const s=e.map(c=>{const d=dt(c);return d?(d.addEventListener("scroll",o,{passive:!0}),[d,vt(d)]):null}).filter(c=>c!=null);n(s.length?new Map(s):null),r.current=e}return()=>{a(e),a(i)};function a(s){s.forEach(c=>{const d=dt(c);d==null||d.removeEventListener("scroll",o)})}},[o,e]),l.useMemo(()=>e.length?t?Array.from(t.values()).reduce((i,a)=>Ne(i,a),ie):vn(e):ie,[e,t])}function Qt(e,t){t===void 0&&(t=[]);const n=l.useRef(null);return l.useEffect(()=>{n.current=null},t),l.useEffect(()=>{const r=e!==ie;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?Fe(e,n.current):ie}function io(e){l.useEffect(()=>{if(!nt)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function so(e,t){return l.useMemo(()=>e.reduce((n,r)=>{let{eventName:o,handler:i}=r;return n[o]=a=>{i(a,t)},n},{}),[e,t])}function mn(e){return l.useMemo(()=>e?Tr(e):null,[e])}const en=[];function ao(e,t){t===void 0&&(t=Te);const[n]=e,r=mn(n?G(n):null),[o,i]=l.useState(en);function a(){i(()=>e.length?e.map(c=>gn(c)?r:new Dt(t(c),c)):en)}const s=ot({callback:a});return ce(()=>{s==null||s.disconnect(),a(),e.forEach(c=>s==null?void 0:s.observe(c))},[e]),o}function lo(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return _e(t)?t:e}function co(e){let{measure:t}=e;const[n,r]=l.useState(null),o=l.useCallback(d=>{for(const{target:h}of d)if(_e(h)){r(f=>{const g=t(h);return f?{...f,width:g.width,height:g.height}:g});break}},[t]),i=ot({callback:o}),a=l.useCallback(d=>{const h=lo(d);i==null||i.disconnect(),h&&(i==null||i.observe(h)),r(h?t(h):null)},[t,i]),[s,c]=Ze(a);return l.useMemo(()=>({nodeRef:s,rect:n,setRef:c}),[n,s,c])}const uo=[{sensor:Nt,options:{}},{sensor:Rt,options:{}}],fo={current:{}},Je={draggable:{measure:Yt},droppable:{measure:Yt,strategy:Xe.WhileDragging,frequency:xt.Optimized},dragOverlay:{measure:Te}};class Be extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const ho={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Be,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Qe},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Je,measureDroppableContainers:Qe,windowRect:null,measuringScheduled:!1},go={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Qe,draggableNodes:new Map,over:null,measureDroppableContainers:Qe},it=l.createContext(go),yn=l.createContext(ho);function po(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Be}}}function vo(e,t){switch(t.type){case $.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case $.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case $.DragEnd:case $.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case $.RegisterDroppable:{const{element:n}=t,{id:r}=n,o=new Be(e.droppable.containers);return o.set(r,n),{...e,droppable:{...e.droppable,containers:o}}}case $.SetDroppableDisabled:{const{id:n,key:r,disabled:o}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const a=new Be(e.droppable.containers);return a.set(n,{...i,disabled:o}),{...e,droppable:{...e.droppable,containers:a}}}case $.UnregisterDroppable:{const{id:n,key:r}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const i=new Be(e.droppable.containers);return i.delete(n),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function bo(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:o}=l.useContext(it),i=gt(r),a=gt(n==null?void 0:n.id);return l.useEffect(()=>{if(!t&&!r&&i&&a!=null){if(!St(i)||document.activeElement===i.target)return;const s=o.get(a);if(!s)return;const{activatorNode:c,node:d}=s;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(const h of[c.current,d.current]){if(!h)continue;const f=lr(h);if(f){f.focus();break}}})}},[r,t,o,a,i]),null}function xo(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((o,i)=>i({transform:o,...r}),n):n}function mo(e){return l.useMemo(()=>({draggable:{...Je.draggable,...e==null?void 0:e.draggable},droppable:{...Je.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Je.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function yo(e){let{activeNode:t,measure:n,initialRect:r,config:o=!0}=e;const i=l.useRef(!1),{x:a,y:s}=typeof o=="boolean"?{x:o,y:o}:o;ce(()=>{if(!a&&!s||!t){i.current=!1;return}if(i.current||!r)return;const d=t==null?void 0:t.node.current;if(!d||d.isConnected===!1)return;const h=n(d),f=un(h,r);if(a||(f.x=0),s||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const g=dn(d);g&&g.scrollBy({top:f.y,left:f.x})}},[t,a,s,r,n])}const wn=l.createContext({...ie,scaleX:1,scaleY:1});var be;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(be||(be={}));const wo=l.memo(function(t){var n,r,o,i;let{id:a,accessibility:s,autoScroll:c=!0,children:d,sensors:h=uo,collisionDetection:f=Sr,measuring:g,modifiers:p,...k}=t;const x=l.useReducer(vo,void 0,po),[m,S]=x,[D,C]=gr(),[v,b]=l.useState(be.Uninitialized),y=v===be.Initialized,{draggable:{active:w,nodes:R,translate:I},droppable:{containers:O}}=m,M=w!=null?R.get(w):null,F=l.useRef({initial:null,translated:null}),q=l.useMemo(()=>{var X;return w!=null?{id:w,data:(X=M==null?void 0:M.data)!=null?X:fo,rect:F}:null},[w,M]),ee=l.useRef(null),[xe,me]=l.useState(null),[_,ye]=l.useState(null),re=Ue(k,Object.values(k)),N=Ye("DndDescribedBy",a),A=l.useMemo(()=>O.getEnabled(),[O]),E=mo(g),{droppableRects:H,measureDroppableContainers:z,measuringScheduled:L}=Zr(A,{dragging:y,dependencies:[I.x,I.y],config:E.droppable}),P=Kr(R,w),K=l.useMemo(()=>_?pt(_):null,[_]),V=zn(),oe=Qr(P,E.draggable.measure);yo({activeNode:w!=null?R.get(w):null,config:V.layoutShiftCompensation,initialRect:oe,measure:E.draggable.measure});const T=Jt(P,E.draggable.measure,oe),Me=Jt(P?P.parentElement:null),se=l.useRef({activatorEvent:null,active:null,activeNode:P,collisionRect:null,collisions:null,droppableRects:H,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:O,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),we=O.getNodeFor((n=se.current.over)==null?void 0:n.id),ue=co({measure:E.dragOverlay.measure}),Ce=(r=ue.nodeRef.current)!=null?r:P,Se=y?(o=ue.rect)!=null?o:T:null,jt=!!(ue.nodeRef.current&&ue.rect),Tt=no(jt?null:T),st=mn(Ce?G(Ce):null),fe=ro(y?we??P:null),We=ao(fe),Ge=xo(p,{transform:{x:I.x-Tt.x,y:I.y-Tt.y,scaleX:1,scaleY:1},activatorEvent:_,active:q,activeNodeRect:T,containerNodeRect:Me,draggingNodeRect:Se,over:se.current.over,overlayNodeRect:ue.rect,scrollableAncestors:fe,scrollableAncestorRects:We,windowRect:st}),Mt=K?Ne(K,I):null,At=oo(fe),En=Qt(At),jn=Qt(At,[T]),De=Ne(Ge,En),Re=Se?kr(Se,Ge):null,Ae=q&&Re?f({active:q,collisionRect:Re,droppableRects:H,droppableContainers:A,pointerCoordinates:Mt}):null,It=cn(Ae,"id"),[he,Ot]=l.useState(null),Tn=jt?Ge:Ne(Ge,jn),Mn=Dr(Tn,(i=he==null?void 0:he.rect)!=null?i:null,T),at=l.useRef(null),zt=l.useCallback((X,J)=>{let{sensor:Z,options:ge}=J;if(ee.current==null)return;const te=R.get(ee.current);if(!te)return;const Q=X.nativeEvent,ae=new Z({active:ee.current,activeNode:te,event:Q,options:ge,context:se,onAbort(U){if(!R.get(U))return;const{onDragAbort:le}=re.current,de={id:U};le==null||le(de),D({type:"onDragAbort",event:de})},onPending(U,pe,le,de){if(!R.get(U))return;const{onDragPending:Oe}=re.current,ve={id:U,constraint:pe,initialCoordinates:le,offset:de};Oe==null||Oe(ve),D({type:"onDragPending",event:ve})},onStart(U){const pe=ee.current;if(pe==null)return;const le=R.get(pe);if(!le)return;const{onDragStart:de}=re.current,Ie={activatorEvent:Q,active:{id:pe,data:le.data,rect:F}};Le.unstable_batchedUpdates(()=>{de==null||de(Ie),b(be.Initializing),S({type:$.DragStart,initialCoordinates:U,active:pe}),D({type:"onDragStart",event:Ie}),me(at.current),ye(Q)})},onMove(U){S({type:$.DragMove,coordinates:U})},onEnd:ke($.DragEnd),onCancel:ke($.DragCancel)});at.current=ae;function ke(U){return async function(){const{active:le,collisions:de,over:Ie,scrollAdjustedTranslate:Oe}=se.current;let ve=null;if(le&&Oe){const{cancelDrop:ze}=re.current;ve={activatorEvent:Q,active:le,collisions:de,delta:Oe,over:Ie},U===$.DragEnd&&typeof ze=="function"&&await Promise.resolve(ze(ve))&&(U=$.DragCancel)}ee.current=null,Le.unstable_batchedUpdates(()=>{S({type:U}),b(be.Uninitialized),Ot(null),me(null),ye(null),at.current=null;const ze=U===$.DragEnd?"onDragEnd":"onDragCancel";if(ve){const lt=re.current[ze];lt==null||lt(ve),D({type:ze,event:ve})}})}}},[R]),An=l.useCallback((X,J)=>(Z,ge)=>{const te=Z.nativeEvent,Q=R.get(ge);if(ee.current!==null||!Q||te.dndKit||te.defaultPrevented)return;const ae={active:Q};X(Z,J.options,ae)===!0&&(te.dndKit={capturedBy:J.sensor},ee.current=ge,zt(Z,J))},[R,zt]),Lt=Jr(h,An);io(h),ce(()=>{T&&v===be.Initializing&&b(be.Initialized)},[T,v]),l.useEffect(()=>{const{onDragMove:X}=re.current,{active:J,activatorEvent:Z,collisions:ge,over:te}=se.current;if(!J||!Z)return;const Q={active:J,activatorEvent:Z,collisions:ge,delta:{x:De.x,y:De.y},over:te};Le.unstable_batchedUpdates(()=>{X==null||X(Q),D({type:"onDragMove",event:Q})})},[De.x,De.y]),l.useEffect(()=>{const{active:X,activatorEvent:J,collisions:Z,droppableContainers:ge,scrollAdjustedTranslate:te}=se.current;if(!X||ee.current==null||!J||!te)return;const{onDragOver:Q}=re.current,ae=ge.get(It),ke=ae&&ae.rect.current?{id:ae.id,rect:ae.rect.current,data:ae.data,disabled:ae.disabled}:null,U={active:X,activatorEvent:J,collisions:Z,delta:{x:te.x,y:te.y},over:ke};Le.unstable_batchedUpdates(()=>{Ot(ke),Q==null||Q(U),D({type:"onDragOver",event:U})})},[It]),ce(()=>{se.current={activatorEvent:_,active:q,activeNode:P,collisionRect:Re,collisions:Ae,droppableRects:H,draggableNodes:R,draggingNode:Ce,draggingNodeRect:Se,droppableContainers:O,over:he,scrollableAncestors:fe,scrollAdjustedTranslate:De},F.current={initial:Se,translated:Re}},[q,P,Ae,Re,R,Ce,Se,H,O,he,fe,De]),Wr({...V,delta:I,draggingRect:Re,pointerCoordinates:Mt,scrollableAncestors:fe,scrollableAncestorRects:We});const In=l.useMemo(()=>({active:q,activeNode:P,activeNodeRect:T,activatorEvent:_,collisions:Ae,containerNodeRect:Me,dragOverlay:ue,draggableNodes:R,droppableContainers:O,droppableRects:H,over:he,measureDroppableContainers:z,scrollableAncestors:fe,scrollableAncestorRects:We,measuringConfiguration:E,measuringScheduled:L,windowRect:st}),[q,P,T,_,Ae,Me,ue,R,O,H,he,z,fe,We,E,L,st]),On=l.useMemo(()=>({activatorEvent:_,activators:Lt,active:q,activeNodeRect:T,ariaDescribedById:{draggable:N},dispatch:S,draggableNodes:R,over:he,measureDroppableContainers:z}),[_,Lt,q,T,S,N,R,he,z]);return Y.createElement(sn.Provider,{value:C},Y.createElement(it.Provider,{value:On},Y.createElement(yn.Provider,{value:In},Y.createElement(wn.Provider,{value:Mn},d)),Y.createElement(bo,{disabled:(s==null?void 0:s.restoreFocus)===!1})),Y.createElement(br,{...s,hiddenTextDescribedById:N}));function zn(){const X=(xe==null?void 0:xe.autoScrollEnabled)===!1,J=typeof c=="object"?c.enabled===!1:c===!1,Z=y&&!X&&!J;return typeof c=="object"?{...c,enabled:Z}:{enabled:Z}}}),Co=l.createContext(null),tn="button",So="Draggable";function Do(e){let{id:t,data:n,disabled:r=!1,attributes:o}=e;const i=Ye(So),{activators:a,activatorEvent:s,active:c,activeNodeRect:d,ariaDescribedById:h,draggableNodes:f,over:g}=l.useContext(it),{role:p=tn,roleDescription:k="draggable",tabIndex:x=0}=o??{},m=(c==null?void 0:c.id)===t,S=l.useContext(m?wn:Co),[D,C]=Ze(),[v,b]=Ze(),y=so(a,t),w=Ue(n);ce(()=>(f.set(t,{id:t,key:i,node:D,activatorNode:v,data:w}),()=>{const I=f.get(t);I&&I.key===i&&f.delete(t)}),[f,t]);const R=l.useMemo(()=>({role:p,tabIndex:x,"aria-disabled":r,"aria-pressed":m&&p===tn?!0:void 0,"aria-roledescription":k,"aria-describedby":h.draggable}),[r,p,x,m,k,h.draggable]);return{active:c,activatorEvent:s,activeNodeRect:d,attributes:R,isDragging:m,listeners:r?void 0:y,node:D,over:g,setNodeRef:C,setActivatorNodeRef:b,transform:S}}function Ro(){return l.useContext(yn)}const ko="Droppable",No={timeout:25};function Eo(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:o}=e;const i=Ye(ko),{active:a,dispatch:s,over:c,measureDroppableContainers:d}=l.useContext(it),h=l.useRef({disabled:n}),f=l.useRef(!1),g=l.useRef(null),p=l.useRef(null),{disabled:k,updateMeasurementsFor:x,timeout:m}={...No,...o},S=Ue(x??r),D=l.useCallback(()=>{if(!f.current){f.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{d(Array.isArray(S.current)?S.current:[S.current]),p.current=null},m)},[m]),C=ot({callback:D,disabled:k||!a}),v=l.useCallback((R,I)=>{C&&(I&&(C.unobserve(I),f.current=!1),R&&C.observe(R))},[C]),[b,y]=Ze(v),w=Ue(t);return l.useEffect(()=>{!C||!b.current||(C.disconnect(),f.current=!1,C.observe(b.current))},[b,C]),l.useEffect(()=>(s({type:$.RegisterDroppable,element:{id:r,key:i,disabled:n,node:b,rect:g,data:w}}),()=>s({type:$.UnregisterDroppable,key:i,id:r})),[r]),l.useEffect(()=>{n!==h.current.disabled&&(s({type:$.SetDroppableDisabled,id:r,key:i,disabled:n}),h.current.disabled=n)},[r,i,n,s]),{active:a,rect:g,isOver:(c==null?void 0:c.id)===r,node:b,over:c,setNodeRef:y}}function Et(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function jo(e,t){return e.reduce((n,r,o)=>{const i=t.get(r);return i&&(n[o]=i),n},Array(e.length))}function qe(e){return e!==null&&e>=0}function To(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Mo(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Cn=e=>{let{rects:t,activeIndex:n,overIndex:r,index:o}=e;const i=Et(t,r,n),a=t[o],s=i[o];return!s||!a?null:{x:s.left-a.left,y:s.top-a.top,scaleX:s.width/a.width,scaleY:s.height/a.height}},Ke={scaleX:1,scaleY:1},Ao=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:o,rects:i,overIndex:a}=e;const s=(t=i[n])!=null?t:r;if(!s)return null;if(o===n){const d=i[a];return d?{x:0,y:n<a?d.top+d.height-(s.top+s.height):d.top-s.top,...Ke}:null}const c=Io(i,o,n);return o>n&&o<=a?{x:0,y:-s.height-c,...Ke}:o<n&&o>=a?{x:0,y:s.height+c,...Ke}:{x:0,y:0,...Ke}};function Io(e,t,n){const r=e[t],o=e[t-1],i=e[t+1];return r?n<t?o?r.top-(o.top+o.height):i?i.top-(r.top+r.height):0:i?i.top-(r.top+r.height):o?r.top-(o.top+o.height):0:0}const Sn="Sortable",Dn=Y.createContext({activeIndex:-1,containerId:Sn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Cn,disabled:{draggable:!1,droppable:!1}});function Oo(e){let{children:t,id:n,items:r,strategy:o=Cn,disabled:i=!1}=e;const{active:a,dragOverlay:s,droppableRects:c,over:d,measureDroppableContainers:h}=Ro(),f=Ye(Sn,n),g=s.rect!==null,p=l.useMemo(()=>r.map(y=>typeof y=="object"&&"id"in y?y.id:y),[r]),k=a!=null,x=a?p.indexOf(a.id):-1,m=d?p.indexOf(d.id):-1,S=l.useRef(p),D=!To(p,S.current),C=m!==-1&&x===-1||D,v=Mo(i);ce(()=>{D&&k&&h(p)},[D,p,k,h]),l.useEffect(()=>{S.current=p},[p]);const b=l.useMemo(()=>({activeIndex:x,containerId:f,disabled:v,disableTransforms:C,items:p,overIndex:m,useDragOverlay:g,sortedRects:jo(p,c),strategy:o}),[x,f,v.draggable,v.droppable,C,p,m,c,g,o]);return Y.createElement(Dn.Provider,{value:b},t)}const zo=e=>{let{id:t,items:n,activeIndex:r,overIndex:o}=e;return Et(n,r,o).indexOf(t)},Lo=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:o,items:i,newIndex:a,previousItems:s,previousContainerId:c,transition:d}=e;return!d||!r||s!==i&&o===a?!1:n?!0:a!==o&&t===c},Po={duration:200,easing:"ease"},Rn="transform",$o=He.Transition.toString({property:Rn,duration:0,easing:"linear"}),Bo={roleDescription:"sortable"};function Uo(e){let{disabled:t,index:n,node:r,rect:o}=e;const[i,a]=l.useState(null),s=l.useRef(n);return ce(()=>{if(!t&&n!==s.current&&r.current){const c=o.current;if(c){const d=Te(r.current,{ignoreTransform:!0}),h={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(h.x||h.y)&&a(h)}}n!==s.current&&(s.current=n)},[t,n,r,o]),l.useEffect(()=>{i&&a(null)},[i]),i}function Fo(e){let{animateLayoutChanges:t=Lo,attributes:n,disabled:r,data:o,getNewIndex:i=zo,id:a,strategy:s,resizeObserverConfig:c,transition:d=Po}=e;const{items:h,containerId:f,activeIndex:g,disabled:p,disableTransforms:k,sortedRects:x,overIndex:m,useDragOverlay:S,strategy:D}=l.useContext(Dn),C=Ho(r,p),v=h.indexOf(a),b=l.useMemo(()=>({sortable:{containerId:f,index:v,items:h},...o}),[f,o,v,h]),y=l.useMemo(()=>h.slice(h.indexOf(a)),[h,a]),{rect:w,node:R,isOver:I,setNodeRef:O}=Eo({id:a,data:b,disabled:C.droppable,resizeObserverConfig:{updateMeasurementsFor:y,...c}}),{active:M,activatorEvent:F,activeNodeRect:q,attributes:ee,setNodeRef:xe,listeners:me,isDragging:_,over:ye,setActivatorNodeRef:re,transform:N}=Do({id:a,data:b,attributes:{...Bo,...n},disabled:C.draggable}),A=or(O,xe),E=!!M,H=E&&!k&&qe(g)&&qe(m),z=!S&&_,L=z&&H?N:null,K=H?L??(s??D)({rects:x,activeNodeRect:q,activeIndex:g,overIndex:m,index:v}):null,V=qe(g)&&qe(m)?i({id:a,items:h,activeIndex:g,overIndex:m}):v,oe=M==null?void 0:M.id,T=l.useRef({activeId:oe,items:h,newIndex:V,containerId:f}),Me=h!==T.current.items,se=t({active:M,containerId:f,isDragging:_,isSorting:E,id:a,index:v,items:h,newIndex:T.current.newIndex,previousItems:T.current.items,previousContainerId:T.current.containerId,transition:d,wasDragging:T.current.activeId!=null}),we=Uo({disabled:!se,index:v,node:R,rect:w});return l.useEffect(()=>{E&&T.current.newIndex!==V&&(T.current.newIndex=V),f!==T.current.containerId&&(T.current.containerId=f),h!==T.current.items&&(T.current.items=h)},[E,V,f,h]),l.useEffect(()=>{if(oe===T.current.activeId)return;if(oe!=null&&T.current.activeId==null){T.current.activeId=oe;return}const Ce=setTimeout(()=>{T.current.activeId=oe},50);return()=>clearTimeout(Ce)},[oe]),{active:M,activeIndex:g,attributes:ee,data:b,rect:w,index:v,newIndex:V,items:h,isOver:I,isSorting:E,isDragging:_,listeners:me,node:R,overIndex:m,over:ye,setNodeRef:A,setActivatorNodeRef:re,setDroppableNodeRef:O,setDraggableNodeRef:xe,transform:we??K,transition:ue()};function ue(){if(we||Me&&T.current.newIndex===v)return $o;if(!(z&&!St(F)||!d)&&(E||se))return He.Transition.toString({...d,property:Rn})}}function Ho(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}function tt(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const Xo=[j.Down,j.Right,j.Up,j.Left],_o=(e,t)=>{let{context:{active:n,collisionRect:r,droppableRects:o,droppableContainers:i,over:a,scrollableAncestors:s}}=t;if(Xo.includes(e.code)){if(e.preventDefault(),!n||!r)return;const c=[];i.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const g=o.get(f.id);if(g)switch(e.code){case j.Down:r.top<g.top&&c.push(f);break;case j.Up:r.top>g.top&&c.push(f);break;case j.Left:r.left>g.left&&c.push(f);break;case j.Right:r.left<g.left&&c.push(f);break}});const d=wr({collisionRect:r,droppableRects:o,droppableContainers:c});let h=cn(d,"id");if(h===(a==null?void 0:a.id)&&d.length>1&&(h=d[1].id),h!=null){const f=i.get(n.id),g=i.get(h),p=g?o.get(g.id):null,k=g==null?void 0:g.node.current;if(k&&p&&f&&g){const m=rt(k).some((y,w)=>s[w]!==y),S=kn(f,g),D=Vo(f,g),C=m||!S?{x:0,y:0}:{x:D?r.width-p.width:0,y:D?r.height-p.height:0},v={x:p.left,y:p.top};return C.x&&C.y?v:Fe(v,C)}}}};function kn(e,t){return!tt(e)||!tt(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function Vo(e,t){return!tt(e)||!tt(t)||!kn(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}function Yo({editMode:e,setEditMode:t,canEdit:n,subtitle:r,onSubtitleChange:o,saving:i,onSave:a,onCancel:s}){return u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"relative mb-10 md:mb-14",children:u.jsxs("div",{className:"relative flex flex-col md:flex-row items-center justify-between gap-6",children:[u.jsxs("div",{className:"flex items-center gap-5",children:[u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pl-pink to-pl-purple rounded-2xl blur-lg opacity-50"}),u.jsx("div",{className:"relative bg-gradient-to-br from-pl-pink to-pl-purple p-4 rounded-2xl",children:u.jsx(Ln,{className:"w-10 h-10 text-white"})})]}),u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl md:text-5xl font-black bg-gradient-to-r from-white via-gray-100 to-gray-300 bg-clip-text text-transparent pb-1",children:"Regolamento"}),e&&n?u.jsx("input",{type:"text",value:r,onChange:c=>o(c.target.value),className:"text-gray-400 text-sm md:text-base mt-1 font-medium tracking-wide bg-transparent border-b border-pl-pink/30 focus:outline-none focus:border-pl-pink w-full"}):u.jsx("p",{className:"text-gray-400 text-sm md:text-base mt-1 font-medium tracking-wide",children:r})]})]}),n&&u.jsx("div",{className:"flex gap-3",children:e?u.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-pl-pink/10 border border-pl-pink/30 rounded-xl",children:[u.jsx("div",{className:"w-2 h-2 bg-pl-pink rounded-full animate-pulse"}),u.jsx("span",{className:"text-pl-pink text-sm font-medium",children:"Modifica Attiva"})]}):u.jsxs("button",{onClick:()=>t(!0),className:"group flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-pl-pink/20 to-pl-purple/20 hover:from-pl-pink/30 hover:to-pl-purple/30 rounded-xl text-white border border-pl-pink/30 hover:border-pl-pink/50 transition-all duration-300",children:[u.jsx(Zn,{size:18,className:"group-hover:rotate-12 transition-transform"}),u.jsx("span",{className:"font-semibold",children:"Modifica"})]})})]})}),e&&n&&u.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 bg-[#18181b]/95 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl shadow-black/50 px-6 py-4 z-[9999] flex gap-4",children:[u.jsxs("button",{onClick:a,disabled:i,className:"flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-green-500/20 to-emerald-500/20 hover:from-green-500/30 hover:to-emerald-500/30 rounded-xl text-white border border-green-500/30 transition-all disabled:opacity-50 font-semibold",children:[u.jsx(Pn,{size:18}),i?"Salvataggio...":"Salva"]}),u.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-6 py-2.5 bg-red-500/10 hover:bg-red-500/20 rounded-xl text-red-400 border border-red-500/20 hover:border-red-500/30 transition-all font-semibold",children:[u.jsx($n,{size:18}),"Annulla"]})]})]})}function Wo({cenniTitle:e,sections:t,activeSection:n,scrollToSection:r}){return u.jsx("div",{className:"w-full lg:w-72 lg:sticky lg:top-8 order-1 space-y-5",children:u.jsxs("div",{className:"group bg-gradient-to-br from-white/[0.08] to-white/[0.02] backdrop-blur-xl rounded-2xl p-5 border border-white/10 hover:border-white/20 transition-all duration-300",children:[u.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2.5",children:[u.jsx("div",{className:"p-2 bg-pl-teal/20 rounded-lg",children:u.jsx(Gn,{size:18,className:"text-pl-teal"})}),"Indice"]}),u.jsxs("nav",{className:"flex flex-col gap-1.5",children:[u.jsx("button",{onClick:()=>r(-1),className:`text-left text-sm font-medium px-3.5 py-2.5 rounded-xl transition-all duration-200 ${n===-1?"bg-pl-teal/20 text-pl-teal border border-pl-teal/30":"text-gray-400 hover:text-white hover:bg-white/5"}`,children:e}),t.map(o=>u.jsx("button",{onClick:()=>r(o.id),className:`text-left text-sm font-medium px-3.5 py-2.5 rounded-xl transition-all duration-200 ${n===o.id?"bg-pl-teal/20 text-pl-teal border border-pl-teal/30":"text-gray-400 hover:text-white hover:bg-white/5"}`,children:o.title},o.id))]})]})})}const Go=(e,t)=>t?e.replace(/<blur>(.*?)<\/blur>/gi,(n,r)=>"█".repeat(r.length)):e;function qo({children:e}){const{user:t}=mt(),r=Go(e,!t);return u.jsx("span",{dangerouslySetInnerHTML:{__html:r.replace(/\n/g,"<br/>")}})}function Nn({value:e,onChange:t,editMode:n,multiline:r=!1,className:o="",textareaRef:i,dataField:a}){const{hasRole:s}=mt();return n&&s("admin")?r?u.jsx("textarea",{ref:i,"data-field":a,value:e,onChange:c=>t(c.target.value),className:`w-full bg-[#0a0a0f]/80 border border-white/10 focus:border-pl-pink/50 rounded-xl p-5 text-gray-200 focus:outline-none focus:ring-2 focus:ring-pl-pink/20 resize-y min-h-[250px] font-mono text-sm leading-relaxed placeholder:text-gray-600 transition-all ${o}`,placeholder:"Inserisci il contenuto qui..."}):u.jsx("input",{type:"text",value:e,onChange:c=>t(c.target.value),className:`w-full bg-[#0a0a0f]/80 border border-white/10 focus:border-pl-pink/50 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-pl-pink/20 transition-all ${o}`}):u.jsx("div",{className:`leading-relaxed ${o}`,children:u.jsx(qo,{children:e})})}function Ko({title:e,mainText:t,editMode:n,canEdit:r,setTitle:o,setMainText:i,setRef:a}){return u.jsxs("div",{ref:a,className:"relative bg-gradient-to-br from-white/[0.08] to-white/[0.02] backdrop-blur-xl rounded-3xl p-8 md:p-10 border border-white/10 overflow-hidden",children:[u.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-pl-pink via-pl-purple to-pl-teal"}),u.jsx("div",{className:"text-center mb-8",children:n&&r?u.jsx("input",{type:"text",value:e,onChange:s=>o(s.target.value),className:"text-2xl md:text-3xl font-bold text-pl-teal bg-transparent border-b-2 border-pl-pink/30 focus:outline-none focus:border-pl-pink text-center w-full pb-2"}):u.jsx("h2",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-pl-teal to-emerald-400 bg-clip-text text-transparent",children:e})}),u.jsx("div",{className:"text-gray-300 leading-relaxed space-y-4 text-[15px]",children:u.jsx(Nn,{value:t,onChange:i,editMode:n,multiline:!0,dataField:"mainText"})})]})}function Jo({id:e,children:t,editMode:n}){const{attributes:r,listeners:o,setNodeRef:i,transform:a,transition:s,isDragging:c}=Fo({id:e}),d={transform:He.Transform.toString(a),transition:s,zIndex:c?50:"auto",opacity:c?.3:1};return u.jsxs("div",{ref:i,style:d,className:"relative",children:[n&&u.jsx("div",{...r,...o,className:"absolute left-[-40px] top-6 p-2 cursor-grab active:cursor-grabbing text-gray-500 hover:text-white transition-colors touch-none",title:"Trascina per riordinare",children:u.jsx(qn,{size:24})}),t]})}function Zo({sections:e,editMode:t,canEdit:n,activeSection:r,toggleSection:o,updateSection:i,addSection:a,removeSection:s,onDragEnd:c,setSectionRef:d,scrollToIndex:h}){const f=xr(Xt(Nt),Xt(Rt,{coordinateGetter:_o}));return u.jsx(wo,{sensors:f,collisionDetection:yr,onDragEnd:c,children:u.jsx(Oo,{items:e.map(g=>g.id),strategy:Ao,disabled:!t||!n,children:u.jsxs("div",{className:"space-y-4",children:[t&&n&&u.jsxs("button",{onClick:a,className:"w-full flex items-center justify-center gap-2 py-4 bg-gradient-to-r from-pl-teal/10 to-emerald-500/10 hover:from-pl-teal/20 hover:to-emerald-500/20 rounded-2xl text-pl-teal border border-pl-teal/20 hover:border-pl-teal/40 transition-all font-semibold",children:[u.jsx(nn,{size:20}),"Aggiungi Sezione"]}),e.map(g=>u.jsx(Jo,{id:g.id,editMode:t&&n,children:u.jsxs("div",{ref:p=>d(g.id,p),className:`bg-gradient-to-br from-white/[0.06] to-white/[0.02] backdrop-blur-xl rounded-2xl border transition-all duration-300 overflow-hidden ${r===g.id?"border-white/20 shadow-lg shadow-black/20":"border-white/10 hover:border-white/15"}`,children:[u.jsxs("div",{className:"flex items-center justify-between p-5 md:p-6 cursor-pointer hover:bg-white/[0.02] transition-all group",onClick:()=>o(g.id),children:[t&&n?u.jsx("input",{type:"text",value:g.title,onChange:p=>i(g.id,"title",p.target.value),onClick:p=>p.stopPropagation(),className:"flex-1 text-lg md:text-xl font-bold text-white bg-transparent border-b-2 border-pl-pink/30 focus:outline-none focus:border-pl-pink text-center pb-1"}):u.jsx("h3",{className:"flex-1 text-lg md:text-xl font-bold text-white text-center group-hover:text-gray-100 transition-colors",children:g.title}),u.jsx("div",{className:`p-2 rounded-full bg-white/5 group-hover:bg-white/10 transition-all ml-4 ${r===g.id?"bg-pl-teal/20":""}`,children:u.jsx(Bn,{size:20,className:`text-gray-400 transition-all duration-300 ${r===g.id?"rotate-180 text-pl-teal":"group-hover:text-white"}`})}),t&&n&&u.jsx("button",{onClick:p=>{p.stopPropagation(),s(g.id)},className:"ml-3 p-2.5 bg-red-500/10 hover:bg-red-500/20 rounded-xl text-red-400 border border-red-500/20 hover:border-red-500/30 transition-all",children:u.jsx(Fn,{size:16})})]}),r===g.id&&u.jsxs("div",{className:"px-5 md:px-6 pb-6 pt-2 border-t border-white/5 animate-in slide-in-from-top-2 duration-200",children:[u.jsx("div",{className:"text-gray-300 leading-relaxed space-y-3 text-[15px]",children:u.jsx(Nn,{value:g.content,onChange:p=>i(g.id,"content",p),editMode:t,multiline:!0,dataField:`section-${g.id}`})}),u.jsxs("button",{onClick:h,className:"mt-6 flex items-center gap-2 px-5 py-2.5 bg-pl-teal/10 hover:bg-pl-teal/20 rounded-xl text-pl-teal border border-pl-teal/20 transition-all mx-auto lg:hidden font-medium",children:[u.jsx(Yn,{size:16}),"Torna all'Indice"]})]})]})},g.id))]})})})}function ri(){const{hasRole:e}=mt(),{loading:t,saving:n,cenniPrincipali:r,sections:o,undoHistory:i,setCenniPrincipali:a,setSections:s,loadRules:c,saveRules:d,updateSection:h,addSection:f,removeSection:g,addToUndoHistory:p,undo:k,clearUndoHistory:x}=nr(),[m,S]=l.useState(!1),[D,C]=l.useState(null),[,v]=l.useState(!1),[b,y]=l.useState(!1),[w,R]=l.useState(null),[I,O]=l.useState(null),M=l.useRef(null);l.useRef(null);const F=l.useRef({}),q=N=>{const{active:A,over:E}=N;A.id!==(E==null?void 0:E.id)&&E&&s(H=>{const z=H.findIndex(P=>P.id===A.id),L=H.findIndex(P=>P.id===E.id);return Et(H,z,L)})};l.useEffect(()=>{if(!m||!e("admin")){y(!1);return}const N=A=>{const E=A.target;E.tagName==="TEXTAREA"&&E.selectionStart!==E.selectionEnd?(R(E),O({start:E.selectionStart,end:E.selectionEnd}),y(!0)):setTimeout(()=>{E.tagName==="TEXTAREA"&&E.selectionStart===E.selectionEnd&&(y(!1),O(null))},100)};return document.addEventListener("selectionchange",N),document.addEventListener("mouseup",N),()=>{document.removeEventListener("selectionchange",N),document.removeEventListener("mouseup",N)}},[m,e]);const ee=(N,A)=>{if(!w||!I)return;const{start:E,end:H}=I,z=w.value.substring(E,H);if(!z)return;let L="";switch(N){case"strong":L=`<strong>${z}</strong>`;break;case"em":L=`<em>${z}</em>`;break;case"u":L=`<u>${z}</u>`;break;case"font-size-increase":L=`<span style="font-size: 1.2em;">${z}</span>`;break;case"font-size-decrease":L=`<span style="font-size: 0.9em;">${z}</span>`;break;case"color":L=`<span style="color: ${A};">${z}</span>`;break;case"align-left":L=`<div style="text-align: left;">${z}</div>`;break;case"align-center":L=`<div style="text-align: center;">${z}</div>`;break;case"align-right":L=`<div style="text-align: right;">${z}</div>`;break;case"align-justify":L=`<div style="text-align: justify;">${z}</div>`;break;default:return}const P=w.value.substring(0,E)+L+w.value.substring(H),K=w.getAttribute("data-field");if(K&&p(K,w.value),K==="mainText")a(V=>({...V,mainText:P}));else if(K==="partecipanti")a(V=>({...V,partecipanti:P}));else if(K!=null&&K.startsWith("section-")){const V=parseInt(K.replace("section-",""));s(oe=>oe.map(T=>T.id===V?{...T,content:P}:T))}setTimeout(()=>{w&&(w.focus(),w.setSelectionRange(E+L.length,E+L.length))},50)},xe=()=>{k(),y(!0)},me=async()=>{await d()?(alert("Regolamento salvato con successo!"),S(!1),x()):alert("Errore durante il salvataggio.")},_=N=>{C(N),v(!0),setTimeout(()=>{var A;(A=F.current[N])==null||A.scrollIntoView({behavior:"smooth",block:"start"})},100)},ye=()=>{const N=document.querySelector("main");N&&(N.scrollTop=0),setTimeout(()=>{C(null),v(!1)},100)},re=N=>{D===N?(C(null),v(!1)):(C(N),v(!1),setTimeout(()=>{var A;(A=F.current[N])==null||A.scrollIntoView({behavior:"smooth",block:"start"})},100))};return t?u.jsx("div",{className:"min-h-screen bg-pl-dark flex items-center justify-center",children:u.jsx("div",{className:"text-white text-xl",children:"Caricamento regolamento..."})}):u.jsx("div",{className:"min-h-screen bg-pl-dark py-8 md:py-12",children:u.jsxs("div",{ref:M,className:"max-w-6xl mx-auto px-4",children:[u.jsx(Yo,{editMode:m,setEditMode:S,canEdit:e("admin"),subtitle:r.subtitle||"PianginaCUP • Stagione 2025/26",onSubtitleChange:N=>a(A=>({...A,subtitle:N})),saving:n,onSave:me,onCancel:()=>{S(!1),x(),c()}}),u.jsxs("div",{className:"flex flex-col lg:flex-row gap-8 items-start",children:[u.jsx(Wo,{cenniTitle:r.title||"1. Cenni Principali",sections:o,activeSection:D,scrollToSection:_}),u.jsxs("div",{className:"flex-1 order-2 space-y-6",children:[u.jsx(Ko,{title:r.title||"1. Cenni Principali e Avvertenze",mainText:r.mainText,editMode:m,canEdit:e("admin"),setTitle:N=>a(A=>({...A,title:N})),setMainText:N=>a(A=>({...A,mainText:N})),setRef:N=>F.current[-1]=N}),u.jsx(Zo,{sections:o,editMode:m,canEdit:e("admin"),activeSection:D,toggleSection:re,updateSection:h,addSection:f,removeSection:g,onDragEnd:q,setSectionRef:(N,A)=>F.current[N]=A,scrollToIndex:ye}),u.jsx("div",{className:"h-8"})]}),m&&e("admin")&&u.jsx(rr,{visible:b,onFormat:ee,onUndo:xe,canUndo:i.length>0})]})]})})}export{ri as Rules};
