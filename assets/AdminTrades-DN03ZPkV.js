import{c as F,r as l,j as s,L as j,A as H,k as G,d as a,D as r,G as L,Q as c,g as u,z as p,H as v,l as T}from"./index-IQCk0ePk.js";import{H as Q}from"./history-Cp8gdH11.js";import{T as $}from"./trash-2-DbOOYVSY.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=F("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),V=()=>{const[f,M]=l.useState([]),[E,N]=l.useState(!0),[k,b]=l.useState(null),[g,D]=l.useState(null),[C,_]=l.useState(null),[w,R]=l.useState(new Map),[I,z]=l.useState(new Map),[q,P]=l.useState(new Map),y=async()=>{try{N(!0),b(null);const e=await a.listDocuments(r,L,[c.equal("status","accepted"),c.orderDesc("completed_at"),c.limit(100)]),t=await a.listDocuments(r,u,[c.limit(100)]),i=new Map;t.documents.forEach(n=>i.set(n.$id,n)),R(i);const d=await a.listDocuments(r,p,[c.limit(1e3)]),x=new Map;d.documents.forEach(n=>{x.set(n.$id,n.name)}),z(x);const o=await a.listDocuments(r,v,[c.limit(100)]),m=new Map;o.documents.forEach(n=>{m.set(n.$id,n.short_name||n.name||"Squadra")}),P(m),M(e.documents)}catch(e){T.error("[AdminTrades] Error fetching:",e),b(e.message||"Errore nel caricamento")}finally{N(!1)}};l.useEffect(()=>{y()},[]);const h=e=>{var t;return((t=w.get(e))==null?void 0:t.manager_name)||"Sconosciuto"},S=e=>e.map(t=>I.get(t)||"Giocatore"),A=e=>e.map(t=>q.get(t)||"Squadra"),B=async e=>{var t,i;D(e.$id);try{const d=(t=w.get(e.proposer_team_id))==null?void 0:t.manager_name,x=(i=w.get(e.receiver_team_id))==null?void 0:i.manager_name;for(const o of e.proposer_players)await a.updateDocument(r,p,o,{owner:d});for(const o of e.receiver_players)await a.updateDocument(r,p,o,{owner:x});for(const o of e.proposer_gk_blocks){await a.updateDocument(r,v,o,{goalkeeper_owner:d});const m=await a.listDocuments(r,p,[c.equal("team_id",o),c.equal("position","Portiere")]);for(const n of m.documents)await a.updateDocument(r,p,n.$id,{owner:d})}for(const o of e.receiver_gk_blocks){await a.updateDocument(r,v,o,{goalkeeper_owner:x});const m=await a.listDocuments(r,p,[c.equal("team_id",o),c.equal("position","Portiere")]);for(const n of m.documents)await a.updateDocument(r,p,n.$id,{owner:x})}if(e.credits_offered!==0){const o=await a.getDocument(r,u,e.proposer_team_id),m=await a.getDocument(r,u,e.receiver_team_id);await a.updateDocument(r,u,e.proposer_team_id,{credits_remaining:(o.credits_remaining||0)+e.credits_offered}),await a.updateDocument(r,u,e.receiver_team_id,{credits_remaining:(m.credits_remaining||0)-e.credits_offered})}await a.deleteDocument(r,L,e.$id),await y()}catch(d){T.error("[AdminTrades] Error reverting:",d),b(d.message||"Errore nell'annullamento")}finally{D(null)}},O=e=>new Date(e).toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return E?s.jsxs("div",{className:"flex flex-col items-center justify-center h-96 gap-4",children:[s.jsx(j,{className:"h-8 w-8 animate-spin text-pl-teal"}),s.jsx("span",{className:"text-gray-400",children:"Caricamento scambi..."})]}):s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[s.jsx(Q,{className:"text-orange-400"}),"Storico Scambi"]}),s.jsxs("p",{className:"text-gray-400 text-sm",children:[f.length," scambi completati"]})]}),s.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-white/10 text-gray-300 hover:bg-white/20 transition",children:[s.jsx(Y,{size:16}),"Aggiorna"]})]}),k&&s.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-xl flex items-center gap-3 text-red-400",children:[s.jsx(H,{size:20}),k]}),f.length===0?s.jsx("div",{className:"bg-white/5 border border-white/10 rounded-xl p-8 text-center text-gray-500",children:"Nessuno scambio completato da visualizzare"}):s.jsx("div",{className:"space-y-4",children:f.map(e=>s.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl overflow-hidden hover:border-white/20 transition",children:[s.jsxs("div",{className:"px-4 py-3 bg-black/20 border-b border-white/5 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(G,{size:16,className:"text-green-400"}),s.jsxs("span",{className:"text-white font-medium",children:[h(e.proposer_team_id)," â†” ",h(e.receiver_team_id)]})]}),s.jsx("span",{className:"text-xs text-gray-500",children:O(e.completed_at||e.$updatedAt)})]}),s.jsxs("div",{className:"p-4 grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"text-[10px] uppercase font-bold text-gray-500 mb-2",children:[h(e.proposer_team_id)," ha dato"]}),s.jsxs("div",{className:"space-y-1",children:[S(e.proposer_players).map((t,i)=>s.jsx("div",{className:"text-sm text-white bg-white/5 px-2 py-1 rounded",children:t},i)),A(e.proposer_gk_blocks).map((t,i)=>s.jsxs("div",{className:"text-sm text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded",children:["ðŸ§¤ Blocco ",t]},`b-${i}`)),e.credits_offered>0&&s.jsxs("div",{className:"text-sm text-green-400 bg-green-500/10 px-2 py-1 rounded",children:["ðŸ’° +",e.credits_offered," crediti"]})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"text-[10px] uppercase font-bold text-gray-500 mb-2",children:[h(e.receiver_team_id)," ha dato"]}),s.jsxs("div",{className:"space-y-1",children:[S(e.receiver_players).map((t,i)=>s.jsx("div",{className:"text-sm text-white bg-white/5 px-2 py-1 rounded",children:t},i)),A(e.receiver_gk_blocks).map((t,i)=>s.jsxs("div",{className:"text-sm text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded",children:["ðŸ§¤ Blocco ",t]},`b-${i}`)),e.credits_offered<0&&s.jsxs("div",{className:"text-sm text-green-400 bg-green-500/10 px-2 py-1 rounded",children:["ðŸ’° +",Math.abs(e.credits_offered)," crediti"]})]})]})]}),s.jsx("div",{className:"px-4 py-3 bg-black/20 border-t border-white/5 flex justify-end gap-2",children:C===e.$id?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>_(null),className:"px-3 py-1.5 rounded-lg bg-white/10 text-gray-400 hover:bg-white/20 transition text-sm",children:"Annulla"}),s.jsxs("button",{onClick:()=>{_(null),B(e)},disabled:g===e.$id,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-red-500/30 text-red-300 hover:bg-red-500/40 transition text-sm font-bold disabled:opacity-50",children:[g===e.$id?s.jsx(j,{size:14,className:"animate-spin"}):s.jsx($,{size:14}),"Conferma Annullamento"]})]}):s.jsxs("button",{onClick:()=>_(e.$id),disabled:g===e.$id,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 transition text-sm font-medium disabled:opacity-50",children:[g===e.$id?s.jsx(j,{size:14,className:"animate-spin"}):s.jsx($,{size:14}),"Annulla Scambio"]})})]},e.$id))})]})};export{V as AdminTrades};
